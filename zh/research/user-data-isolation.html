<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>启明星</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/venus-logo.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SMSDTMGLTV"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SMSDTMGLTV');</script>
    <meta name="description" content="GO语言实现的Filecoin分布式存储网络">
    
    <link rel="preload" href="/assets/css/0.styles.117964e0.css" as="style"><link rel="preload" href="/assets/js/app.6f823fd0.js" as="script"><link rel="preload" href="/assets/js/2.d93b85b3.js" as="script"><link rel="preload" href="/assets/js/114.7767ed38.js" as="script"><link rel="prefetch" href="/assets/js/10.3d1b0761.js"><link rel="prefetch" href="/assets/js/100.494649f7.js"><link rel="prefetch" href="/assets/js/101.32710792.js"><link rel="prefetch" href="/assets/js/102.33024aeb.js"><link rel="prefetch" href="/assets/js/103.7ec2f882.js"><link rel="prefetch" href="/assets/js/104.a69d2886.js"><link rel="prefetch" href="/assets/js/105.e9110dae.js"><link rel="prefetch" href="/assets/js/106.e3d1a55c.js"><link rel="prefetch" href="/assets/js/107.571784f0.js"><link rel="prefetch" href="/assets/js/108.987bb943.js"><link rel="prefetch" href="/assets/js/109.1650a43b.js"><link rel="prefetch" href="/assets/js/11.98b51a60.js"><link rel="prefetch" href="/assets/js/110.01799d40.js"><link rel="prefetch" href="/assets/js/111.a0722cd9.js"><link rel="prefetch" href="/assets/js/112.2dffaf4c.js"><link rel="prefetch" href="/assets/js/113.940474dc.js"><link rel="prefetch" href="/assets/js/12.047c0c1b.js"><link rel="prefetch" href="/assets/js/13.3214acef.js"><link rel="prefetch" href="/assets/js/14.c804f201.js"><link rel="prefetch" href="/assets/js/15.fd45fabb.js"><link rel="prefetch" href="/assets/js/16.83a467a1.js"><link rel="prefetch" href="/assets/js/17.f202f6d4.js"><link rel="prefetch" href="/assets/js/18.0d70185c.js"><link rel="prefetch" href="/assets/js/19.f42e4656.js"><link rel="prefetch" href="/assets/js/20.80c885ba.js"><link rel="prefetch" href="/assets/js/21.0e15d93f.js"><link rel="prefetch" href="/assets/js/22.7e14d97d.js"><link rel="prefetch" href="/assets/js/23.fcddfb27.js"><link rel="prefetch" href="/assets/js/24.7303e4a8.js"><link rel="prefetch" href="/assets/js/25.0a0abec4.js"><link rel="prefetch" href="/assets/js/26.998e88da.js"><link rel="prefetch" href="/assets/js/27.82e108e7.js"><link rel="prefetch" href="/assets/js/28.e09e0ccc.js"><link rel="prefetch" href="/assets/js/29.28e077d6.js"><link rel="prefetch" href="/assets/js/3.588bd66c.js"><link rel="prefetch" href="/assets/js/30.def6f408.js"><link rel="prefetch" href="/assets/js/31.fd489160.js"><link rel="prefetch" href="/assets/js/32.d1735f82.js"><link rel="prefetch" href="/assets/js/33.6a60cb6d.js"><link rel="prefetch" href="/assets/js/34.b3ba00a6.js"><link rel="prefetch" href="/assets/js/35.eaf7f0bf.js"><link rel="prefetch" href="/assets/js/36.cb3f2a10.js"><link rel="prefetch" href="/assets/js/37.46684317.js"><link rel="prefetch" href="/assets/js/38.153a5a49.js"><link rel="prefetch" href="/assets/js/39.9a175dd1.js"><link rel="prefetch" href="/assets/js/4.e68695a0.js"><link rel="prefetch" href="/assets/js/40.603f4834.js"><link rel="prefetch" href="/assets/js/41.2cc08c93.js"><link rel="prefetch" href="/assets/js/42.c09021c3.js"><link rel="prefetch" href="/assets/js/43.f28ff22e.js"><link rel="prefetch" href="/assets/js/44.dc41c5de.js"><link rel="prefetch" href="/assets/js/45.5df62bc0.js"><link rel="prefetch" href="/assets/js/46.79bb3421.js"><link rel="prefetch" href="/assets/js/47.facc2aa7.js"><link rel="prefetch" href="/assets/js/48.390980e7.js"><link rel="prefetch" href="/assets/js/49.c6404067.js"><link rel="prefetch" href="/assets/js/5.e8b14dc2.js"><link rel="prefetch" href="/assets/js/50.711a61af.js"><link rel="prefetch" href="/assets/js/51.3d26c658.js"><link rel="prefetch" href="/assets/js/52.2898fbfa.js"><link rel="prefetch" href="/assets/js/53.4b5078c6.js"><link rel="prefetch" href="/assets/js/54.bec1fcba.js"><link rel="prefetch" href="/assets/js/55.ef9f6c55.js"><link rel="prefetch" href="/assets/js/56.c8e54fa9.js"><link rel="prefetch" href="/assets/js/57.5c1b1e0a.js"><link rel="prefetch" href="/assets/js/58.6a183b02.js"><link rel="prefetch" href="/assets/js/59.38d7ad06.js"><link rel="prefetch" href="/assets/js/6.3dd12158.js"><link rel="prefetch" href="/assets/js/60.b1cb640d.js"><link rel="prefetch" href="/assets/js/61.6979ba1d.js"><link rel="prefetch" href="/assets/js/62.bc9fed4f.js"><link rel="prefetch" href="/assets/js/63.7593945f.js"><link rel="prefetch" href="/assets/js/64.40084b15.js"><link rel="prefetch" href="/assets/js/65.5317f231.js"><link rel="prefetch" href="/assets/js/66.09522acc.js"><link rel="prefetch" href="/assets/js/67.26608573.js"><link rel="prefetch" href="/assets/js/68.373658b8.js"><link rel="prefetch" href="/assets/js/69.ffe70c22.js"><link rel="prefetch" href="/assets/js/7.a560c27d.js"><link rel="prefetch" href="/assets/js/70.5e35390e.js"><link rel="prefetch" href="/assets/js/71.9b2dbd36.js"><link rel="prefetch" href="/assets/js/72.b91fc45d.js"><link rel="prefetch" href="/assets/js/73.bbb846a2.js"><link rel="prefetch" href="/assets/js/74.b1e6bc43.js"><link rel="prefetch" href="/assets/js/75.b0d5cced.js"><link rel="prefetch" href="/assets/js/76.682c352f.js"><link rel="prefetch" href="/assets/js/77.39c005de.js"><link rel="prefetch" href="/assets/js/78.3258a15f.js"><link rel="prefetch" href="/assets/js/79.c3424394.js"><link rel="prefetch" href="/assets/js/8.3a200442.js"><link rel="prefetch" href="/assets/js/80.ffab4a75.js"><link rel="prefetch" href="/assets/js/81.0b6db10f.js"><link rel="prefetch" href="/assets/js/82.8a388365.js"><link rel="prefetch" href="/assets/js/83.8dbaf6c1.js"><link rel="prefetch" href="/assets/js/84.69231f57.js"><link rel="prefetch" href="/assets/js/85.d83c3bbc.js"><link rel="prefetch" href="/assets/js/86.ddd7f51b.js"><link rel="prefetch" href="/assets/js/87.10c16be7.js"><link rel="prefetch" href="/assets/js/88.cfbc8c22.js"><link rel="prefetch" href="/assets/js/89.a3a9460b.js"><link rel="prefetch" href="/assets/js/9.f165dc9a.js"><link rel="prefetch" href="/assets/js/90.60e4c6ce.js"><link rel="prefetch" href="/assets/js/91.aa25e930.js"><link rel="prefetch" href="/assets/js/92.fe4210e4.js"><link rel="prefetch" href="/assets/js/93.bb66c790.js"><link rel="prefetch" href="/assets/js/94.52cbd164.js"><link rel="prefetch" href="/assets/js/95.8fef831b.js"><link rel="prefetch" href="/assets/js/96.1b068228.js"><link rel="prefetch" href="/assets/js/97.ed55b302.js"><link rel="prefetch" href="/assets/js/98.e8938bac.js"><link rel="prefetch" href="/assets/js/99.9fa4c776.js">
    <link rel="stylesheet" href="/assets/css/0.styles.117964e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="启明星" class="logo"> <span class="site-name can-hide">启明星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/research/" class="nav-link router-link-active">
  研究
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/research/user-data-isolation.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/research/" class="nav-link router-link-active">
  研究
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/research/user-data-isolation.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Venus生态研究</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/research/" aria-current="page" class="sidebar-link">概述</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>协议解读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/research/fip0045.html" class="sidebar-link">FIP0045</a></li><li><a href="/zh/research/fip0034.html" class="sidebar-link">FIP0034</a></li><li><a href="/zh/research/boost-protocol-research.html" class="sidebar-link">Boost协议解读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>设计方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/research/user-data-isolation.html" aria-current="page" class="active sidebar-link">用户数据隔离</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#simple-summary-概述" class="sidebar-link">Simple Summary (概述)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#abstract-功能简介" class="sidebar-link">Abstract (功能简介)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#motivation-来源-背景" class="sidebar-link">Motivation (来源/背景)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#specification-feature-spec" class="sidebar-link">Specification (feature Spec)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#design-rationale-设计思路" class="sidebar-link">Design Rationale (设计思路)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#backwards-compatibility-兼容性" class="sidebar-link">Backwards Compatibility（兼容性）</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#test-cases-测试用例" class="sidebar-link">Test Cases (测试用例)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#security-considerations-安全考量" class="sidebar-link">Security Considerations (安全考量)</a></li><li class="sidebar-sub-header"><a href="/zh/research/user-data-isolation.html#implementation-实施" class="sidebar-link">Implementation（实施）</a></li></ul></li><li><a href="/zh/research/market-attributes-self-config.html" class="sidebar-link">市场的交易属性配置</a></li><li><a href="/zh/research/impl-mk-1.2.0.html" class="sidebar-link">集成Boost协议</a></li><li><a href="/zh/research/metrics-design.html" class="sidebar-link">Metrics指标</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="simple-summary-概述"><a href="#simple-summary-概述" class="header-anchor">#</a> Simple Summary (概述)</h2> <p>链服务对其用户（SP等）数据隔离，并开放访问接口。</p> <h2 id="abstract-功能简介"><a href="#abstract-功能简介" class="header-anchor">#</a> Abstract (功能简介)</h2> <p><code>SP</code> 的很多业务数据保存在链服务端，并由其负责跟踪与维护。
为了 <code>SP</code> 用户能够管理自己的数据，如：订单，消息，出块，转账等，需要链服务对用户的数据进行隔离，并开放请求的接口.</p> <p>关联：</p> <ul><li>[x] 提案的<a href="https://github.com/filecoin-project/venus/issues/5384" target="_blank" rel="noopener noreferrer">issue<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="motivation-来源-背景"><a href="#motivation-来源-背景" class="header-anchor">#</a> Motivation (来源/背景)</h2> <p><code>Venus</code> 系统分为 <code>云组件</code> 和 <code>本地组件</code> ，在多数情况下，<code>云组件</code> 和 <code>本地组件</code> 的维护者不是同一类人，比如孵化器就是专门维护一套链服务给众多的SP终端用户使用。<code>云组件</code> 在向不同用户提供服务的同时, 为了确保用户数据的安全, 也限制了用户对大部分 <code>用户数据</code> 的访问, 需要新增一种机制, 使得用户能够访问自己的 <code>用户数据</code>的同时, 隔离其他用户的数据, 确保每一位用户的数据安全</p> <h2 id="specification-feature-spec"><a href="#specification-feature-spec" class="header-anchor">#</a> Specification (feature Spec)</h2> <ul><li><p><strong><code>链服务</code></strong>: 是指 <code>Sophon</code> 所提供的, 包括 链上信息的查询, 发布消息 等细项在内的服务.</p></li> <li><p><strong><code>订单服务</code></strong>: 是指 <code>Droplet</code> 提供的, 包括 <code>检索订单</code> 的创建和查询, <code>检索订单</code> 的创建和查询, 存储服务提供商定价查询 等细项在内的服务.</p></li> <li><p><strong><code>用户</code></strong> 是指 <code>链服务</code> 的使用者,这要包括三类群体：</p> <ul><li><code>SC</code>：借助部署在 <code>订单服务</code> 发起存储订单的客户；</li> <li><code>SP</code>：使用 <code>链服务</code> 和 <code>Filecoin 网络</code> 进行交互, 或者使用<code>订单服务</code>承接存储订单的存储服务提供商；</li> <li><code>其他</code>: 除了上述两个群体的其他用户,比如使用 <code>链服务</code> 获取链上数据或者和链进行交互的开发者等。</li></ul></li> <li><p><strong><code>云组件</code></strong>:  是指包括 <code>venus-auth</code>,<code>venus-gateway</code>,<code>venus</code>, <code>venus-messager</code>, <code>venus-miner</code>, <code>venus-market</code> 等系列软件在内的软件实体, 其特点是一套 <code>云组件</code> 可以为多个不同的 <code>用户</code> 提供服务. 云组件又可以划分为 <code>Sophon</code> 和 <code>Droplet</code> 两个部分, 其中 <code>Sophon</code> 负责提供 <code>链服务</code> , <code>Droplet</code>负责提供 <code>订单服务</code>.</p></li> <li><p><strong><code>本地组件</code></strong>: 是指包括 <code>venus-cluster</code>, <code>venus-tool</code> 等软件在内的软件实体.  <code>本地组件</code> 依赖于 <code>云组件</code> 提供的服务, 一套 <code>本地组件</code> 一般只为一个 <code>用户</code> 提供服务.</p></li> <li><p><strong><code>用户数据</code></strong> 是指用户在使用 <code>链服务</code>以及 <code>订单服务</code> 的过程中产生的与用户相关联的数据, 包括但不限于: 用户的公钥, 用户发出的消息, 用户发起的订单, 用户存储订单中的数据, 用户的个性化设置.</p></li> <li><p><strong><code>服务接口</code></strong> 是指 <code>链服务</code> 和 <code>订单服务</code> 为用户提供的用于使用服务以及访问用户数据的接口, 主要是指 <code>链服务</code> 和 <code>订单服务</code> 所对应的软件实体提供<em>RPC访问接口</em>.</p></li> <li><p><strong><code>用户数据隔离</code></strong>: 是指 <code>链服务</code> 和 <code>订单服务</code> 提供者限制用户只能访问和自己的 <code>用户数据</code>. 通过对 <code>服务接口</code> 进行访问控制, 限制用户只能访问自己的 <code>用户数据</code>, 是实现 <code>用户数据隔离</code> 的方式.</p></li> <li><p><strong><code>用户权限</code></strong>: 是指 <code>链服务</code> 和 <code>订单服务</code> 控制用户访问 <code>服务接口</code> 的权限级别的划分, 包括: <code>读权限</code>, <code>写权限</code>, <code>签名权限</code>等三个用户级别权限, 和一个管理员级别权限: <code>管理权限</code>. 一般来说,用户具有用户级别最高权限, 即 <code>签名权限</code> , 但为了方便用户在不同使用情形下进行更加细致的访问控制, 用户可以申请更低权限级别的 <code>Token</code>, 比如: <code>读权限</code> 或者 <code>写权限</code>. 只有管理员才能获得 <code>管理权限</code>. 访问不同的服务端口需要不同的权限级别, 详细参见 <a href="https://venus.filecoin.io/zh/advanced/chain-api-v0.html" target="_blank" rel="noopener noreferrer">API Reference<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></li> <li><p><strong><code>用户界面</code></strong> 是指用户能够用于访问 <code>服务接口</code> 的软件或者其他类型的工具, 包括但不限于: <code>Democles</code>, <code>venus-wallet</code>, <code>market-client</code>, <code>venus-tool</code> 等直接访问 <code>链服务</code> 或者 <code>订单服务</code> 服务的软件; 或者能够直接访问 <code>服务接口</code> 的 <em>curl</em> , 或者用户自己开发的工具.</p></li></ul> <h2 id="design-rationale-设计思路"><a href="#design-rationale-设计思路" class="header-anchor">#</a> Design Rationale (设计思路)</h2> <p>通过 <code>Token</code> 区别不同用户身份, 以及访问级别. <br> <code>服务接口</code> 的实现中针对不同的 <code>用户身份</code>, 进行不同的处理, 从而实现 <code>用户数据隔离</code>.</p> <h2 id="backwards-compatibility-兼容性"><a href="#backwards-compatibility-兼容性" class="header-anchor">#</a> Backwards Compatibility（兼容性）</h2> <h2 id="test-cases-测试用例"><a href="#test-cases-测试用例" class="header-anchor">#</a> Test Cases (测试用例)</h2> <h2 id="security-considerations-安全考量"><a href="#security-considerations-安全考量" class="header-anchor">#</a> Security Considerations (安全考量)</h2> <ul><li>应确保只有管理员能够获取到 'admin' 级别的权限, 防止用户数据泄漏</li></ul> <h2 id="implementation-实施"><a href="#implementation-实施" class="header-anchor">#</a> Implementation（实施）</h2> <h3 id="用户身份识别"><a href="#用户身份识别" class="header-anchor">#</a> 用户身份识别</h3> <p>通过 <code>Token</code> 获取用户身份</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">JwtUserFromToken</span><span class="token punctuation">(</span>token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	sks <span class="token operator">:=</span> strings<span class="token punctuation">.</span><span class="token function">Split</span><span class="token punctuation">(</span>token<span class="token punctuation">,</span> <span class="token string">&quot;.&quot;</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>sks<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;can't parse user from input token&quot;</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
	dec<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">DecodeToBytes</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span>sks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
	<span class="token punctuation">}</span>
	payload <span class="token operator">:=</span> <span class="token operator">&amp;</span>JWTPayload<span class="token punctuation">{</span><span class="token punctuation">}</span>
	err <span class="token operator">=</span> json<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>dec<span class="token punctuation">,</span> payload<span class="token punctuation">)</span>

	<span class="token keyword">return</span> payload<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre></div><p>将用户名称注入到 <code>context</code> 中</p> <div class="language-go extra-class"><pre class="language-go"><code>ctx <span class="token operator">=</span> <span class="token function">CtxWithName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> name<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">CtxWithName</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> v <span class="token builtin">string</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span>Context <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token function">ctxWithString</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> accountKey<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">ctxWithString</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> k CtxKey<span class="token punctuation">,</span> v <span class="token builtin">string</span><span class="token punctuation">)</span> context<span class="token punctuation">.</span>Context <span class="token punctuation">{</span>
	<span class="token keyword">return</span> context<span class="token punctuation">.</span><span class="token function">WithValue</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>服务接口</code> 中通过 <code>context</code> 获取用户名称</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">GetCtxName</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ctx<span class="token punctuation">.</span><span class="token function">Value</span><span class="token punctuation">(</span>accountKey<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="目标数据的识别"><a href="#目标数据的识别" class="header-anchor">#</a> 目标数据的识别</h3> <p>仅仅只是知道 <code>用户身份</code> 是不够的的, 我们还需要知道, 该用户访问的 <code>目标数据</code> 是什么, 以及该<code>目标数据</code> 是属于哪个 <code>用户</code> 的. 例如, 一个 <code>用户</code> 可能有多个 <code>矿工</code>, 但是他只能访问自己的 <code>矿工</code> 的数据, 不能访问其他 <code>用户</code> 的 <code>矿工</code> 的数据.</p> <p>绝大多数情况下,我们都可以通过 <code>用户</code> 所访问的 <code>服务接口</code> 来确定 <code>目标数据</code> 的类型, 可以根据 <code>目标数据</code> 类型中的 <code>关键字段</code> 来确定 <code>目标数据</code> 的归属. 例如当用户访问 消息相关的服务接口时, 可以通过 <code>消息类型</code> 的发送者字段来确定该数据的拥有者是谁, 进而判断访问者是否具有该数据的访问权限.</p> <p>在现在的实现中, 我们可以通过三种类型的 <code>关键数据</code> , 来确定访问者是否具有访问 <code>目标数据</code> 的权限:</p> <h4 id="用户名称"><a href="#用户名称" class="header-anchor">#</a> 用户名称</h4> <p>在用户管理相关的 <code>服务接口</code> 中, 往往会出现 <code>用户名称</code> 作为 <code>关键数据</code> 的情况, 例如 <code>用户</code> 的 <code>矿工</code> 列表, <code>用户</code> 的 <code>Signer</code> 列表等. 通过 <code>用户名称</code> 我们可以直接判断访问者是否具有访问该数据的权限.</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// checkPermissionByUser check weather the user has admin permission or is match the username passed in</span>
<span class="token keyword">func</span> <span class="token function">CheckPermissionByName</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> auth<span class="token punctuation">.</span><span class="token function">HasPerm</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>auth<span class="token punctuation">.</span>Permission<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> core<span class="token punctuation">.</span>PermAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	user<span class="token punctuation">,</span> exist <span class="token operator">:=</span> <span class="token function">CtxGetName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>exist <span class="token operator">||</span> user <span class="token operator">!=</span> name <span class="token punctuation">{</span>
		<span class="token keyword">return</span> ErrorPermissionDeny
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="钱包地址"><a href="#钱包地址" class="header-anchor">#</a> 钱包地址</h4> <p>在和 <code>消息</code> 有关联的 <code>服务接口</code> 中, 往往会涉及到消息的发送者, 也就是签名该消息的钱包地址. 通过该地址, 我们可以判断该消息是否属于访问者的, 从而判断访问者是否具有访问该数据的权限.</p> <div class="language-go extra-class"><pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token function">CheckPermissionBySigner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> client IAuthClient<span class="token punctuation">,</span> addrs <span class="token operator">...</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> auth<span class="token punctuation">.</span><span class="token function">HasPerm</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>auth<span class="token punctuation">.</span>Permission<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> core<span class="token punctuation">.</span>PermAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	user<span class="token punctuation">,</span> exist <span class="token operator">:=</span> <span class="token function">CtxGetName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>exist <span class="token punctuation">{</span>
		<span class="token keyword">return</span> ErrorUserNotFound
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> wAddr <span class="token operator">:=</span> <span class="token keyword">range</span> addrs <span class="token punctuation">{</span>
		ok<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">SignerExistInUser</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> user<span class="token punctuation">,</span> wAddr<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;check signer exist in user fail %s failed when check permission: %s&quot;</span><span class="token punctuation">,</span> wAddr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
			<span class="token keyword">return</span> ErrorPermissionDeny
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="矿工地址"><a href="#矿工地址" class="header-anchor">#</a> 矿工地址</h4> <div class="language-go extra-class"><pre class="language-go"><code>
<span class="token keyword">func</span> <span class="token function">CheckPermissionByMiner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> client IAuthClient<span class="token punctuation">,</span> addrs <span class="token operator">...</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> auth<span class="token punctuation">.</span><span class="token function">HasPerm</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>auth<span class="token punctuation">.</span>Permission<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> core<span class="token punctuation">.</span>PermAdmin<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">return</span> <span class="token boolean">nil</span>
	<span class="token punctuation">}</span>
	user<span class="token punctuation">,</span> exist <span class="token operator">:=</span> <span class="token function">CtxGetName</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token operator">!</span>exist <span class="token punctuation">{</span>
		<span class="token keyword">return</span> ErrorUserNotFound
	<span class="token punctuation">}</span>
	<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> mAddr <span class="token operator">:=</span> <span class="token keyword">range</span> addrs <span class="token punctuation">{</span>
		ok<span class="token punctuation">,</span> err <span class="token operator">:=</span> client<span class="token punctuation">.</span><span class="token function">MinerExistInUser</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> user<span class="token punctuation">,</span> mAddr<span class="token punctuation">)</span>
		<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;check miner exist in user fail %s failed when check permission: %s&quot;</span><span class="token punctuation">,</span> mAddr<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
			<span class="token keyword">return</span> ErrorPermissionDeny
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="实现的细节"><a href="#实现的细节" class="header-anchor">#</a> 实现的细节</h3> <p>本小节主要叙述在实际实现的过程中涉及到的 <code>服务接口</code> 的变动. <br> <code>venus</code> 组件不涉及 <code>用户数据</code>, 不需要做相应变动.<br> <code>venus-gateway</code> 涉及 <code>用户数据</code> 部分的 <code>接口</code> 仅对管理员开放, 不需要变动.<br>
所以, 主要涉及到一下四个 <code>云组件</code> 的接口:</p> <h4 id="venus-auth-接口"><a href="#venus-auth-接口" class="header-anchor">#</a> <code>venus-auth</code> 接口</h4> <p><code>venus-auth</code> 本身并无 <code>用户身份</code> 和 <code>权限级别</code> 的检查, 新增如下:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// Read 权限</span>
<span class="token function">Verify</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>JWTPayload<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// read</span>

<span class="token comment">// Admin 权限:</span>
<span class="token function">GenerateToken</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> cp <span class="token operator">*</span>JWTPayload<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">Tokens</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> skip<span class="token punctuation">,</span> limit <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>TokenInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">GetToken</span><span class="token punctuation">(</span>c context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>TokenInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">CreateUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>CreateUserRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>CreateUserResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">VerifyUsers</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>VerifyUsersReq<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">ListUsers</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>ListUsersRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span>ListUsersResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">HasUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>HasUserRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">UpdateUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>UpdateUserRequest<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">DeleteUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>DeleteUserRequest<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">RecoverUser</span><span class="token punctuation">(</span>ctx <span class="token operator">*</span>gin<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>RecoverUserRequest<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">GetUserRateLimits</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>GetUserRateLimitsReq<span class="token punctuation">)</span> <span class="token punctuation">(</span>GetUserRateLimitResponse<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">UpsertUserRateLimit</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>UpsertUserRateLimitReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">DelUserRateLimit</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>DelUserRateLimitReq<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">HasMiner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>HasMinerRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">GetUserByMiner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>GetUserByMinerRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>OutputUser<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">RegisterSigners</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>RegisterSignersReq<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">UnregisterSigners</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>UnregisterSignersReq<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token function">HasSigner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>HasSignerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">GetUserBySigner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>GetUserBySignerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>OutputUser<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
<span class="token function">UpsertMiner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>UpsertMinerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>

<span class="token comment">// Admin 权限 或者 目标数据拥有者 (意味着这部分接口会对部分非admin权限开放)</span>
<span class="token function">RemoveToken</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token comment">// +tokenOwner</span>
<span class="token function">RecoverToken</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> token <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token comment">// +tokenOwner</span>
<span class="token function">GetTokenByName</span><span class="token punctuation">(</span>c context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token operator">*</span>TokenInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +tokenOwner</span>
<span class="token function">GetUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>GetUserRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>OutputUser<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +userOwner</span>
<span class="token function">MinerExistInUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>MinerExistInUserRequest<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +userOwner</span>
<span class="token function">ListMiners</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>ListMinerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span>ListMinerResp<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +userOwner</span>
<span class="token function">DelMiner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>DelMinerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +minerOwner</span>
<span class="token function">SignerExistInUser</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>SignerExistInUserReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +userOwner</span>
<span class="token function">ListSigner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>ListSignerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span>ListSignerResp<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +userOwner</span>
<span class="token function">DelSigner</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> req <span class="token operator">*</span>DelSignerReq<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">// +signerOwner</span>
</code></pre></div><h4 id="venus-miner"><a href="#venus-miner" class="header-anchor">#</a> venus-miner</h4> <p>在非 <code>管理权限</code> 的接口增加了<code>用户身份</code>的检查, 接口权限变动如下:</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token function">UpdateAddress</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token builtin">int64</span><span class="token punctuation">,</span> <span class="token builtin">int64</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>MinerInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>                                        <span class="token comment">//perm:write -&gt; admin</span>
<span class="token function">WarmupForMiner</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token builtin">error</span>                                                         <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">Start</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token builtin">error</span>                                                                <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">Stop</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token builtin">error</span>                                                                 <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">ListAddress</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>MinerInfo<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>                                                        <span class="token comment">//perm:read</span>
<span class="token function">StatesForMining</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>MinerState<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>                                <span class="token comment">//perm:read</span>
<span class="token function">CountWinners</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">,</span> abi<span class="token punctuation">.</span>ChainEpoch<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>types<span class="token punctuation">.</span>CountWinners<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
</code></pre></div><h4 id="venus-messager"><a href="#venus-messager" class="header-anchor">#</a> venus-messager</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 不需要用户隔离的接口(管理员级别的接口或者公开数据接口)</span>
<span class="token function">SetSharedParams</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> params <span class="token operator">*</span>mtypes<span class="token punctuation">.</span>SharedSpec<span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">SetLogLevel</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> subsystem<span class="token punctuation">,</span> level <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">SaveNode</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> node <span class="token operator">*</span>mtypes<span class="token punctuation">.</span>Node<span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">ListNode</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">HasNode</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">GetSharedParams</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">GetNode</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">DeleteNode</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">ListMessageByAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">ListMessageByFromState</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> from address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> state mtypes<span class="token punctuation">.</span>MessageState<span class="token punctuation">,</span> isAsc <span class="token builtin">bool</span><span class="token punctuation">,</span> pageIndex<span class="token punctuation">,</span> pageSize <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">UpdateAllFilledMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">RepublishMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">LogList</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token comment">//perm:write -&gt; admin</span>
<span class="token function">NetPeers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//perm:read -&gt; admin</span>
<span class="token function">NetFindPeer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//perm:read -&gt; admin</span>
<span class="token function">NetAddrListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//perm:read -&gt; admin</span>
<span class="token function">NetConnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">UpdateNonce</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> nonce <span class="token builtin">uint64</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin</span>
<span class="token function">HasMessageByUid</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:read</span>

<span class="token comment">// 已经实现用户隔离的接口</span>
<span class="token function">HasAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">GetMessageByUnsignedCid</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> cid cid<span class="token punctuation">.</span>Cid<span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">GetMessageByUid</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">GetMessageBySignedCid</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> cid cid<span class="token punctuation">.</span>Cid<span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">GetMessageByFromAndNonce</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> from address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> nonce <span class="token builtin">uint64</span><span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">PushMessageWithId</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> msg <span class="token operator">*</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> meta <span class="token operator">*</span>mtypes<span class="token punctuation">.</span>SendSpec<span class="token punctuation">)</span> <span class="token comment">//perm:write</span>
<span class="token function">PushMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> msg <span class="token operator">*</span>types<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> meta <span class="token operator">*</span>mtypes<span class="token punctuation">.</span>SendSpec<span class="token punctuation">)</span> <span class="token comment">//perm:write</span>
<span class="token function">WalletHas</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">WaitMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> confidence <span class="token builtin">uint64</span><span class="token punctuation">)</span> <span class="token comment">//perm:read</span>
<span class="token function">UpdateMessageStateByID</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">,</span> state mtypes<span class="token punctuation">.</span>MessageState<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">UpdateFilledMessageByID</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">SetFeeParams</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> params <span class="token operator">*</span>mtypes<span class="token punctuation">.</span>AddressSpec<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">ReplaceMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> params <span class="token operator">*</span>mtypes<span class="token punctuation">.</span>ReplacMessageParams<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">RecoverFailedMsg</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">MarkBadMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> id <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">ListMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context <span class="token punctuation">,</span> p <span class="token operator">*</span>types<span class="token punctuation">.</span>MsgQueryParams<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; read</span>
<span class="token function">ListFailedMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; read</span>
<span class="token function">ListBlockedMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> d time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; read</span>
<span class="token function">ListAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; read</span>
<span class="token function">GetAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; read</span>
<span class="token function">ForbiddenAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">DeleteAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>
<span class="token function">ClearUnFillMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt;write</span>
<span class="token function">ActiveAddress</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt;write</span>
<span class="token function">Send</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> params mtypes<span class="token punctuation">.</span>QuickSendParams<span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; sign</span>
<span class="token function">SetSelectMsgNum</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> addr address<span class="token punctuation">.</span>Address<span class="token punctuation">,</span> num <span class="token builtin">uint64</span><span class="token punctuation">)</span> <span class="token comment">//perm:admin -&gt; write</span>


<span class="token comment">// 参数变动</span>
<span class="token function">ListMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context <span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">ListMessage</span><span class="token punctuation">(</span>ctx context<span class="token punctuation">.</span>Context <span class="token punctuation">,</span> p <span class="token operator">*</span>types<span class="token punctuation">.</span>MsgQueryParams<span class="token punctuation">)</span>
</code></pre></div><h4 id="venus-market"><a href="#venus-market" class="header-anchor">#</a> venus-market</h4> <div class="language-go extra-class"><pre class="language-go"><code><span class="token comment">// 不需要做用户数据隔离的接口(开放数据)</span>
PiecesListPieces <span class="token comment">//perm:read</span>
PiecesListCidInfos <span class="token comment">//perm:read</span>
PiecesGetPieceInfo <span class="token comment">//perm:read</span>
PiecesGetCIDInfo <span class="token comment">//perm:read</span>
MessagerWaitMessage <span class="token comment">//perm:read</span>
MessagerGetMessage <span class="token comment">//perm:read</span>
NetAddrsListen <span class="token comment">//perm:read</span>
ID <span class="token comment">//perm:read</span>
ResponseMarketEvent <span class="token comment">//perm:read</span>
ListenMarketEvent <span class="token comment">//perm:read</span>
ListPieceStorageInfos <span class="token comment">//perm:read</span>
MarketListAsk <span class="token comment">//perm:read</span>
MarketListRetrievalAsk <span class="token comment">//perm:read</span>

<span class="token comment">// 不对普通用户开放的接口 (管理员级别的接口)</span>
MarketListDataTransfers <span class="token comment">//perm:read -&gt; admin</span>
MarketDataTransferUpdates <span class="token comment">//perm:read -&gt; admin</span>
MarketRestartDataTransfer <span class="token comment">//perm:read -&gt; admin</span>
MarketCancelDataTransfer <span class="token comment">//perm:read -&gt; admin</span>
ImportV1Data <span class="token comment">//perm:admin</span>
MarketPublishPendingDeals <span class="token comment">//perm:admin</span>
DagstoreListShards <span class="token comment">//perm:admin</span>
DagstoreInitializeShard <span class="token comment">//perm:admin</span>
DagstoreRecoverShard <span class="token comment">//perm:admin</span>
DagstoreInitializeAll <span class="token comment">//perm:admin</span>
DagstoreInitializeStorage <span class="token comment">//perm:admin</span>
DagstoreGC <span class="token comment">//perm:admin</span>
AddFsPieceStorage <span class="token comment">//perm:admin</span>
AddS3PieceStorage <span class="token comment">//perm:admin</span>
RemovePieceStorage <span class="token comment">//perm:admin</span>

<span class="token comment">// 暂时不进行用户数据隔离的接口 </span>
MarketListRetrievalDeals <span class="token comment">//perm:read</span>

<span class="token comment">// 进行用户数据隔离的接口</span>
ActorList <span class="token comment">//perm:read</span>
ActorExist <span class="token comment">//perm:read</span>
ActorSectorSize <span class="token comment">//perm:read</span>
MarketListDeals <span class="token comment">//perm:read</span>

MarketGetDealUpdates <span class="token comment">//perm:read</span>
MarketListIncompleteDeals <span class="token comment">//perm:read</span>
MarketGetAsk <span class="token comment">//perm:read</span>

MarketGetRetrievalAsk <span class="token comment">//perm:read</span>

DealsConsiderOnlineStorageDeals <span class="token comment">//perm:read</span>
DealsConsiderOnlineRetrievalDeals <span class="token comment">//perm:read</span>
DealsPieceCidBlocklist <span class="token comment">//perm:read</span>
DealsConsiderOfflineStorageDeals <span class="token comment">//perm:read</span>
DealsConsiderOfflineRetrievalDeals <span class="token comment">//perm:read</span>
DealsConsiderVerifiedStorageDeals <span class="token comment">//perm:read</span>
DealsConsiderUnverifiedStorageDeals <span class="token comment">//perm:read</span>
SectorGetExpectedSealDuration <span class="token comment">//perm:read</span>
DealsMaxStartDelay <span class="token comment">//perm:read</span>

DealsPublishMsgPeriod <span class="token comment">//perm:read</span>
MarketMaxDealsPerPublishMsg <span class="token comment">//perm:read</span>

DealsMaxProviderCollateralMultiplier <span class="token comment">//perm:read</span>
DealsMaxPublishFee <span class="token comment">//perm:read</span>
MarketMaxBalanceAddFee <span class="token comment">//perm:read</span>

GetDeals <span class="token comment">//perm:read</span>
GetUnPackedDeals <span class="token comment">//perm:read</span>

PaychVoucherList <span class="token comment">//perm:read</span>

GetStorageDealStatistic <span class="token comment">//perm:read</span>
GetRetrievalDealStatistic <span class="token comment">//perm:read</span>

MarketImportDealData <span class="token comment">//perm:write</span>
MarketImportPublishedDeal <span class="token comment">//perm:write</span>

MarketPendingDeals <span class="token comment">//perm:write</span>
DealsSetConsiderOnlineStorageDeals <span class="token comment">//perm:write</span>
DealsSetConsiderOnlineRetrievalDeals <span class="token comment">//perm:write</span>
DealsSetPieceCidBlocklist <span class="token comment">//perm:write</span>
DealsSetConsiderOfflineStorageDeals <span class="token comment">//perm:write</span>
DealsSetConsiderOfflineRetrievalDeals <span class="token comment">//perm:write</span>
DealsSetConsiderVerifiedStorageDeals <span class="token comment">//perm:write</span>
DealsSetConsiderUnverifiedStorageDeals <span class="token comment">//perm:write</span>
SectorSetExpectedSealDuration <span class="token comment">//perm:write</span>
DealsSetMaxStartDelay <span class="token comment">//perm:write</span>

DealsSetPublishMsgPeriod <span class="token comment">//perm:write</span>
MarketSetMaxDealsPerPublishMsg <span class="token comment">//perm:write</span>
DealsSetMaxProviderCollateralMultiplier <span class="token comment">//perm:write</span>
DealsSetMaxPublishFee <span class="token comment">//perm:write</span>
MarketSetMaxBalanceAddFee <span class="token comment">//perm:write</span>
MessagerPushMessage <span class="token comment">//perm:write</span>
MarkDealsAsPacking <span class="token comment">//perm:write</span>
UpdateDealOnPacking <span class="token comment">//perm:write</span>
UpdateDealStatus <span class="token comment">//perm:write</span>
AssignUnPackedDeals <span class="token comment">//perm:write</span>
UpdateStorageDealStatus <span class="token comment">//perm:write</span>

MarketAddBalance <span class="token comment">//perm:sign</span>
MarketGetReserved <span class="token comment">//perm:sign</span>
MarketReserveFunds <span class="token comment">//perm:sign</span>
MarketReleaseFunds <span class="token comment">//perm:sign</span>
MarketWithdraw <span class="token comment">//perm:sign</span>

MarketSetAsk <span class="token comment">//perm:admin</span>
MarketSetRetrievalAsk <span class="token comment">//perm:admin</span>
DealsImportData <span class="token comment">//perm:admin</span>
OfflineDealImport <span class="token comment">//perm:admin</span>
MarketDataTransferPath <span class="token comment">//perm:admin</span>
MarketSetDataTransferPath <span class="token comment">//perm:admin</span>

<span class="token comment">// 被删除接口</span>
ImportV1Data <span class="token comment">//perm:admin</span>


</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/zh/research/user-data-isolation.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/4/25 02:36:36</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/research/boost-protocol-research.html" class="prev">
        Boost协议解读
      </a></span> <span class="next"><a href="/zh/research/market-attributes-self-config.html">
        市场的交易属性配置
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.6f823fd0.js" defer></script><script src="/assets/js/2.d93b85b3.js" defer></script><script src="/assets/js/114.7767ed38.js" defer></script>
  </body>
</html>
