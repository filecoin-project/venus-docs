<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>FIP45: De-couple verifyed registry from markets 解读 | 启明星</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/venus-logo.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SMSDTMGLTV"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SMSDTMGLTV');</script>
    <meta name="description" content="GO语言实现的Filecoin分布式存储网络">
    
    <link rel="preload" href="/assets/css/0.styles.117964e0.css" as="style"><link rel="preload" href="/assets/js/app.5e5035a9.js" as="script"><link rel="preload" href="/assets/js/2.d93b85b3.js" as="script"><link rel="preload" href="/assets/js/102.676d0a56.js" as="script"><link rel="prefetch" href="/assets/js/10.d1c164f8.js"><link rel="prefetch" href="/assets/js/100.acf12d52.js"><link rel="prefetch" href="/assets/js/101.d6ba60a8.js"><link rel="prefetch" href="/assets/js/103.1f4cb286.js"><link rel="prefetch" href="/assets/js/104.fd5b6b88.js"><link rel="prefetch" href="/assets/js/105.f1fe94c2.js"><link rel="prefetch" href="/assets/js/106.4e89ca90.js"><link rel="prefetch" href="/assets/js/11.39d382c8.js"><link rel="prefetch" href="/assets/js/12.a8fa267b.js"><link rel="prefetch" href="/assets/js/13.29435311.js"><link rel="prefetch" href="/assets/js/14.01a8da50.js"><link rel="prefetch" href="/assets/js/15.781d84eb.js"><link rel="prefetch" href="/assets/js/16.9090bfde.js"><link rel="prefetch" href="/assets/js/17.3c92535e.js"><link rel="prefetch" href="/assets/js/18.af070300.js"><link rel="prefetch" href="/assets/js/19.cbf85e59.js"><link rel="prefetch" href="/assets/js/20.a02f1659.js"><link rel="prefetch" href="/assets/js/21.0e15d93f.js"><link rel="prefetch" href="/assets/js/22.7e14d97d.js"><link rel="prefetch" href="/assets/js/23.fcddfb27.js"><link rel="prefetch" href="/assets/js/24.7303e4a8.js"><link rel="prefetch" href="/assets/js/25.0a0abec4.js"><link rel="prefetch" href="/assets/js/26.998e88da.js"><link rel="prefetch" href="/assets/js/27.e480a1b5.js"><link rel="prefetch" href="/assets/js/28.e09e0ccc.js"><link rel="prefetch" href="/assets/js/29.28e077d6.js"><link rel="prefetch" href="/assets/js/3.1d3b456e.js"><link rel="prefetch" href="/assets/js/30.def6f408.js"><link rel="prefetch" href="/assets/js/31.fd489160.js"><link rel="prefetch" href="/assets/js/32.d1735f82.js"><link rel="prefetch" href="/assets/js/33.d4a965cd.js"><link rel="prefetch" href="/assets/js/34.fcb328a5.js"><link rel="prefetch" href="/assets/js/35.eaf7f0bf.js"><link rel="prefetch" href="/assets/js/36.cb3f2a10.js"><link rel="prefetch" href="/assets/js/37.e01e5e96.js"><link rel="prefetch" href="/assets/js/38.36059892.js"><link rel="prefetch" href="/assets/js/39.732b1dc4.js"><link rel="prefetch" href="/assets/js/4.f3c6d7d0.js"><link rel="prefetch" href="/assets/js/40.34270f85.js"><link rel="prefetch" href="/assets/js/41.ccdd0cf9.js"><link rel="prefetch" href="/assets/js/42.d1b1ad7f.js"><link rel="prefetch" href="/assets/js/43.73f4037c.js"><link rel="prefetch" href="/assets/js/44.e4bf7a1b.js"><link rel="prefetch" href="/assets/js/45.89899402.js"><link rel="prefetch" href="/assets/js/46.d7da63e0.js"><link rel="prefetch" href="/assets/js/47.0d2ad72c.js"><link rel="prefetch" href="/assets/js/48.e217112a.js"><link rel="prefetch" href="/assets/js/49.b9ded15e.js"><link rel="prefetch" href="/assets/js/5.bd4cdbc7.js"><link rel="prefetch" href="/assets/js/50.50f17b89.js"><link rel="prefetch" href="/assets/js/51.3cccea63.js"><link rel="prefetch" href="/assets/js/52.8424010f.js"><link rel="prefetch" href="/assets/js/53.6b8ce2fa.js"><link rel="prefetch" href="/assets/js/54.ae93d6fd.js"><link rel="prefetch" href="/assets/js/55.8c7849db.js"><link rel="prefetch" href="/assets/js/56.b9f020c1.js"><link rel="prefetch" href="/assets/js/57.88fad549.js"><link rel="prefetch" href="/assets/js/58.6983af66.js"><link rel="prefetch" href="/assets/js/59.8e310c91.js"><link rel="prefetch" href="/assets/js/6.3dd12158.js"><link rel="prefetch" href="/assets/js/60.cc23edcf.js"><link rel="prefetch" href="/assets/js/61.b67b475a.js"><link rel="prefetch" href="/assets/js/62.635b0125.js"><link rel="prefetch" href="/assets/js/63.8271cc70.js"><link rel="prefetch" href="/assets/js/64.745968c7.js"><link rel="prefetch" href="/assets/js/65.46f33d71.js"><link rel="prefetch" href="/assets/js/66.5587bf58.js"><link rel="prefetch" href="/assets/js/67.c6b165ba.js"><link rel="prefetch" href="/assets/js/68.08104a13.js"><link rel="prefetch" href="/assets/js/69.7eb6d599.js"><link rel="prefetch" href="/assets/js/7.a560c27d.js"><link rel="prefetch" href="/assets/js/70.8c2c62f9.js"><link rel="prefetch" href="/assets/js/71.33cf82be.js"><link rel="prefetch" href="/assets/js/72.bb6dfe8b.js"><link rel="prefetch" href="/assets/js/73.cc8e9bc1.js"><link rel="prefetch" href="/assets/js/74.d29bf8c7.js"><link rel="prefetch" href="/assets/js/75.5adf7b9a.js"><link rel="prefetch" href="/assets/js/76.1440a115.js"><link rel="prefetch" href="/assets/js/77.5d1a8df6.js"><link rel="prefetch" href="/assets/js/78.fd55fa3b.js"><link rel="prefetch" href="/assets/js/79.abfeaec6.js"><link rel="prefetch" href="/assets/js/8.22a211b8.js"><link rel="prefetch" href="/assets/js/80.d1028106.js"><link rel="prefetch" href="/assets/js/81.ea3d49d0.js"><link rel="prefetch" href="/assets/js/82.b26a0568.js"><link rel="prefetch" href="/assets/js/83.55d7eeda.js"><link rel="prefetch" href="/assets/js/84.dbb27105.js"><link rel="prefetch" href="/assets/js/85.5ba85bfc.js"><link rel="prefetch" href="/assets/js/86.5200a8e5.js"><link rel="prefetch" href="/assets/js/87.4a038c01.js"><link rel="prefetch" href="/assets/js/88.ab6b3465.js"><link rel="prefetch" href="/assets/js/89.5f10a5ee.js"><link rel="prefetch" href="/assets/js/9.ffdad4b1.js"><link rel="prefetch" href="/assets/js/90.aeaf36c5.js"><link rel="prefetch" href="/assets/js/91.d497ec61.js"><link rel="prefetch" href="/assets/js/92.8f2ef6aa.js"><link rel="prefetch" href="/assets/js/93.65f9d1d3.js"><link rel="prefetch" href="/assets/js/94.bc8a612b.js"><link rel="prefetch" href="/assets/js/95.c6f4c73e.js"><link rel="prefetch" href="/assets/js/96.2d391d6e.js"><link rel="prefetch" href="/assets/js/97.a729d39e.js"><link rel="prefetch" href="/assets/js/98.4b6ee74b.js"><link rel="prefetch" href="/assets/js/99.d08e8cdd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.117964e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="启明星" class="logo"> <span class="site-name can-hide">启明星</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/research/" class="nav-link router-link-active">
  研究
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/research/fip0045.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/intro/" class="nav-link">
  简介
</a></div><div class="nav-item"><a href="/zh/advanced/" class="nav-link">
  进阶
</a></div><div class="nav-item"><a href="/zh/operation/" class="nav-link">
  运维
</a></div><div class="nav-item"><a href="/zh/research/" class="nav-link router-link-active">
  研究
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">选择语言</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/research/fip0045.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Venus生态研究</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/research/" aria-current="page" class="sidebar-link">概述</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>协议解读</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/research/fip0045.html" aria-current="page" class="active sidebar-link">FIP0045</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/research/fip0045.html#前置概念" class="sidebar-link">前置概念</a></li><li class="sidebar-sub-header"><a href="/zh/research/fip0045.html#提案概述" class="sidebar-link">提案概述</a></li><li class="sidebar-sub-header"><a href="/zh/research/fip0045.html#来龙去脉" class="sidebar-link">来龙去脉</a></li><li class="sidebar-sub-header"><a href="/zh/research/fip0045.html#技术解读" class="sidebar-link">技术解读</a></li><li class="sidebar-sub-header"><a href="/zh/research/fip0045.html#市场解读" class="sidebar-link">市场解读</a></li></ul></li><li><a href="/zh/research/fip0034.html" class="sidebar-link">FIP0034</a></li><li><a href="/zh/research/boost-protocol-research.html" class="sidebar-link">Boost协议解读</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>设计方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/research/market-attributes-self-config.html" class="sidebar-link">市场的交易属性配置</a></li><li><a href="/zh/research/impl-mk-1.2.0.html" class="sidebar-link">集成Boost协议</a></li><li><a href="/zh/research/metrics-design.html" class="sidebar-link">Metrics指标</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="fip45-de-couple-verifyed-registry-from-markets-解读"><a href="#fip45-de-couple-verifyed-registry-from-markets-解读" class="header-anchor">#</a> <a href="https://github.com/filecoin-project/FIPs/blob/master/FIPS/fip-0045.md" target="_blank" rel="noopener noreferrer">FIP45<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>: De-couple verifyed registry from markets 解读</h1> <h2 id="前置概念"><a href="#前置概念" class="header-anchor">#</a> 前置概念</h2> <ul><li>FIL+: 此概念在<a href="https://github.com/filecoin-project/FIPs/blob/master/FIPS/fip-0003.md" target="_blank" rel="noopener noreferrer"><code>FIP-0003</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中提出.包含 2 个角色:</li> <li><code>FIL+ clients</code>:(之前叫: <code>Verified clients</code>), 从<code>Fil+Notaries</code>处申请<code>DataCap</code>的配额, 并将这一部分带'data cap'的数据通过存储订单发给<code>SP</code>.</li> <li><code>FIL+ Notaries</code>(之前叫: <code>Verifiers</code>), 按规则将<code>DataCap</code>配额分配给<code>FIL+ clients</code>
由<code>FIL+clients</code>发出的验证订单, 产生的算力, 是普通数据的 10 倍.</li></ul> <h2 id="提案概述"><a href="#提案概述" class="header-anchor">#</a> 提案概述</h2> <p>伴随<code>FVM</code>更开放的可编程性, filecoin 有可能实现延长<code>FIL+ data cap</code>分配期限, 意味着存储验证数据的<code>SP</code>可能不再受<code>storage market actor</code>相关的订单限制,享受更长久的算力和奖励增加.
此提案, 目的是将 FIL+与<code>storage market actor</code>分离, 抽象出新的<code>datacap token</code>, 相关的业务完全由<code>verified registry actor</code>和<code>datacap token</code>来接替.</p> <p>提案依赖:<a href="https://github.com/filecoin-project/FIPs/blob/master/FIPS/fip-0034.md" target="_blank" rel="noopener noreferrer">FIP34<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, [解读](#FIP34 Fix pre-commit deposit independent of sector content 解读)</p> <h2 id="来龙去脉"><a href="#来龙去脉" class="header-anchor">#</a> 来龙去脉</h2> <p>当前的机制:</p> <ul><li><p>FC(<code>FIL+ clients</code>)从 FN(<code>FIL+ Notaries</code>)拿到以(byte)为度量单位的 <strong>一定大小</strong>的<strong>一次性</strong>的<code>data cap</code>.</p></li> <li><p>FC 消耗自己的<code>data cap</code>配额, 在连上激活标<code>verified data</code>的订单. 封装此订单的 secotr 的<code>质量</code>得到提升,奖励增加.</p></li> <li><p>FC 和 FN 通过内置的<code>storage market actor</code>进行交易, 每个订单都会指定一个期限.</p></li> <li><p>每个 sector 都有承诺的有效期(此期限最多可以延长到 5 年), <code>storage marekt actor</code>的实现中限制了任何订单超过 sector 的承诺期限(540 天).</p></li> <li><p>当前的情况是:</p> <ul><li>即使 secotr 续期了,也没有任何方法对其封装的订单进行续期.</li> <li>没有相关的机制让一个 deal 从一个 sector 转移到另外一个 sector.</li></ul></li></ul> <p>综上:
每个<code>data cap</code>分配的期限, 事实上绑定到了一个 deal 上, 并间接受限于 sector 的最长期限(5 年). 也就是说, <code>FIL+</code>订单提供的对于<code>SP</code>获取的奖励增加受限于订单期限, 间接的受限于 sector 的最大期限.</p> <p><strong>扩展阅读</strong>:
为什么 sector 最大期限设置为 5 年?(书上说是出于<a href="https://spec.filecoin.io/algorithms/porep-old/stacked_drg/" target="_blank" rel="noopener noreferrer">SDR PoRep 算法<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的安全性考虑)</p> <h3 id="从协议上来解耦的思路"><a href="#从协议上来解耦的思路" class="header-anchor">#</a> 从协议上来解耦的思路</h3> <ul><li><p>通过实现允许<code>verified deal</code>的数据,可以从一个 sector 转移到过期时间更久的 sector 上,来解决以上两个问题.</p></li> <li><p>伴随<a href="https://github.com/filecoin-project/FIPs/discussions/298" target="_blank" rel="noopener noreferrer">FVM 架构调整<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, <code>fvm</code>提供更加开放的可编程性, 开发者可以开发一种自己的<code>storage market</code>替代内置的.
<code>data cap</code>数据不应该被内置的<code>storage market</code>独享, 所以需要从内置<code>market</code>中将此部分业务抽象成独立的<code>datacap token</code></p></li></ul> <h3 id="预期功能"><a href="#预期功能" class="header-anchor">#</a> 预期功能</h3> <ul><li>带'data cap'数据配额的分配将和数据本身以及<code>SP</code>相关, 而不是订单.</li> <li>带'data cap'数据有一个与 sector 的承诺期限无关的期限的周期区间.</li> <li><code>SP</code>只需要在一个生命周期大于<code>verified data</code>最小生命周期, 小于或等于其最大周期的 sector 中证明了其存储就可以立刻得到增强算力和奖励.
当 sector 过期后,<code>SP</code>可以在其新的 sector 中继续承诺这部分数据.一直到<code>data cap</code>过期.</li> <li>存储客户和<code>SP</code>之间可以不走<code>storage market</code>的订单流程(直接将验证数据<code>add piece</code>到 sector 中?)</li> <li>公证人可以通过机制控制验证客户发出<code>verified data</code>的最大期限</li> <li>计算<code>QA power</code>的方法被简化</li></ul> <p><strong>思考:</strong>
为什么 sector 的周期必须小于或等于<code>verified data</code>的最大期限?</p> <h2 id="技术解读"><a href="#技术解读" class="header-anchor">#</a> 技术解读</h2> <ul><li><p><code>builtin-actor</code>增加<code>datacap token</code>, 关于<code>FIL+</code>相关的业务完全由新增加的<code>datacap token</code>和升级后的<code>verified registry actor</code>来承接.</p></li> <li><p><code>miner actor</code> 改动:(<strong>疑惑</strong>:<a href="https://github.com/filecoin-project/FIPs/blob/master/FIPS/fip-0045.md#simplified-quality-adjusted-power" target="_blank" rel="noopener noreferrer">fip<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中的描述和<a href="https://github.com/filecoin-project/builtin-actors/blob/cf557e82939844ee8e1d5839bb7f2cbdd50e58ae/actors/miner/src/lib.rs#L3799-L3801" target="_blank" rel="noopener noreferrer">实现<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>没对上, 尚待完成?)</p> <ul><li><code>QA power</code>计算变化为: <code>SectorSize + (9 * VerifedDealWeight)</code></li> <li><code>DealWeight</code> 和 <code>VerifiedDealWeight</code>的直接等于<code>SectorSize</code></li></ul></li> <li><p>接发单流程变化:</p> <ul><li><p>通过<code>storage market actor</code>代理,继续沿用<code>vn16</code>中的的发单流程.
本来新的<code>FIL+</code>业务已经和它分离了,看起来和它不会再有任何关系, 但为了与当前的<code>client-market-provider</code>的工作模式保持一致.
所以,依然将 <code>storage market actor</code>作为中间的撮合层, 在其中完成了复杂的相关业务逻辑,外部看起来流程和之前保持一致. <a href="https://github.com/filecoin-project/FIPs/blob/master/FIPS/fip-0045.md#built-in-storage-market-as-a-delegate" target="_blank" rel="noopener noreferrer">流程描述<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>大致如下:</p> <div class="language- extra-class"><pre><code>1. `FIL+ clients`调用`stroage markets actor`发布订单, 设置订单参数`DealProposal.verified_deal`为`true`.
2. `market actor`的`publish_storage_deal`内部, 如果订单`verified_deal`为true, 则调用`data cap token`的`Transfer`, 最终会在`verified registry actor`中创建一条`Allocation`的记录, 表示`data cap`配额已经分配给了`picee cid`代表的数据.
    `Allocation`有一个`life span`, 最小90天, 最大5年. 但在**实际**中,这个值会被自动按如下的逻辑进行设置.
</code></pre></div><div class="language-rust extra-class"><pre class="language-rust"><code>    <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">MINIMUM_VERIFIED_ALLOCATION_TERM</span><span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">180</span> <span class="token operator">*</span> <span class="token constant">EPOCHS_IN_DAY</span><span class="token punctuation">;</span>
    <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">MAXIMUM_VERIFIED_ALLOCATION_TERM</span><span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">5</span> <span class="token operator">*</span> <span class="token constant">EPOCHS_IN_YEAR</span><span class="token punctuation">;</span>
    <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">MAXIMUM_VERIFIED_ALLOCATION_EXPIRATION</span><span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">60</span> <span class="token operator">*</span> <span class="token constant">EPOCHS_IN_DAY</span><span class="token punctuation">;</span>
    <span class="token keyword">pub</span> <span class="token keyword">const</span> <span class="token constant">MARKET_DEFAULT_ALLOCATION_TERM_BUFFER</span><span class="token punctuation">:</span> <span class="token keyword">i64</span> <span class="token operator">=</span> <span class="token number">90</span> <span class="token operator">*</span> <span class="token constant">EPOCHS_IN_DAY</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> alloc_term_min <span class="token operator">=</span> deal<span class="token punctuation">.</span>proposal<span class="token punctuation">.</span>end_epoch <span class="token operator">-</span> deal<span class="token punctuation">.</span>proposal<span class="token punctuation">.</span>start_epoch<span class="token punctuation">;</span>
    <span class="token keyword">let</span> alloc_term_max <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span> alloc_term_min <span class="token operator">+</span> policy<span class="token punctuation">.</span>market_default_allocation_term_buffer<span class="token punctuation">,</span> policy<span class="token punctuation">.</span>maximum_verified_allocation_term<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> alloc_expiration <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>deal<span class="token punctuation">.</span>proposal<span class="token punctuation">.</span>start_epoch<span class="token punctuation">,</span> curr_epoch <span class="token operator">+</span> policy<span class="token punctuation">.</span>maximum_verified_allocation_expiration<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li><code>SP</code>开始封装扇区, 在第一次<code>WinPoST</code>(如果是<code>snapup</code>只需要在<code>replica-update</code>)时, 就会在<code>verifyied rregistry actor</code>中创建一条<code>Claim,</code>记录<code>Allocation</code>被<code>SP</code>的某个扇区获取, <code>SP</code>获得<code>data cap</code>带来的算力增益效果.</li></ol></li> <li><p>绕过<code>stroage market actor</code>使用新的发单流程(需待<a href="https://github.com/filecoin-project/FIPs/discussions/298" target="_blank" rel="noopener noreferrer">架构调整<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>完成后), 在新的方案中, 对于扇区封装的<code>Piece</code>定义为:</p> <div class="language-go extra-class"><pre class="language-go"><code>    <span class="token keyword">type</span> PieceManifest <span class="token keyword">struct</span> <span class="token punctuation">{</span>
      <span class="token comment">// Each piece may specify a FIL+ verified data cap allocation ID.</span>
      <span class="token comment">// If the piece is a sub-piece of a larger allocation, also specifies</span>
      <span class="token comment">// the range covered and an inclusion proof in the allocation.</span>
        VerifiedDataAllocationID <span class="token builtin">uint64</span> <span class="token comment">// Optional</span>
        VerifiedDataRangeStart   <span class="token builtin">uint64</span>
        VerifiedDataRangeEnd     <span class="token builtin">uint64</span>
    <span class="token punctuation">}</span>
</code></pre></div><p>和<code>Allocation</code>建立了直接的关联, 所以,在计算sector获取的增强算力得以不再依赖<code>storage market</code>的deal. 新的流程大致如下:</p> <ol><li>Allocation，即发单，可以选择这个订单时长的一个区间。最短6个月，最长5年</li> <li>发单之日和发单中定义的SP完成封装的时间，不得大于60天</li> <li>一旦发单，<code>client</code>持有的<code>datacap token</code>会被转至一个<code>verified registry</code></li> <li>当SP没有能够在<code>client</code>规定的高度前完成订单封装，<code>datacap token</code>会返还给<code>client</code>，即接单失败</li> <li>原有的f+治理的方式之一，移除<code>client</code>地址上的<code>datacap</code>功能，现变为能够实现把<code>client</code>地址持有的<code>datacap token</code>给烧掉</li> <li>当一个<code>SP</code>成功接单之后，一个<code>allocation</code>就转变为SP的一个<code>claim</code>；<code>verified registry</code>中保管的<code>datacap token</code>也因接单成功后，直接燃烧掉</li> <li>当一个SP的订单到期之后，<code>claim</code>被移除</li> <li>SP可以延长<code>claim</code>，即延长订单，但不能超过发单时定义的订单最长生命</li> <li>同时，一个<code>client</code>可以花费<code>datacap token</code>给一个订单续期，但是订单生命周期最长不能超过5年</li></ol></li></ul></li> <li><p>扇区<a href="https://github.com/filecoin-project/lotus/pull/9412" target="_blank" rel="noopener noreferrer">封装逻辑发生变化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(venus cluster有影响?)</p></li> <li><p>扇区<a href="https://github.com/filecoin-project/lotus/issues/9369" target="_blank" rel="noopener noreferrer">续期逻辑发生变化<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(续期工具有影响?)</p></li> <li><p>对于<code>venus</code>来说</p> <ul><li>除了保证节点正常工作之外, 是否还应该增加相关的 cli 工具?</li> <li>数据类型的变化带来的影响, 需要关注是否包含某些数据类型的变化，在<code>venus-shared</code>中有于其对应的自定义类型，以及如果存在，可能导致的数据迁移问题等。</li></ul></li></ul> <h2 id="市场解读"><a href="#市场解读" class="header-anchor">#</a> 市场解读</h2> <p>FIP0045的核心之一是<code>datacap token</code>化。为fvm能够更好的利用<code>datacap token</code>去实现一些用户自定义的场景。同时这给整个接单流程带来了巨大的变化。重点如下.</p> <p>关于<code>datacap token</code>：</p> <ul><li><code>datacap token</code>最终是形态是要通过 FIP0046，兼容 filcoin 定义的 FRC-0046 标准</li> <li>当前 nv17 不包含 FIP0046</li> <li>一个非常，非常重要的点，FRC-0046 支持<code>client</code>把管理<code>datacap token</code>的权限委托给一个代理的功能；代理可以是一个合约；</li> <li>当<code>client</code>收新的公证人签名的<code>datacap token</code>时，<code>datacap token</code>将被直接<code>mint</code>，铸造出来</li></ul> <p>关于质押：</p> <ul><li>当订单从老扇区被转移到新扇区后，会按当前网络重新计算新扇区的质押；但老扇区质押不变；</li></ul> <p>关于迁移/兼容：</p> <ul><li>当前<code>client</code>地址中的<code>datacap</code>，全部迁移成<code>datacap token</code></li> <li><code>datacap</code>浏览器，玄羚，需要做新的兼容</li> <li>resnap 暂时还没有支持，即一个 CC 被 snap 一次后，订单过期，不能再被 snap</li></ul> <p>SP 激励：</p> <ul><li>可以预见的网络中的<code>client</code>将发送更多最大时长为 5 年的<code>datacap</code>订单以获取最大利益</li> <li>SP 倾向 5 年订单，可能导致有实际短期需求的订单得不到存储</li> <li>可能短期发单<code>gas</code>会提高</li></ul> <p>对于生态的考虑:</p> <ul><li>datacap可被续期的最大值还有待实践中，慢慢斟酌；无限制的话，肯定是不行的</li> <li>datacap在f+治理自动化和能力提升后，应该进一步充足；网络估计会有很多没有多大用处的数据</li> <li>由此，datacap会有一定的早期入局红利</li></ul> <p><strong><code>FIP45</code>的影响远不止上述提到的内容, 可以说其对于 filecoin 架构和生态的影响都非常的巨大.其影响会随着时间的推移逐步的体现出来.</strong></p> <p><strong>此提案的实现, 为存储市场更加开发的可编程性提供了更广阔的空间. 从软件的角度来说,filecoin 向<code>高内聚, 低耦合</code>更进了迈进了一步.</strong></p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/zh/research/fip0045.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2023/2/22 02:32:00</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/zh/research/" class="prev router-link-active">
        概述
      </a></span> <span class="next"><a href="/zh/research/fip0034.html">
        FIP0034
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5e5035a9.js" defer></script><script src="/assets/js/2.d93b85b3.js" defer></script><script src="/assets/js/102.676d0a56.js" defer></script>
  </body>
</html>
