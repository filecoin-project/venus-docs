(window.webpackJsonp=window.webpackJsonp||[]).push([[88],{463:function(a,e,s){"use strict";s.r(e);var t=s(17),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h1",{attrs:{id:"venus-payment-channels"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#venus-payment-channels"}},[a._v("#")]),a._v(" Venus: Payment channels")]),a._v(" "),s("p",[a._v("这里将会介绍Payment channels是如何在Venus中工作的，同时也提供了一些案例来帮助理解它的运行流程。如果需要理解详细概念，可以跳转至"),s("a",{attrs:{href:"https://spec.filecoin.io/#section-systems.filecoin_token.payment_channels",target:"_blank",rel:"noopener noreferrer"}},[a._v("Filecoin Spec Payment Channel"),s("OutboundLink")],1)]),a._v(" "),s("p",[a._v("Payment channels 的作用是在2个actor之间转移filecoin。")]),a._v(" "),s("p",[a._v("例如：客户端创建了一个payment channel以从服务端抓取数据。客户端通过在payment channel中发送vouchers 给服务端，然后服务端会发送响应数据。 payment channel 和 voucher 的概念适用于任何客户端与服务端链下周期性多次交易的场景。")]),a._v(" "),s("h2",{attrs:{id:"运行用例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行用例"}},[a._v("#")]),a._v(" 运行用例")]),a._v(" "),s("ul",[s("li",[a._v("payment channel 在链上创建并需要初始化一个Fil量（量的大小自行定夺）")]),a._v(" "),s("li",[a._v("voucher 可以使客户端和服务端在链下陆续的交易资金，服务端在任何阶段都可以提交voucher到链上。")]),a._v(" "),s("li",[a._v("关于两端之间的payment channel其中任意一端都可以settle到链上。")]),a._v(" "),s("li",[a._v("payment channel在settle到链上之后的一个时间段内（目前为12小时），任何一端都可以在链上执行collect。")]),a._v(" "),s("li",[a._v("collect之后，payment channel中的多个voucher中提交的Fil会被发送到payment channel的接受者（服务端），创建payment channel中的Fil除去voucher中的Fil之后剩余的Fil将会被退还到payment channel的创建者（客户端）。")]),a._v(" "),s("li",[a._v("voucher下有lane的概念，lane有nonce（递增）和value（Fil）的概念，在同一个lane中，高nonce的voucher为最终有效voucher。\n(每个deal依赖于一个新创建的lane)")])]),a._v(" "),s("h2",{attrs:{id:"cli-范例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#cli-范例"}},[a._v("#")]),a._v(" CLI 范例")]),a._v(" "),s("blockquote",[s("p",[a._v("为了快速的理解，我们通过使用Venus的CLI来介绍payment channel是如何工作的。Venus CLI是一个基于Venus守护进程的客户端，同时也可以通过对应的JSON-RPC API调用。")])]),a._v(" "),s("p",[a._v("创建一个初始额度为10FIL的payment channel:")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych add-funds "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("form_addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("to_addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("10")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("客户端在指定的<channel addr>中穿件一个nonce默认为1，额度为2FIL，lane为0的voucher:")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych voucher create "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("客户端将生成的voucher发送给服务端，服务端将其添加到本地存储中:")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych voucher "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("服务端发送一些数据给客户端。\n客户端创建一个lane为0，nonce为2（默认在之前的1的基础上自增后），额度为4Fil的voucher:")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych voucher create "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("客户端将生成的voucher发送给服务端，服务端添加voucher后发送更多的数据给客户端。")]),a._v(" "),s("p",[a._v("客户端可以通过“paych add-funds”给已经创建好的payment channel添加FIL额度：")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych add-funds "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("client addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("provider addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("5")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[a._v("#和之前的的地址一样，现在这个channel的额度已经是15了")]),a._v("\n")])])]),s("p",[a._v("一旦客户端收到了所有的数据，他们需要settle掉这个通道，这个settle的动作不需要马上执行，例如客户端可以继续保持这个通道，只要他想继续与服务端进行交易。")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych settle "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("服务端可以提交voucher到链上（venus检测到链上的settle后会自动执行提交）。服务端可能收到许多FIL额度递增的voucher,它需要提交最优的voucher,需要注意的是每个lane中只有一个最佳voucher:")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych voucher best-spendable "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n\n$ venus paych voucher submit "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("voucher"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])]),s("p",[a._v("一旦settle后的保护周期结束，客户端或者服务端都可以提交collect将资金归属结算。")]),a._v(" "),s("div",{staticClass:"language-shell script extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[a._v("$ venus paych collect "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("channel addr"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("\n")])])])])}),[],!1,null,null,null);e.default=r.exports}}]);