(window.webpackJsonp=window.webpackJsonp||[]).push([[135],{514:function(s,t,a){"use strict";a.r(t);var e=a(17),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"大数据集数据准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大数据集数据准备"}},[s._v("#")]),s._v(" 大数据集数据准备")]),s._v(" "),a("p",[s._v("以"),a("code",[s._v("aws")]),s._v("的开源大数据仓库为基础数据，下载完成后使用"),a("code",[s._v("filedrive-team")]),s._v("开源的"),a("a",{attrs:{href:"https://github.com/filedrive-team/go-graphsplit.git",target:"_blank",rel:"noopener noreferrer"}},[s._v("go-graphsplit"),a("OutboundLink")],1),s._v("\n进行切割成指定大小的"),a("code",[s._v("piece")]),s._v("文件(建议切成16-32G)，移动到"),a("code",[s._v("venus-cluster")]),s._v("和"),a("code",[s._v("venus-maket")]),s._v("共用的"),a("code",[s._v("pieceStore")]),s._v("路径下。")]),s._v(" "),a("h2",{attrs:{id:"下载大数据集"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#下载大数据集"}},[s._v("#")]),s._v(" 下载大数据集")]),s._v(" "),a("p",[s._v("由于下载的目标数据集过于庞大，建议存放在存储服务器上，分批下载数据集；需要使用aws工具进行下载")]),s._v(" "),a("p",[s._v("1、下载aws命令行工具\ncentos系统:")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ yum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y awscli\n")])])]),a("p",[s._v("ubuntu系统:")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y awscli\n")])])]),a("p",[s._v("2、查看数据集大小，并下载文件")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ aws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" s3://stpubdata/tess/public/ffi/s0006/2018 --recursive --human-readable --summarize --no-sign-request\n\nTotal Objects: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23568")]),s._v("\nTotal Size: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" TiB\n")])])]),a("p",[s._v("开始下载文件到"),a("code",[s._v("/mnt/nas/venus-data")]),s._v("目录下:")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" aws s3 "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v(" s3://stpubdata/tess/public/ffi/s0006/2018 /mnt/nas/venus-data/tess/public/ffi/s0006/2018 --no-sign-request "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" download.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),a("p",[s._v("下载速度根据用户自身的机房出口网络情况而定")]),s._v(" "),a("h2",{attrs:{id:"大数据的选择"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#大数据的选择"}},[s._v("#")]),s._v(" 大数据的选择")]),s._v(" "),a("div",{staticClass:"language-url extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("https://github.com/awslabs/open-data-registry/tree/main/datasets\n")])])]),a("p",[s._v("里面包含"),a("code",[s._v("aws")]),s._v("所有开源的大数据集，请与"),a("code",[s._v("LDN申请人")]),s._v("确认所下载的大数据是否符合"),a("code",[s._v("LDN")]),s._v("申请的数据类型。")]),s._v(" "),a("p",[s._v("例如:开普勒的光度测量数据，可以看到"),a("code",[s._v("github上open-data-registry")]),s._v("仓库下有一个"),a("code",[s._v("k2.yaml")]),s._v("的文件;\n只需在"),a("code",[s._v("aws")]),s._v("仓库后跟上大数据集名称，就可以在浏览器上得到下载的地址...")]),s._v(" "),a("div",{staticClass:"language-url extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("https://registry.opendata.aws/k2/\n")])])]),a("h2",{attrs:{id:"go-graphsplit"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#go-graphsplit"}},[s._v("#")]),s._v(" go-graphsplit")]),s._v(" "),a("p",[s._v("编译"),a("code",[s._v("go-graphsplit")]),s._v("用于切"),a("code",[s._v("piece")]),s._v("工具")]),s._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/filedrive-team/go-graphsplit.git\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" go-graphsplit\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# get submodules")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" submodule update --init --recursive\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# build filecoin-ffi")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" ffi\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v("\n")])])]),a("h2",{attrs:{id:"切piece"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#切piece"}},[s._v("#")]),s._v(" 切piece")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("piece")]),s._v("过程中，通过"),a("code",[s._v("TMPDIR")]),s._v("变量来指定切过程中临时文件存放的路径，默认是在"),a("code",[s._v("/tmp")]),s._v("目录下，如果使用普通的系统盘做为临时数据目录，可能会因为系统盘的IO不足，导致进程报出"),a("strong",[s._v("Bus error")]),s._v("错误后异常退出。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("$ "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TMPDIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mnt/nvme01 /root/graphsplit chunk "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--car-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mnt/nas/venus-data/16g-pice-data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--slice-size"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17179869184")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--parallel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--graph-name"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gs-test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--calc-commp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--rename "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n--parent-path"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/mnt/nas/venus-data/tess/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n/mnt/nas/venus-data/tess/ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /root/nas-nas-para15-30.log "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("&1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[a("code",[s._v("--car-dir")]),s._v(": 指定切割完成后"),a("code",[s._v("CAR")]),s._v("文件存储的路径；\n"),a("code",[s._v("--slice-size")]),s._v(": 指定切割后输出的的"),a("code",[s._v("piece")]),s._v("文件大小，以"),a("code",[s._v("byte")]),s._v("为基础单位；1024 * 1024 * 1024 = 1073741824 这个就表示是"),a("code",[s._v("1G")]),s._v("的"),a("code",[s._v("piece")]),s._v("文件, 推荐大小为 "),a("code",[s._v("16G")]),s._v("("),a("code",[s._v("17179869184")]),s._v(") 或 "),a("code",[s._v("32G")]),s._v("("),a("code",[s._v("34359738368")]),s._v(")；\n"),a("code",[s._v("--parallel")]),s._v(": 指定并发的数量，值越大消耗的CPU和内存会越高；\n"),a("code",[s._v("--calc-commp")]),s._v(": 计算"),a("code",[s._v("commp")]),s._v("的值；\n"),a("code",[s._v("--rename")]),s._v(": 将"),a("code",[s._v("CAR")]),s._v("文件自动转换成piece文件；")])]),s._v(" "),a("p",[s._v("在切割完成后，在"),a("code",[s._v("--car-dir")]),s._v("指定的目录下会有很多pice文件和一个"),a("code",[s._v("manifest.csv")]),s._v("文件；\n把"),a("code",[s._v("piece")]),s._v("文件移到"),a("code",[s._v("venus-market")]),s._v("和"),a("code",[s._v("venus-sector-manager")]),s._v("共享的"),a("code",[s._v("pieceStore")]),s._v("路径下。")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[a("code",[s._v("manifest.csv")]),s._v("包含了发单的必要信息。")])]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("提示")]),s._v(" "),a("p",[s._v("期望DataCap订单的生命周期，默认是生命周期是530天，订单需要在7天内封装完成"),a("code",[s._v("PreCommitSector")]),s._v("消息上链，不然DataCap订单会直接过期。")])]),s._v(" "),a("h2",{attrs:{id:"venus体系接收订单"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus体系接收订单"}},[s._v("#")]),s._v(" Venus体系接收订单")]),s._v(" "),a("h3",{attrs:{id:"venus-market查看收到订单状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-market查看收到订单状态"}},[s._v("#")]),s._v(" venus-market查看收到订单状态")]),s._v(" "),a("p",[s._v("当订单的状态为"),a("code",[s._v("undefine")]),s._v("，就表示此订单等待"),a("code",[s._v("venus-sector-manager")]),s._v("将订单转换成扇区"),a("code",[s._v("id")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("venus-market storage-deals list\n/root/.venusmarket\nProposalCid  DealId  State              PieceState  Client                                     Provider  Size    Price  Duration\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".hbgguc6a  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172163")]),s._v("  StorageDealWait  Undefind    t1yusfltophrl3z5zgemgr3pwgg3nzdjbjky          t0xxxx   16GiB   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FIL  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1059840")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".t2wycjiq  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172164")]),s._v("  StorageDealWait  Undefind    t1yusfltophrl3z5zgemgr3pwgg3nzdjbjky          t0xxxx   16GiB   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FIL  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1059840")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".5tkvirfe  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172165")]),s._v("  StorageDealWait  Undefind    t1yusfltophrl3z5zgemgr3pwgg3nzdjbjky          t0xxxx   16GiB   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FIL  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1059840")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".btsawgt2  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172166")]),s._v("  StorageDealWait  Undefind    t1yusfltophrl3z5zgemgr3pwgg3nzdjbjky          t0xxxx   16GiB   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FIL  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1059840")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".feczgggg  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172167")]),s._v("  StorageDealWait  Undefind    t1yusfltophrl3z5zgemgr3pwgg3nzdjbjky          t0xxxx   16GiB   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" FIL  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1059840")]),s._v("\n")])])]),a("h3",{attrs:{id:"venus-sector-manager配置注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-sector-manager配置注意事项"}},[s._v("#")]),s._v(" venus-sector-manager配置注意事项")]),s._v(" "),a("p",[s._v("确认配置文件"),a("code",[s._v(".venus-sector-manager/sector-manager.cfg")]),s._v("中的"),a("strong",[s._v("Enabled和EnableDeals")]),s._v("的值都为"),a("strong",[s._v("true")]),s._v("，表示开启封装算力和开启接入封装订单任务。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Miners.Sector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nInitNumber "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),s._v("\nMaxNumber "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000000")]),s._v("\nEnabled "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nEnableDeals "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nLifetimeDays "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("210")]),s._v("\n")])])]),a("p",[a("code",[s._v("venus-worker")]),s._v("需要在连接"),a("code",[s._v("venus-sector-manager")]),s._v("时需要携带"),a("code",[s._v("token")]),s._v("，才可以获取到"),a("code",[s._v("Piece")]),s._v("数据")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sector_manager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 构造 rpc 客户端时使用的连接地址，必填项，字符串类型")]),s._v("\n  rpc_client.addr "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/ip4/192.168.100.1/tcp/1789"')]),s._v("\n  rpc_client.headers "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" User-Agent "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"jsonrpc-core-client"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  piece_token "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"eyJhbGciOiJIUzxxxxxxxx.eyJuYW1lIjoibGpoOG1xxx.gY3ymGxxxxxxxxxxxxxxxxxxxxxxxxxxxx"')]),s._v("\n  \n  \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("sealing_thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  sealing.enable_deals "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  sealing.max_retries "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);