(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{494:function(t,s,n){"use strict";n.r(s);var a=n(17),e=Object(a.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h2",{attrs:{id:"simple-summary-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary-概述"}},[t._v("#")]),t._v(" Simple Summary (概述)")]),t._v(" "),n("p",[t._v("链服务对其用户（SP等）数据隔离，并开放访问接口。")]),t._v(" "),n("h2",{attrs:{id:"abstract-功能简介"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#abstract-功能简介"}},[t._v("#")]),t._v(" Abstract (功能简介)")]),t._v(" "),n("p",[n("code",[t._v("SP")]),t._v(" 的很多业务数据保存在链服务端，并由其负责跟踪与维护。\n为了 "),n("code",[t._v("SP")]),t._v(" 用户能够管理自己的数据，如：订单，消息，出块，转账等，需要链服务对用户的数据进行隔离，并开放请求的接口.")]),t._v(" "),n("p",[t._v("关联：")]),t._v(" "),n("ul",[n("li",[t._v("[x] 提案的"),n("a",{attrs:{href:"https://github.com/filecoin-project/venus/issues/5384",target:"_blank",rel:"noopener noreferrer"}},[t._v("issue"),n("OutboundLink")],1)])]),t._v(" "),n("h2",{attrs:{id:"motivation-来源-背景"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#motivation-来源-背景"}},[t._v("#")]),t._v(" Motivation (来源/背景)")]),t._v(" "),n("p",[n("code",[t._v("Venus")]),t._v(" 系统分为 "),n("code",[t._v("云组件")]),t._v(" 和 "),n("code",[t._v("本地组件")]),t._v(" ，在多数情况下，"),n("code",[t._v("云组件")]),t._v(" 和 "),n("code",[t._v("本地组件")]),t._v(" 的维护者不是同一类人，比如孵化器就是专门维护一套链服务给众多的SP终端用户使用。"),n("code",[t._v("云组件")]),t._v(" 在向不同用户提供服务的同时, 为了确保用户数据的安全, 也限制了用户对大部分 "),n("code",[t._v("用户数据")]),t._v(" 的访问, 需要新增一种机制, 使得用户能够访问自己的 "),n("code",[t._v("用户数据")]),t._v("的同时, 隔离其他用户的数据, 确保每一位用户的数据安全")]),t._v(" "),n("h2",{attrs:{id:"specification-feature-spec"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#specification-feature-spec"}},[t._v("#")]),t._v(" Specification (feature Spec)")]),t._v(" "),n("ul",[n("li",[n("p",[n("strong",[n("code",[t._v("链服务")])]),t._v(": 是指 "),n("code",[t._v("Sophon")]),t._v(" 所提供的, 包括 链上信息的查询, 发布消息 等细项在内的服务.")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("订单服务")])]),t._v(": 是指 "),n("code",[t._v("Droplet")]),t._v(" 提供的, 包括 "),n("code",[t._v("检索订单")]),t._v(" 的创建和查询, "),n("code",[t._v("检索订单")]),t._v(" 的创建和查询, 存储服务提供商定价查询 等细项在内的服务.")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("用户")])]),t._v(" 是指 "),n("code",[t._v("链服务")]),t._v(" 的使用者,这要包括三类群体：")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("SC")]),t._v("：借助部署在 "),n("code",[t._v("订单服务")]),t._v(" 发起存储订单的客户；")]),t._v(" "),n("li",[n("code",[t._v("SP")]),t._v("：使用 "),n("code",[t._v("链服务")]),t._v(" 和 "),n("code",[t._v("Filecoin 网络")]),t._v(" 进行交互, 或者使用"),n("code",[t._v("订单服务")]),t._v("承接存储订单的存储服务提供商；")]),t._v(" "),n("li",[n("code",[t._v("其他")]),t._v(": 除了上述两个群体的其他用户,比如使用 "),n("code",[t._v("链服务")]),t._v(" 获取链上数据或者和链进行交互的开发者等。")])])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("云组件")])]),t._v(":  是指包括 "),n("code",[t._v("venus-auth")]),t._v(","),n("code",[t._v("venus-gateway")]),t._v(","),n("code",[t._v("venus")]),t._v(", "),n("code",[t._v("venus-messager")]),t._v(", "),n("code",[t._v("venus-miner")]),t._v(", "),n("code",[t._v("venus-market")]),t._v(" 等系列软件在内的软件实体, 其特点是一套 "),n("code",[t._v("云组件")]),t._v(" 可以为多个不同的 "),n("code",[t._v("用户")]),t._v(" 提供服务. 云组件又可以划分为 "),n("code",[t._v("Sophon")]),t._v(" 和 "),n("code",[t._v("Droplet")]),t._v(" 两个部分, 其中 "),n("code",[t._v("Sophon")]),t._v(" 负责提供 "),n("code",[t._v("链服务")]),t._v(" , "),n("code",[t._v("Droplet")]),t._v("负责提供 "),n("code",[t._v("订单服务")]),t._v(".")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("本地组件")])]),t._v(": 是指包括 "),n("code",[t._v("venus-cluster")]),t._v(", "),n("code",[t._v("venus-tool")]),t._v(" 等软件在内的软件实体.  "),n("code",[t._v("本地组件")]),t._v(" 依赖于 "),n("code",[t._v("云组件")]),t._v(" 提供的服务, 一套 "),n("code",[t._v("本地组件")]),t._v(" 一般只为一个 "),n("code",[t._v("用户")]),t._v(" 提供服务.")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("用户数据")])]),t._v(" 是指用户在使用 "),n("code",[t._v("链服务")]),t._v("以及 "),n("code",[t._v("订单服务")]),t._v(" 的过程中产生的与用户相关联的数据, 包括但不限于: 用户的公钥, 用户发出的消息, 用户发起的订单, 用户存储订单中的数据, 用户的个性化设置.")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("服务接口")])]),t._v(" 是指 "),n("code",[t._v("链服务")]),t._v(" 和 "),n("code",[t._v("订单服务")]),t._v(" 为用户提供的用于使用服务以及访问用户数据的接口, 主要是指 "),n("code",[t._v("链服务")]),t._v(" 和 "),n("code",[t._v("订单服务")]),t._v(" 所对应的软件实体提供"),n("em",[t._v("RPC访问接口")]),t._v(".")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("用户数据隔离")])]),t._v(": 是指 "),n("code",[t._v("链服务")]),t._v(" 和 "),n("code",[t._v("订单服务")]),t._v(" 提供者限制用户只能访问和自己的 "),n("code",[t._v("用户数据")]),t._v(". 通过对 "),n("code",[t._v("服务接口")]),t._v(" 进行访问控制, 限制用户只能访问自己的 "),n("code",[t._v("用户数据")]),t._v(", 是实现 "),n("code",[t._v("用户数据隔离")]),t._v(" 的方式.")])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("用户权限")])]),t._v(": 是指 "),n("code",[t._v("链服务")]),t._v(" 和 "),n("code",[t._v("订单服务")]),t._v(" 控制用户访问 "),n("code",[t._v("服务接口")]),t._v(" 的权限级别的划分, 包括: "),n("code",[t._v("读权限")]),t._v(", "),n("code",[t._v("写权限")]),t._v(", "),n("code",[t._v("签名权限")]),t._v("等三个用户级别权限, 和一个管理员级别权限: "),n("code",[t._v("管理权限")]),t._v(". 一般来说,用户具有用户级别最高权限, 即 "),n("code",[t._v("签名权限")]),t._v(" , 但为了方便用户在不同使用情形下进行更加细致的访问控制, 用户可以申请更低权限级别的 "),n("code",[t._v("Token")]),t._v(", 比如: "),n("code",[t._v("读权限")]),t._v(" 或者 "),n("code",[t._v("写权限")]),t._v(". 只有管理员才能获得 "),n("code",[t._v("管理权限")]),t._v(". 访问不同的服务端口需要不同的权限级别, 详细参见 "),n("a",{attrs:{href:"https://venus.filecoin.io/zh/advanced/chain-api-v0.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("API Reference"),n("OutboundLink")],1)])]),t._v(" "),n("li",[n("p",[n("strong",[n("code",[t._v("用户界面")])]),t._v(" 是指用户能够用于访问 "),n("code",[t._v("服务接口")]),t._v(" 的软件或者其他类型的工具, 包括但不限于: "),n("code",[t._v("Democles")]),t._v(", "),n("code",[t._v("venus-wallet")]),t._v(", "),n("code",[t._v("market-client")]),t._v(", "),n("code",[t._v("venus-tool")]),t._v(" 等直接访问 "),n("code",[t._v("链服务")]),t._v(" 或者 "),n("code",[t._v("订单服务")]),t._v(" 服务的软件; 或者能够直接访问 "),n("code",[t._v("服务接口")]),t._v(" 的 "),n("em",[t._v("curl")]),t._v(" , 或者用户自己开发的工具.")])])]),t._v(" "),n("h2",{attrs:{id:"design-rationale-设计思路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#design-rationale-设计思路"}},[t._v("#")]),t._v(" Design Rationale (设计思路)")]),t._v(" "),n("p",[t._v("通过 "),n("code",[t._v("Token")]),t._v(" 区别不同用户身份, 以及访问级别. "),n("br"),t._v(" "),n("code",[t._v("服务接口")]),t._v(" 的实现中针对不同的 "),n("code",[t._v("用户身份")]),t._v(", 进行不同的处理, 从而实现 "),n("code",[t._v("用户数据隔离")]),t._v(".")]),t._v(" "),n("h2",{attrs:{id:"backwards-compatibility-兼容性"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility-兼容性"}},[t._v("#")]),t._v(" Backwards Compatibility（兼容性）")]),t._v(" "),n("h2",{attrs:{id:"test-cases-测试用例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#test-cases-测试用例"}},[t._v("#")]),t._v(" Test Cases (测试用例)")]),t._v(" "),n("h2",{attrs:{id:"security-considerations-安全考量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations-安全考量"}},[t._v("#")]),t._v(" Security Considerations (安全考量)")]),t._v(" "),n("ul",[n("li",[t._v("应确保只有管理员能够获取到 'admin' 级别的权限, 防止用户数据泄漏")])]),t._v(" "),n("h2",{attrs:{id:"implementation-实施"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#implementation-实施"}},[t._v("#")]),t._v(" Implementation（实施）")]),t._v(" "),n("h3",{attrs:{id:"用户身份识别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户身份识别"}},[t._v("#")]),t._v(" 用户身份识别")]),t._v(" "),n("p",[t._v("通过 "),n("code",[t._v("Token")]),t._v(" 获取用户身份")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("JwtUserFromToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tsks "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" strings"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Split")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("token"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"."')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("len")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fmt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"can\'t parse user from input token"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tdec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DecodeToBytes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("byte")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sks"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tpayload "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("JWTPayload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\terr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Unmarshal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" payload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("将用户名称注入到 "),n("code",[t._v("context")]),t._v(" 中")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("ctx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CtxWithName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CtxWithName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ctxWithString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" accountKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ctxWithString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" k CtxKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("WithValue")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" k"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" v"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("服务接口")]),t._v(" 中通过 "),n("code",[t._v("context")]),t._v(" 获取用户名称")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetCtxName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("accountKey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"目标数据的识别"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目标数据的识别"}},[t._v("#")]),t._v(" 目标数据的识别")]),t._v(" "),n("p",[t._v("仅仅只是知道 "),n("code",[t._v("用户身份")]),t._v(" 是不够的的, 我们还需要知道, 该用户访问的 "),n("code",[t._v("目标数据")]),t._v(" 是什么, 以及该"),n("code",[t._v("目标数据")]),t._v(" 是属于哪个 "),n("code",[t._v("用户")]),t._v(" 的. 例如, 一个 "),n("code",[t._v("用户")]),t._v(" 可能有多个 "),n("code",[t._v("矿工")]),t._v(", 但是他只能访问自己的 "),n("code",[t._v("矿工")]),t._v(" 的数据, 不能访问其他 "),n("code",[t._v("用户")]),t._v(" 的 "),n("code",[t._v("矿工")]),t._v(" 的数据.")]),t._v(" "),n("p",[t._v("绝大多数情况下,我们都可以通过 "),n("code",[t._v("用户")]),t._v(" 所访问的 "),n("code",[t._v("服务接口")]),t._v(" 来确定 "),n("code",[t._v("目标数据")]),t._v(" 的类型, 可以根据 "),n("code",[t._v("目标数据")]),t._v(" 类型中的 "),n("code",[t._v("关键字段")]),t._v(" 来确定 "),n("code",[t._v("目标数据")]),t._v(" 的归属. 例如当用户访问 消息相关的服务接口时, 可以通过 "),n("code",[t._v("消息类型")]),t._v(" 的发送者字段来确定该数据的拥有者是谁, 进而判断访问者是否具有该数据的访问权限.")]),t._v(" "),n("p",[t._v("在现在的实现中, 我们可以通过三种类型的 "),n("code",[t._v("关键数据")]),t._v(" , 来确定访问者是否具有访问 "),n("code",[t._v("目标数据")]),t._v(" 的权限:")]),t._v(" "),n("h4",{attrs:{id:"用户名称"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#用户名称"}},[t._v("#")]),t._v(" 用户名称")]),t._v(" "),n("p",[t._v("在用户管理相关的 "),n("code",[t._v("服务接口")]),t._v(" 中, 往往会出现 "),n("code",[t._v("用户名称")]),t._v(" 作为 "),n("code",[t._v("关键数据")]),t._v(" 的情况, 例如 "),n("code",[t._v("用户")]),t._v(" 的 "),n("code",[t._v("矿工")]),t._v(" 列表, "),n("code",[t._v("用户")]),t._v(" 的 "),n("code",[t._v("Signer")]),t._v(" 列表等. 通过 "),n("code",[t._v("用户名称")]),t._v(" 我们可以直接判断访问者是否具有访问该数据的权限.")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// checkPermissionByUser check weather the user has admin permission or is match the username passed in")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CheckPermissionByName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasPerm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PermAdmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tuser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CtxGetName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("exist "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" user "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ErrorPermissionDeny\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"钱包地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#钱包地址"}},[t._v("#")]),t._v(" 钱包地址")]),t._v(" "),n("p",[t._v("在和 "),n("code",[t._v("消息")]),t._v(" 有关联的 "),n("code",[t._v("服务接口")]),t._v(" 中, 往往会涉及到消息的发送者, 也就是签名该消息的钱包地址. 通过该地址, 我们可以判断该消息是否属于访问者的, 从而判断访问者是否具有访问该数据的权限.")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CheckPermissionBySigner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" client IAuthClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addrs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasPerm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PermAdmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tuser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CtxGetName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("exist "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ErrorUserNotFound\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" wAddr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" addrs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SignerExistInUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" wAddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" fmt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"check signer exist in user fail %s failed when check permission: %s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" wAddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ok "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ErrorPermissionDeny\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h4",{attrs:{id:"矿工地址"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#矿工地址"}},[t._v("#")]),t._v(" 矿工地址")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("func")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CheckPermissionByMiner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" client IAuthClient"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addrs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasPerm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Permission"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("PermAdmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\tuser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" exist "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CtxGetName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("exist "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ErrorUserNotFound\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("_")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mAddr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("range")]),t._v(" addrs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tok"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":=")]),t._v(" client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("MinerExistInUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mAddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" err "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" fmt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Errorf")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"check miner exist in user fail %s failed when check permission: %s"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mAddr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("String")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" err"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ok "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ErrorPermissionDeny\n\t\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\t"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("nil")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h3",{attrs:{id:"实现的细节"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#实现的细节"}},[t._v("#")]),t._v(" 实现的细节")]),t._v(" "),n("p",[t._v("本小节主要叙述在实际实现的过程中涉及到的 "),n("code",[t._v("服务接口")]),t._v(" 的变动. "),n("br"),t._v(" "),n("code",[t._v("venus")]),t._v(" 组件不涉及 "),n("code",[t._v("用户数据")]),t._v(", 不需要做相应变动."),n("br"),t._v(" "),n("code",[t._v("venus-gateway")]),t._v(" 涉及 "),n("code",[t._v("用户数据")]),t._v(" 部分的 "),n("code",[t._v("接口")]),t._v(" 仅对管理员开放, 不需要变动."),n("br"),t._v("\n所以, 主要涉及到一下四个 "),n("code",[t._v("云组件")]),t._v(" 的接口:")]),t._v(" "),n("h4",{attrs:{id:"venus-auth-接口"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#venus-auth-接口"}},[t._v("#")]),t._v(" "),n("code",[t._v("venus-auth")]),t._v(" 接口")]),t._v(" "),n("p",[n("code",[t._v("venus-auth")]),t._v(" 本身并无 "),n("code",[t._v("用户身份")]),t._v(" 和 "),n("code",[t._v("权限级别")]),t._v(" 的检查, 新增如下:")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Read 权限")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Verify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("JWTPayload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// read")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Admin 权限:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GenerateToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cp "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("JWTPayload"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Tokens")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" skip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" limit "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("TokenInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("TokenInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CreateUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("CreateUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("CreateUserResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("VerifyUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("VerifyUsersReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListUsers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ListUsersRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListUsersResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("HasUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("UpdateUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("gin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("DeleteUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecoverUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("gin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("RecoverUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetUserRateLimits")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("GetUserRateLimitsReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("GetUserRateLimitResponse"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpsertUserRateLimit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("UpsertUserRateLimitReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DelUserRateLimit")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("DelUserRateLimitReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasMiner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("HasMinerRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetUserByMiner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("GetUserByMinerRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OutputUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RegisterSigners")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("RegisterSignersReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UnregisterSigners")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("UnregisterSignersReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasSigner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("HasSignerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetUserBySigner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("GetUserBySignerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OutputUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpsertMiner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("UpsertMinerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Admin 权限 或者 目标数据拥有者 (意味着这部分接口会对部分非admin权限开放)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RemoveToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +tokenOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecoverToken")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" token "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +tokenOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetTokenByName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("c context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("TokenInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +tokenOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("GetUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("OutputUser"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +userOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("MinerExistInUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("MinerExistInUserRequest"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +userOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListMiners")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ListMinerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListMinerResp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +userOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DelMiner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("DelMinerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +minerOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SignerExistInUser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("SignerExistInUserReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +userOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListSigner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ListSignerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ListSignerResp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +userOwner")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DelSigner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" req "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("DelSignerReq"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// +signerOwner")]),t._v("\n")])])]),n("h4",{attrs:{id:"venus-miner"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#venus-miner"}},[t._v("#")]),t._v(" venus-miner")]),t._v(" "),n("p",[t._v("在非 "),n("code",[t._v("管理权限")]),t._v(" 的接口增加了"),n("code",[t._v("用户身份")]),t._v("的检查, 接口权限变动如下:")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MinerInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write -> admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("WarmupForMiner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("                                                         "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Start")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("                                                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Stop")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),t._v("                                                                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MinerInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                                        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("StatesForMining")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MinerState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("CountWinners")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" abi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ChainEpoch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" abi"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ChainEpoch"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("CountWinners"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("error")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n")])])]),n("h4",{attrs:{id:"venus-messager"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#venus-messager"}},[t._v("#")]),t._v(" venus-messager")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不需要用户隔离的接口(管理员级别的接口或者公开数据接口)")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetSharedParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SharedSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetLogLevel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" subsystem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" level "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SaveNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" node "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Node"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetSharedParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" name "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListMessageByAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListMessageByFromState")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" from address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MessageState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" isAsc "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("bool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pageIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pageSize "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("int")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateAllFilledMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RepublishMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("LogList")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write -> admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NetPeers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NetFindPeer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NetAddrListen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("NetConnect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateNonce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nonce "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasMessageByUid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 已经实现用户隔离的接口")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("HasAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetMessageByUnsignedCid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cid cid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetMessageByUid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetMessageBySignedCid")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cid cid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Cid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetMessageByFromAndNonce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" from address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nonce "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PushMessageWithId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" meta "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SendSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PushMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" msg "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Message"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" meta "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("SendSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("WalletHas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("WaitMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" confidence "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateMessageStateByID")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" state mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MessageState"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("UpdateFilledMessageByID")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetFeeParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("AddressSpec"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ReplaceMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ReplacMessageParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("RecoverFailedMsg")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("MarkBadMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" id "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MsgQueryParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListFailedMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListBlockedMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" d time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Duration"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("GetAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> read")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ForbiddenAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("DeleteAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ClearUnFillMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin ->write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ActiveAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin ->write")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("Send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" params mtypes"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("QuickSendParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> sign")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SetSelectMsgNum")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" addr address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" num "),n("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("uint64")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin -> write")]),t._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 参数变动")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ListMessage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Context "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("types"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("MsgQueryParams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),n("h4",{attrs:{id:"venus-market"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#venus-market"}},[t._v("#")]),t._v(" venus-market")]),t._v(" "),n("div",{staticClass:"language-go extra-class"},[n("pre",{pre:!0,attrs:{class:"language-go"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不需要做用户数据隔离的接口(开放数据)")]),t._v("\nPiecesListPieces "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nPiecesListCidInfos "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nPiecesGetPieceInfo "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nPiecesGetCIDInfo "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMessagerWaitMessage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMessagerGetMessage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nNetAddrsListen "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nID "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nResponseMarketEvent "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nListenMarketEvent "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nListPieceStorageInfos "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketListAsk "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketListRetrievalAsk "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 不对普通用户开放的接口 (管理员级别的接口)")]),t._v("\nMarketListDataTransfers "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\nMarketDataTransferUpdates "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\nMarketRestartDataTransfer "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\nMarketCancelDataTransfer "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read -> admin")]),t._v("\nImportV1Data "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nMarketPublishPendingDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDagstoreListShards "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDagstoreInitializeShard "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDagstoreRecoverShard "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDagstoreInitializeAll "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDagstoreInitializeStorage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDagstoreGC "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nAddFsPieceStorage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nAddS3PieceStorage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nRemovePieceStorage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 暂时不进行用户数据隔离的接口 ")]),t._v("\nMarketListRetrievalDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 进行用户数据隔离的接口")]),t._v("\nActorList "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nActorExist "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nActorSectorSize "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketListDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nMarketGetDealUpdates "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketListIncompleteDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketGetAsk "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nMarketGetRetrievalAsk "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nDealsConsiderOnlineStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsConsiderOnlineRetrievalDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsPieceCidBlocklist "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsConsiderOfflineStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsConsiderOfflineRetrievalDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsConsiderVerifiedStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsConsiderUnverifiedStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nSectorGetExpectedSealDuration "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsMaxStartDelay "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nDealsPublishMsgPeriod "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketMaxDealsPerPublishMsg "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nDealsMaxProviderCollateralMultiplier "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nDealsMaxPublishFee "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nMarketMaxBalanceAddFee "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nGetDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nGetUnPackedDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nPaychVoucherList "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nGetStorageDealStatistic "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\nGetRetrievalDealStatistic "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:read")]),t._v("\n\nMarketImportDealData "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nMarketImportPublishedDeal "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\n\nMarketPendingDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetConsiderOnlineStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetConsiderOnlineRetrievalDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetPieceCidBlocklist "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetConsiderOfflineStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetConsiderOfflineRetrievalDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetConsiderVerifiedStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetConsiderUnverifiedStorageDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nSectorSetExpectedSealDuration "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetMaxStartDelay "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\n\nDealsSetPublishMsgPeriod "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nMarketSetMaxDealsPerPublishMsg "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetMaxProviderCollateralMultiplier "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nDealsSetMaxPublishFee "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nMarketSetMaxBalanceAddFee "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nMessagerPushMessage "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nMarkDealsAsPacking "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nUpdateDealOnPacking "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nUpdateDealStatus "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nAssignUnPackedDeals "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\nUpdateStorageDealStatus "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:write")]),t._v("\n\nMarketAddBalance "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:sign")]),t._v("\nMarketGetReserved "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:sign")]),t._v("\nMarketReserveFunds "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:sign")]),t._v("\nMarketReleaseFunds "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:sign")]),t._v("\nMarketWithdraw "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:sign")]),t._v("\n\nMarketSetAsk "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nMarketSetRetrievalAsk "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nDealsImportData "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nOfflineDealImport "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nMarketDataTransferPath "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\nMarketSetDataTransferPath "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 被删除接口")]),t._v("\nImportV1Data "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//perm:admin")]),t._v("\n\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);