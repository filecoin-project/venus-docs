(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{444:function(e,v,a){"use strict";a.r(v);var t=a(17),s=Object(t.a)({},(function(){var e=this,v=e.$createElement,a=e._self._c||v;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h2",{attrs:{id:"nv16-各组件升级文档"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nv16-各组件升级文档"}},[e._v("#")]),e._v(" nv16 各组件升级文档")]),e._v(" "),a("h3",{attrs:{id:"时间线"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#时间线"}},[e._v("#")]),e._v(" 时间线")]),e._v(" "),a("p",[e._v("升级时间：2022-07-06T14:00:00Z，北京时间是 2022-07-06 22:00:00（周三）")]),e._v(" "),a("h3",{attrs:{id:"venus-auth"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-auth"}},[e._v("#")]),e._v(" venus-auth")]),e._v(" "),a("p",[e._v("tag: v1.6.0")]),e._v(" "),a("p",[e._v("影响功能：支持多个 miner 共享同一个 token 的功能")]),e._v(" "),a("p",[e._v("依赖升级组件：无")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("新增加一张 "),a("code",[e._v("miners")]),e._v(" 表，用于保存 "),a("code",[e._v("user")]),e._v(" 和 "),a("code",[e._v("miner")]),e._v(" 的对应关系")])]),e._v(" "),a("li",[a("p",[e._v("会把 "),a("code",[e._v("users")]),e._v(" 表每行数据的 "),a("code",[e._v("name")]),e._v(" 和 "),a("code",[e._v("miner")]),e._v(" 字段的值写入到 "),a("code",[e._v("miners")]),e._v(" 表中的 "),a("code",[e._v("user")]),e._v(" 和 "),a("code",[e._v("miner")]),e._v("字段，检查写入是否有问题，成功日志:migrate from:0, to:1 success；失败日志：migrate from store version:0 failed")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("./venus-auth user miner list <user>")]),e._v(" 可以查看每个用户绑定的 miner")])]),e._v(" "),a("li",[a("p",[e._v("使用命令 "),a("code",[e._v("./venus-auth user list")]),e._v("列出所有 user，"),a("strong",[e._v("确保被使用的 user 状态都为 enabled 状态")])])])]),e._v(" "),a("h3",{attrs:{id:"venus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus"}},[e._v("#")]),e._v(" venus")]),e._v(" "),a("p",[e._v("tag: v1.6.0")]),e._v(" "),a("p",[e._v("影响功能：支持 nv16 网络")]),e._v(" "),a("p",[e._v("依赖升级组件：无")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("升级后检查 vk 文件是否完整")])]),e._v(" "),a("li",[a("p",[e._v("升级后检查配置文件，升级高度是否正常设置，配置文件默认在 "),a("code",[e._v("~/.venus/config.json")]),e._v(" :")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# cali\n"upgradeSkyrHeight": 1044660\n# mainnet\n"upgradeSkyrHeight": 1960320\n')])])])]),e._v(" "),a("li",[a("p",[e._v("升级后需检查是否正常同步区块")])]),e._v(" "),a("li",[a("p",[e._v("api 版本发生变化，影响 miner 的连接")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('# 用 curl 命令测试接口 StateGetBeaconEntry、BeaconGetEntry，下面三个 curl 命令返回结果应该一样\ncurl http://127.0.0.1:3453/rpc/v0 -X POST -H "Content-Type: application/json" -H "Authorization: Bearer token" -d \'{"method": "Filecoin.BeaconGetEntry","params":[1933610], "id": 0}\'\ncurl http://127.0.0.1:3453/rpc/v1 -X POST -H "Content-Type: application/json" -H "Authorization: Bearer token" -d \'{"method": "Filecoin.BeaconGetEntry","params":[1933610], "id": 0}\'       \ncurl http://127.0.0.1:3453/rpc/v1 -X POST -H "Content-Type: application/json" -H "Authorization: Bearer token" -d \'{"method": "Filecoin.StateGetBeaconEntry","params":[1933610], "id": 0}\'\n')])])])]),e._v(" "),a("li",[a("p",[e._v("检查主网 v8 actors cid，确保与下面输出一样")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("./venus state actor-cids\n\n# 顺序可能会不一样\n_manifest         bafy2bzacebogjbpiemi7npzxchgcjjki3tfxon4ims55obfyfleqntteljsea  \naccount           bafk2bzacedudbf7fc5va57t3tmo63snmt3en4iaidv4vo3qlyacbxaa6hlx6y  \nstoragemarket     bafk2bzacediohrxkp2fbsl4yj4jlupjdkgsiwqb4zuezvinhdo2j5hrxco62q  \nstorageminer      bafk2bzacecgnynvd3tene3bvqoknuspit56canij5bpra6wl4mrq2mxxwriyu  \nmultisig          bafk2bzacebhldfjuy4o5v7amrhp5p2gzv2qo5275jut4adnbyp56fxkwy5fag  \npaymentchannel    bafk2bzacebalad3f72wyk7qyilvfjijcwubdspytnyzlrhvn73254gqis44rq  \nreward            bafk2bzacecwzzxlgjiavnc3545cqqil3cmq4hgpvfp2crguxy2pl5ybusfsbe  \nsystem            bafk2bzacedwq5uppsw7vp55zpj7jdieizirmldceehu6wvombw3ixq2tcq57w  \ncron              bafk2bzacecqb3eolfurehny6yp7tgmapib4ocazo5ilkopjce2c7wc2bcec62  \ninit              bafk2bzaceaipvjhoxmtofsnv3aj6gj5ida4afdrxa4ewku2hfipdlxpaektlw  \nstoragepower      bafk2bzacebjvqva6ppvysn5xpmiqcdfelwbbcxmghx5ww6hr37cgred6dyrpm  \nverifiedregistry  bafk2bzaceb3zbkjz3auizmoln2unmxep7dyfcmsre64vnqfhdyh7rkqfoxlw4\n")])])])]),e._v(" "),a("li",[a("p",[e._v("主网可以通过设置环境变量 "),a("code",[e._v("export VENUS_USE_FVM_TO_SYNC_MAINNET_V15=1")]),e._v(" 在 nv15 网络使用 fvm")])]),e._v(" "),a("li",[a("p",[e._v("若不排查问题，rust 日志级别"),a("strong",[e._v("不建议")]),e._v("设置为 "),a("code",[e._v("trace")]),e._v("，因为会打印较多日志")])]),e._v(" "),a("li",[a("p",[e._v("升级后可以通过命令来 "),a("code",[e._v("./venus state get-actor t01000")]),e._v(" 来确认是否升级成功")])])]),e._v(" "),a("h3",{attrs:{id:"venus-messager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-messager"}},[e._v("#")]),e._v(" venus-messager")]),e._v(" "),a("p",[e._v("tag:v1.6.0")]),e._v(" "),a("p",[e._v("影响功能：支持新的网络版本，新增主目录，默认在 "),a("code",[e._v("~/.venus-messager")])]),e._v(" "),a("p",[e._v("依赖升级组件：")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("升级后是否生成主目录 "),a("code",[e._v("~/.venus-messager")])])]),e._v(" "),a("li",[a("p",[e._v("升级后主目录应包含 "),a("code",[e._v("config.toml")]),e._v(" 和 "),a("code",[e._v("tipset.json")]),e._v("，"),a("code",[e._v("config.toml")]),e._v(" 应与启动 "),a("code",[e._v("messager")]),e._v(" 使用的配置文件内容一致，"),a("code",[e._v("~/.venus-messager/tipset.json")]),e._v(" 是由当前目录中的 "),a("code",[e._v("tipset.json")]),e._v(" 拷贝而来")])]),e._v(" "),a("li",[a("p",[e._v("升级成功后再次重启是读取的配置是"),a("code",[e._v("~/.venus-messager/config.toml")])])]),e._v(" "),a("li",[a("p",[e._v("能否正常收到消息和推送消息到节点")])])]),e._v(" "),a("h3",{attrs:{id:"venus-miner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-miner"}},[e._v("#")]),e._v(" venus-miner")]),e._v(" "),a("p",[e._v("tag: v1.6.0")]),e._v(" "),a("p",[e._v("影响功能：")]),e._v(" "),a("ol",[a("li",[e._v("获取 beacon 的接口名字 由 "),a("code",[e._v("BeaconGetEntry")]),e._v(" 改为 "),a("code",[e._v("StateGetBeaconEntry")])])]),e._v(" "),a("p",[e._v("依赖升级组件：venus,venus-auth,venus-gateway")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("ol",[a("li",[e._v("升级后常用命令 address state/list/update验证一遍.")]),e._v(" "),a("li",[e._v("如果用 mysql 数据库，检查下 miner_blocks 表中 parent_key 字段是 varchar(1000)")])]),e._v(" "),a("h3",{attrs:{id:"venus-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-gateway"}},[e._v("#")]),e._v(" venus-gateway")]),e._v(" "),a("p",[e._v("tag: v1.6.0")]),e._v(" "),a("p",[e._v("影响功能：修复没有自动清理超时的请求")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("ol",[a("li",[e._v("升级后 "),a("code",[e._v("wallet")]),e._v(" 是否重新注册上来")])]),e._v(" "),a("h3",{attrs:{id:"venus-market"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-market"}},[e._v("#")]),e._v(" venus-market")]),e._v(" "),a("p",[e._v("tag: v2.2.0")]),e._v(" "),a("p",[e._v("影响功能：")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("h3",{attrs:{id:"venus-wallet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-wallet"}},[e._v("#")]),e._v(" venus-wallet")]),e._v(" "),a("h4",{attrs:{id:"社区"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#社区"}},[e._v("#")]),e._v(" 社区")]),e._v(" "),a("p",[e._v("tag: v1.6.0")]),e._v(" "),a("p",[e._v("影响功能：")]),e._v(" "),a("p",[e._v("注意事项：")]),e._v(" "),a("ol",[a("li",[e._v("需要解锁钱包")]),e._v(" "),a("li",[e._v("是否注册到 gateway")])])])}),[],!1,null,null,null);v.default=s.exports}}]);