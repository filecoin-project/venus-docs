(window.webpackJsonp=window.webpackJsonp||[]).push([[132],{510:function(a,e,t){"use strict";t.r(e);var s=t(17),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"如何迁移离线订单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#如何迁移离线订单"}},[a._v("#")]),a._v(" 如何迁移离线订单")]),a._v(" "),t("p",[a._v("从"),t("code",[a._v("lotus")]),a._v(" 迁移到"),t("code",[a._v("venus")]),a._v("的时候，需要迁移已完成封装证明的订单和还没开始进行封装的离线订单。\n本文档主要介绍该过程中离线订单的迁移。")]),a._v(" "),t("h2",{attrs:{id:"前置条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前置条件"}},[a._v("#")]),a._v(" 前置条件")]),a._v(" "),t("p",[a._v("要完成离线订单的迁移，需要满足以下两个条件：")]),a._v(" "),t("ul",[t("li",[a._v("已经拥有一套带有"),t("code",[a._v("market")]),a._v("组件的"),t("code",[a._v("venus")]),a._v("链服务")]),a._v(" "),t("li",[a._v("已经将矿工账号迁入"),t("code",[a._v("venus")]),a._v("链服务")])]),a._v(" "),t("h2",{attrs:{id:"从lotus-miner导出离线订单"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#从lotus-miner导出离线订单"}},[a._v("#")]),a._v(" 从"),t("code",[a._v("lotus-miner")]),a._v("导出离线订单")]),a._v(" "),t("p",[a._v("迄至2022年7月，"),t("code",[a._v("lotus-miner")]),a._v("尚未提供直接导出订单详细信息的命令行工具，所以订单的导出需要用户直接访问"),t("code",[a._v("lotus-miner")]),a._v("的rpc服务接口来完成。\n可参考以下使用curl导出lotus-miner的离线订单的示例：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" http://127.0.0.1:2345/rpc/v0 -X POST "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Content-Type: application/json"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-H "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Authorization: Bearer <YOUR-TOKEN>"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n-d "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"method": "Filecoin.MarketListIncompleteDeals","params":[], "id": 0}\'')]),a._v("\n")])])]),t("p",[a._v("执行完命令后，你可能得到如下结果：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('{"jsonrpc":"2.0","result":[{"Proposal":{"PieceCID":{"/":"baga6ea4seaqcrddjqzqavqipgljq6jn3bmbnhzw5yucdmoqoji3tni6kisjqini"},"PieceSize":128,"VerifiedDeal":false,"Client":"t3r3nyp4sitvilwc5wggvrsyoqmue3zgliqsqzqxri5up2fmlx2e5xeltxv4qbokjj6qrdgz3t7zdwygogpjaa","Provider":"t01000","Label":"uAVUAHOi_meaYr-eUqOadpea1i-ivleeahOaVsOaNrgo","StartEpoch":173482,"EndEpoch":694737,"StoragePricePerEpoch":"0",\n......\n":"bafkqahhix6m6ngfp46kkrzu5uxtllc7iv6k6pgue42k3bzunvyfa"},"PieceCid":{"/":"baga6ea4seaqcrddjqzqavqipgljq6jn3bmbnhzw5yucdmoqoji3tni6kisjqini"},"PieceSize":127,"RawBlockSize":0},"AvailableForRetrieval":false,"DealID":0,"CreationTime":"2022-08-03T10:35:09.774748628+08:00","TransferChannelId":null,"SectorNumber":0,"InboundCAR":""}],"id":0}\n')])])]),t("p",[a._v("其中，"),t("code",[a._v("result")]),a._v("中的每一项都是一个订单的详细信息。每个订单中的"),t("code",[a._v("State")]),a._v("字段表征了当前订单的状态，如果"),t("code",[a._v("State")]),a._v("=18，表示当前订单处于"),t("code",[a._v("StorageDealWaitingForData")]),a._v("的状态，也就是离线订单暂时停留的一个状态，可以手动地将离线订单抽离出来，也可以将所有的订单都保留直接通过"),t("code",[a._v("venus-market")]),a._v("导入，它会排除掉非离线订单。"),t("br"),a._v("\n将要导入的订单信息保存到一个json文件中，就算是完成了离线订单导出。")]),a._v(" "),t("h2",{attrs:{id:"将离线订单导入到venus-market"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#将离线订单导入到venus-market"}},[a._v("#")]),a._v(" 将离线订单导入到"),t("code",[a._v("venus-market")])]),a._v(" "),t("p",[a._v("开始导入离线订单之前，先确认矿工账号是否在"),t("code",[a._v("venus")]),a._v("链服务中，如果不在，需要将矿工账号迁入"),t("code",[a._v("venus")]),a._v("链服务。")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./venus-market actor list\n")])])]),t("p",[a._v("确定完矿工之后，在"),t("code",[a._v("venus-market")]),a._v("中可以直接通过命令导入离线订单：")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("./venus-market storage-deals import-offlinedeal "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("DEALS-FILE"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" \n")])])]),t("p",[a._v("可以得到类似以下的结果：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("$ ./venus-market storage-deals import-offlinedeal offline-deals.json\nimport 4 deals, 1 deal success , 3 deal fail .\n")])])]),t("p",[a._v("加上"),t("code",[a._v("--verbose")]),a._v("（"),t("code",[a._v("-v")]),a._v("）标志，可以获取更加详细的执行信息：")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",[t("code",[a._v("$./venus-market storage-deals import-offlinedeal --verbose <DEAL-FILE> \n( 1 / 4 ) bafyreieb5uzq26rrvpp6cue34tuyz6xfrdgydxsul3u2fyez7wrnohoaye : fail : deal state StorageDealError not match StorageDealWaitingForData\n( 2 / 4 ) bafyreiergjl22fk5kfvxd3yopby62veeejhesuxzbmhsnoo7tp3mam6zzu : success\n( 3 / 4 ) bafyreig75z2tw2wz5qpign2r4773wugl6gf5fezo32dvucqnz3ftfajilu : fail : deal state StorageDealError not match StorageDealWaitingForData\n( 4 / 4 ) bafyreihdbazwk2zahpmpdhykyqrax6m5rkz472gvhfixfg5hse5ao4s6gq : fail : deal state StorageDealError not match StorageDealWaitingForData\nimport 4 deals, 1 deal success , 3 deal fail .\n")])])]),t("p",[a._v("至此，就已经完成了离线订单的导入。")])])}),[],!1,null,null,null);e.default=r.exports}}]);