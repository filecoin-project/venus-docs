(window.webpackJsonp=window.webpackJsonp||[]).push([[56],{447:function(v,a,e){"use strict";e.r(a);var t=e(17),_=Object(t.a)({},(function(){var v=this,a=v.$createElement,e=v._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("h1",{attrs:{id:"venus-各组件升级文档"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#venus-各组件升级文档"}},[v._v("#")]),v._v(" Venus 各组件升级文档")]),v._v(" "),e("h2",{attrs:{id:"注意事项"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[v._v("#")]),v._v(" 注意事项")]),v._v(" "),e("ol",[e("li",[v._v("所有组件全部更换")]),v._v(" "),e("li",[v._v("更新完通过 curl 命令调用 "),e("code",[v._v("Version")]),v._v(" 接口检查版本号，各组件接口调用方式：https://github.com/filecoin-project/venus/issues/5132")]),v._v(" "),e("li",[v._v("pre/pro消息上链的情况")]),v._v(" "),e("li",[v._v("WD消息上链的情况")]),v._v(" "),e("li",[v._v("出块情况是否正常")]),v._v(" "),e("li",[v._v("gas fee 相关设置是否生效")])]),v._v(" "),e("h2",{attrs:{id:"需要升级的组件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#需要升级的组件"}},[v._v("#")]),v._v(" 需要升级的组件")]),v._v(" "),e("table",[e("thead",[e("tr",[e("th",[v._v("组件名")]),v._v(" "),e("th",[v._v("tag")]),v._v(" "),e("th",[v._v("commit")])])]),v._v(" "),e("tbody",[e("tr",[e("td",[v._v("sophon-auth")]),v._v(" "),e("td",[v._v("v1.14.0")]),v._v(" "),e("td",[v._v("7caadbc")])]),v._v(" "),e("tr",[e("td",[v._v("venus")]),v._v(" "),e("td",[v._v("v1.14.0")]),v._v(" "),e("td",[v._v("45058a7")])]),v._v(" "),e("tr",[e("td",[v._v("sophon-messager")]),v._v(" "),e("td",[v._v("v1.14.0")]),v._v(" "),e("td",[v._v("e5f8371")])]),v._v(" "),e("tr",[e("td",[v._v("soohon-gateway")]),v._v(" "),e("td",[v._v("v1.14.0")]),v._v(" "),e("td",[v._v("1adf038")])]),v._v(" "),e("tr",[e("td",[v._v("venus-wallet")]),v._v(" "),e("td",[v._v("v1.14.0")]),v._v(" "),e("td",[v._v("b478cd0")])]),v._v(" "),e("tr",[e("td",[v._v("sophon-miner")]),v._v(" "),e("td",[v._v("v1.14.0")]),v._v(" "),e("td",[v._v("9ca976c")])]),v._v(" "),e("tr",[e("td",[v._v("droplet")]),v._v(" "),e("td",[v._v("v2.10.0")]),v._v(" "),e("td",[v._v("6daf168")])]),v._v(" "),e("tr",[e("td",[v._v("damocles-manager")]),v._v(" "),e("td",[v._v("v0.9.0")]),v._v(" "),e("td",[v._v("9f87e20")])]),v._v(" "),e("tr",[e("td",[v._v("damocles-worker")]),v._v(" "),e("td",[v._v("v0.9.0")]),v._v(" "),e("td",[v._v("9f87e20")])])])]),v._v(" "),e("h3",{attrs:{id:"升级顺序"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#升级顺序"}},[v._v("#")]),v._v(" 升级顺序")]),v._v(" "),e("ol",[e("li",[v._v("sophon-auth")]),v._v(" "),e("li",[v._v("venus")]),v._v(" "),e("li",[v._v("soohon-gateway")]),v._v(" "),e("li",[v._v("sophon-messager")]),v._v(" "),e("li",[v._v("sophon-miner")]),v._v(" "),e("li",[v._v("droplet")]),v._v(" "),e("li",[v._v("venus-wallet")]),v._v(" "),e("li",[v._v("damocles-manager")]),v._v(" "),e("li",[v._v("damocles-worker")])]),v._v(" "),e("h3",{attrs:{id:"sophon-auth"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sophon-auth"}},[v._v("#")]),v._v(" sophon-auth")]),v._v(" "),e("p",[v._v("影响功能：")]),v._v(" "),e("ul",[e("li",[v._v("其他组件对获取 auth 的服务")])]),v._v(" "),e("p",[v._v("依赖升级组件:  无")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("启动后能否正常鉴权")])]),v._v(" "),e("h3",{attrs:{id:"venus"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#venus"}},[v._v("#")]),v._v(" venus")]),v._v(" "),e("p",[v._v("影响功能：无")]),v._v(" "),e("p",[v._v("依赖升级组件:  sophon-auth")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("p",[v._v("编译：先 "),e("code",[v._v("make dist-clean")]),v._v(" 再 "),e("code",[v._v("make")]),v._v("，这样可以防止未能正常升级 "),e("code",[v._v("filecoin-ffi")]),v._v(" 而带来的问题\n"),e("strong",[v._v("如果 "),e("code",[v._v("~/.venus")]),v._v(" 存在且需要导入快照，需要先删除 "),e("code",[v._v("~/.venus/version")]),v._v(" 文件再导入快照")])]),v._v(" "),e("ol",[e("li",[e("p",[v._v("升级后检查vk文件是否完整")])]),v._v(" "),e("li",[e("p",[v._v("升级后执行命令 "),e("code",[v._v("./venus state network-info")]),v._v("，然后检查通过日志检查 UpgradeWatermelonHeight 是否正常:")]),v._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("# cali\nUpgradeWatermelonHeight: 1013134\n# mainnet\nUpgradeWatermelonHeight: 3469380\n")])])])]),v._v(" "),e("li",[e("p",[v._v("升级后需检查是否正常同步区块")])]),v._v(" "),e("li",[e("p",[v._v("检查主网 v12 actors code，确保与下面输出一样")]),v._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("./venus state actor-cids --network-version 21\n\n# 顺序可能会不一样\nNetwork Version: 21\nActor Version: 12\nActor             CID\ndatacap           bafk2bzacebpiwb2ml4qbnnaayxumtk43ryhc63exdgnhivy3hwgmzemawsmpq\nethaccount        bafk2bzaceb4gkau2vgsijcxpfuq33bd7w3efr2rrhxrwiacjmns2ntdiamswq\nreward            bafk2bzacealqnxn5lwzwexd6reav4dppypquklx2ujlnvaxiqk2tzstyvkp5u\nverifiedregistry  bafk2bzacedudgflxc75c77c6zkmfyq4u2xuk7k6xw6dfdccarjrvxx453b77q\neam               bafk2bzaceb3elj4hfbbjp7g5bptc7su7mptszl4nlqfedilxvstjo5ungm6oe\nmultisig          bafk2bzacecw5lyp3n3t67xdwrmo36h4z7afc3lobmmr6wg55w6yjzg5jhmh42\nstoragemarket     bafk2bzacedylkg5am446lcuih4voyzdn4yjeqfsxfzh5b6mcuhx4mok5ph5c4\nsystem            bafk2bzacebfqrja2hip7esf4eafxjmu6xcogoqu5xxtgdg7xa5szgvvdguchu\naccount           bafk2bzaceboftg75mdiba7xbo2i3uvgtca4brhnr3u5ptihonixgpnrvhpxoa\ncron              bafk2bzacechxjkfe2cehx4s7skj3wzfpzf7zolds64khrrrs66bhazsemktls\nplaceholder       bafk2bzacedfvut2myeleyq67fljcrw4kkmn5pb5dpyozovj7jpoez5irnc3ro\nstoragepower      bafk2bzacecsij5tpfzjpfuckxvccv2p3bdqjklkrfyyoei6lx5dyj5j4fvjm6\nevm               bafk2bzacecmnyfiwb52tkbwmm2dsd7ysi3nvuxl3lmspy7pl26wxj4zj7w4wi\ninit              bafk2bzacebllyegx5r6lggf6ymyetbp7amacwpuxakhtjvjtvoy2bfkzk3vms\npaymentchannel    bafk2bzacectv4cm47bnhga5febf3lo3fq47g72kmmp2xd5s6tcxz7hiqdywa4\nstorageminer      bafk2bzacedo75pabe4i2l3hvhtsjmijrcytd2y76xwe573uku25fi7sugqld6\n")])])])]),v._v(" "),e("li",[e("p",[v._v("若不排查问题，rust日志级别"),e("strong",[v._v("不建议")]),v._v("设置为 "),e("code",[v._v("trace")]),v._v("，因为会打印较多日志")])]),v._v(" "),e("li",[e("p",[v._v("升级后可以通过命令来 "),e("code",[v._v("./venus state get-actor t01000")]),v._v(" 来确认是否升级成功")])]),v._v(" "),e("li",[e("p",[v._v("actor 迁移")]),v._v(" "),e("p",[e("strong",[v._v("经测试本次预迁移时间在 20-30 分钟，正式迁移时间在 70 秒左右")])]),v._v(" "),e("div",{staticClass:"language- extra-class"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("预迁移高度是升级高度前 180 个高度：\npre-migration  开始：STARTING pre-migration  结束：COMPLETED pre-migration\nmigration      开始：STARTING migration      结束：COMPLETED migration\n")])])])])]),v._v(" "),e("h3",{attrs:{id:"sophon-gateway"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sophon-gateway"}},[v._v("#")]),v._v(" sophon-gateway")]),v._v(" "),e("p",[v._v("影响功能：无")]),v._v(" "),e("p",[v._v("依赖升级组件: sophon-auth")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("编译时,需要先 "),e("code",[v._v("make dist-clean")]),v._v(" 再 "),e("code",[v._v("make")])])]),v._v(" "),e("h3",{attrs:{id:"sophon-messager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sophon-messager"}},[v._v("#")]),v._v(" sophon-messager")]),v._v(" "),e("p",[v._v("影响功能：")]),v._v(" "),e("p",[v._v("依赖升级组件: venus, sophon-auth, soohon-gateway")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("升级之后需要观察能否正常接收消息, 消息能否正常上链")])]),v._v(" "),e("h3",{attrs:{id:"sophon-miner"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#sophon-miner"}},[v._v("#")]),v._v(" sophon-miner")]),v._v(" "),e("p",[v._v("影响功能：")]),v._v(" "),e("p",[v._v("依赖升级组件：auth, venus, gateway")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("配置文件中 [Auth].[Token] 必须配置，且在sophon-auth中具有admin权限，不要使用"),e("code",[v._v("defaultLocalToken")]),v._v("对应的token，应手动创建一个.")])]),v._v(" "),e("h3",{attrs:{id:"droplet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#droplet"}},[v._v("#")]),v._v(" droplet")]),v._v(" "),e("p",[v._v("影响功能：")]),v._v(" "),e("ul",[e("li",[v._v("支持 v2 版本发单协议")]),v._v(" "),e("li",[v._v("支持离线计算 commP")])]),v._v(" "),e("p",[v._v("依赖升级组件: auth, venus, gateway, messager")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("升级后能否正常发单和检索")])]),v._v(" "),e("h3",{attrs:{id:"venus-wallet"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#venus-wallet"}},[v._v("#")]),v._v(" venus-wallet")]),v._v(" "),e("p",[v._v("影响功能： 无")]),v._v(" "),e("p",[v._v("依赖升级组件: gateway")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("升级后观察是否正常签名，消息能否正常上链")])]),v._v(" "),e("h3",{attrs:{id:"damocles-manager"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#damocles-manager"}},[v._v("#")]),v._v(" damocles-manager")]),v._v(" "),e("p",[v._v("依赖升级组件: 链服务组件")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("编译时,需要先 "),e("code",[v._v("make dist-clean")]),v._v(" 再 "),e("code",[v._v("make")])])]),v._v(" "),e("h3",{attrs:{id:"damocles-worker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#damocles-worker"}},[v._v("#")]),v._v(" damocles-worker")]),v._v(" "),e("p",[v._v("依赖升级组件: damocles-manager")]),v._v(" "),e("p",[v._v("注意事项：")]),v._v(" "),e("ul",[e("li",[v._v("新的证明类型 SyntheticPoRep 会使用新的证明参数文件。 如果启用 SyntheticPoRep 最好提前准备好新的证明参数，"),e("strong",[v._v("证明参数有问题可能会导致 SyntheticPoRep 死锁")]),v._v("。")])]),v._v(" "),e("hr"),v._v(" "),e("p",[v._v("更新结果验证步骤:")]),v._v(" "),e("ol",[e("li",[v._v("程序启动正常")]),v._v(" "),e("li",[v._v("pre/pro消息正常上链")]),v._v(" "),e("li",[v._v("出块正常")]),v._v(" "),e("li",[v._v("WD上链正常")]),v._v(" "),e("li",[v._v("算力增长正常")]),v._v(" "),e("li",[v._v("真实订单检索正常")]),v._v(" "),e("li",[v._v("数据库各种gas，生命周期，聚合设置正常")])]),v._v(" "),e("h3",{attrs:{id:"数据库变更"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#数据库变更"}},[v._v("#")]),v._v(" 数据库变更")]),v._v(" "),e("ol",[e("li",[v._v("droplet "),e("code",[v._v("storage_deals")]),v._v(" 表增加 "),e("code",[v._v("id")]),v._v(" 字段 ==> "),e("code",[v._v("ALTER TABLE storage_deals ADD id varchar(128)")])])])])}),[],!1,null,null,null);a.default=_.exports}}]);