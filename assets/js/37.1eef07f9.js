(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{424:function(e,a,t){"use strict";t.r(a);var r=t(17),n=Object(r.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"venus-stack-nv23-upgrade-guide"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus-stack-nv23-upgrade-guide"}},[e._v("#")]),e._v(" Venus Stack nv23 Upgrade Guide")]),e._v(" "),t("h2",{attrs:{id:"precautions"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#precautions"}},[e._v("#")]),e._v(" Precautions")]),e._v(" "),t("ol",[t("li",[e._v("Upgrade all Venus products / components")]),e._v(" "),t("li",[e._v("Use the "),t("code",[e._v("curl")]),e._v(" command to call the "),t("code",[e._v("Version")]),e._v(" interface to check the version number after upgrading. Refer to the guide "),t("a",{attrs:{href:"https://github.com/filecoin-project/venus/issues/5132",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),t("OutboundLink")],1),e._v(" for details.")]),e._v(" "),t("li",[e._v("Check if pre/pro messages are on-chained")]),e._v(" "),t("li",[e._v("Check if windowPost messages are on-chained")]),e._v(" "),t("li",[e._v("Check if block producing is working correctly")]),e._v(" "),t("li",[e._v("Check if the gas fee related settings are in effect")])]),e._v(" "),t("h4",{attrs:{id:"it-is-recommended-not-to-perform-sealing-tasks-before-upgrading-if-p2-messages-are-on-chain-but-c2-messages-are-not-on-chain-before-upgrading-an-error-will-be-reported-when-c2-messages-are-on-chain-after-upgrading"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#it-is-recommended-not-to-perform-sealing-tasks-before-upgrading-if-p2-messages-are-on-chain-but-c2-messages-are-not-on-chain-before-upgrading-an-error-will-be-reported-when-c2-messages-are-on-chain-after-upgrading"}},[e._v("#")]),e._v(" It is recommended not to perform sealing tasks before upgrading. If p2 messages are on-chain but c2 messages are not on-chain before upgrading, an error will be reported when c2 messages are on-chain after upgrading.")]),e._v(" "),t("h2",{attrs:{id:"products-components-to-be-upgraded"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#products-components-to-be-upgraded"}},[e._v("#")]),e._v(" Products / Components to be Upgraded")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Component name")]),e._v(" "),t("th",[e._v("tag")]),e._v(" "),t("th",[e._v("commit")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("sophon-auth")]),e._v(" "),t("td",[e._v("v1.16.0")]),e._v(" "),t("td",[e._v("e2340d5")])]),e._v(" "),t("tr",[t("td",[e._v("venus")]),e._v(" "),t("td",[e._v("v1.16.0")]),e._v(" "),t("td",[e._v("3fdb199")])]),e._v(" "),t("tr",[t("td",[e._v("sophon-co")]),e._v(" "),t("td",[e._v("v0.9.0")]),e._v(" "),t("td",[e._v("0f344ed")])]),e._v(" "),t("tr",[t("td",[e._v("sophon-messager")]),e._v(" "),t("td",[e._v("v1.16.0")]),e._v(" "),t("td",[e._v("f695806")])]),e._v(" "),t("tr",[t("td",[e._v("soohon-gateway")]),e._v(" "),t("td",[e._v("v1.16.0")]),e._v(" "),t("td",[e._v("2d32b8e")])]),e._v(" "),t("tr",[t("td",[e._v("venus-wallet")]),e._v(" "),t("td",[e._v("v1.16.0")]),e._v(" "),t("td",[e._v("48b1e02")])]),e._v(" "),t("tr",[t("td",[e._v("sophon-miner")]),e._v(" "),t("td",[e._v("v1.16.0")]),e._v(" "),t("td",[e._v("500c186")])]),e._v(" "),t("tr",[t("td",[e._v("droplet")]),e._v(" "),t("td",[e._v("v2.12.0")]),e._v(" "),t("td",[e._v("deec963")])]),e._v(" "),t("tr",[t("td",[e._v("damocles-manager")]),e._v(" "),t("td",[e._v("v0.11.0")]),e._v(" "),t("td",[e._v("7d06bd4")])]),e._v(" "),t("tr",[t("td",[e._v("damocles-worker")]),e._v(" "),t("td",[e._v("v0.11.0")]),e._v(" "),t("td",[e._v("7d06bd4")])])])]),e._v(" "),t("h3",{attrs:{id:"upgrade-sequence"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-sequence"}},[e._v("#")]),e._v(" Upgrade Sequence")]),e._v(" "),t("ol",[t("li",[e._v("sophon-auth")]),e._v(" "),t("li",[e._v("venus")]),e._v(" "),t("li",[e._v("soohon-co")]),e._v(" "),t("li",[e._v("soohon-gateway")]),e._v(" "),t("li",[e._v("sophon-messager")]),e._v(" "),t("li",[e._v("sophon-miner")]),e._v(" "),t("li",[e._v("droplet")]),e._v(" "),t("li",[e._v("venus-wallet")]),e._v(" "),t("li",[e._v("damocles-manager")]),e._v(" "),t("li",[e._v("damocles-worker")])]),e._v(" "),t("h3",{attrs:{id:"sophon-auth"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-auth"}},[e._v("#")]),e._v(" sophon-auth")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("Aquiring auth services from other components")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("Check if authentication working normally after startup.")])]),e._v(" "),t("h3",{attrs:{id:"venus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus"}},[e._v("#")]),e._v(" Venus")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("sophon-auth")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("p",[e._v("Compile: First "),t("code",[e._v("make dist-clean")]),e._v(" and then "),t("code",[e._v("make")]),e._v(", this can prevent problems caused by failure to upgrade "),t("code",[e._v("filecoin-ffi")]),e._v(" properly.")]),e._v(" "),t("ol",[t("li",[t("p",[e._v("Check if the vk file is complete after upgrading")])]),e._v(" "),t("li",[t("p",[e._v("After the upgrade, execute the command "),t("code",[e._v("./venus state network-info")]),e._v(", and then check whether the UpgradeWaffleHeight is normal through the log:")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("#cali\nUpgradeWaffleHeight: 1779094\n#mainnet\nUpgradeWaffleHeight: 4154640\n")])])])]),e._v(" "),t("li",[t("p",[e._v("After the upgrade, you need to check if the blocks are synchronized normally.")])]),e._v(" "),t("li",[t("p",[e._v("Check the mainnet v14 actors code and make sure it is the same as the output below")]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("./venus state actor-cids --network-version 23\n\n# The order may be different\nNetwork Version: 23\nActor Version: 14\nManifest CID: bafy2bzacecbueuzsropvqawsri27owo7isa5gp2qtluhrfsto2qg7wpgxnkba\nActor             CID\naccount           bafk2bzacebr7ik7lng7vysm754mu5x7sakphwm4soqi6zwbox4ukpd6ndwvqy\ncron              bafk2bzacecwn6eiwa7ysimmk6i57i5whj4cqzwijx3xdlxwb5canmweaez6xc\ndatacap           bafk2bzacecidw7ajvtjhmygqs2yxhmuybyvtwp25dxpblvdxxo7u4gqfzirjg\neam               bafk2bzaced2cxnfwngpcubg63h7zk4y5hjwwuhfjxrh43xozax2u6u2woweju\nethaccount        bafk2bzacechu4u7asol5mpcsr6fo6jeaeltvayj5bllupyiux7tcynsxby7ko\nevm               bafk2bzacedupohbgwrcw5ztbbsvrpqyybnokr4ylegmk7hrbt3ueeykua6zxw\ninit              bafk2bzacecbbcshenkb6z2v4irsudv7tyklfgphhizhghix6ke5gpl4r5f2b6\nmultisig          bafk2bzaceajcmsngu3f2chk2y7nanlen5xlftzatytzm6hxwiiw5i5nz36bfc\npaymentchannel    bafk2bzaceavslp27u3f4zwjq45rlg6assj6cqod7r5f6wfwkptlpi6j4qkmne\nplaceholder       bafk2bzacedfvut2myeleyq67fljcrw4kkmn5pb5dpyozovj7jpoez5irnc3ro\nreward            bafk2bzacedvfnjittwrkhoar6n5xrykowg2e6rpur4poh2m572f7m7evyx4lc\nstoragemarket     bafk2bzaceaju5wobednmornvdqcyi6khkvdttkru4dqduqicrdmohlwfddwhg\nstorageminer      bafk2bzacea3f43rxzemmakjpktq2ukayngean3oo2de5cdxlg2wsyn53wmepc\nstoragepower      bafk2bzacedo6scxizooytn53wjwg2ooiawnj4fsoylcadnp7mhgzluuckjl42\nsystem            bafk2bzacecak4ow7tmauku42s3u2yydonk4hx6ov6ov542hy7lcbji3nhrrhs\nverifiedregistry  bafk2bzacebvyzjzmvmjvpypphqsumpy6rzxuugnehgum7grc6sv3yqxzrshb4\n")])])])]),e._v(" "),t("li",[t("p",[e._v("If you are not troubleshooting the system, it is not recommended to set the rust log level to "),t("code",[e._v("trace")]),e._v(" because more logs will be printed.")])]),e._v(" "),t("li",[t("p",[e._v("After the upgrade, you can use the command "),t("code",[e._v("./venus state get-actor t01000")]),e._v(" to confirm whether the upgrade is successful.")])]),e._v(" "),t("li",[t("p",[e._v("actor migration")]),e._v(" "),t("p",[t("strong",[e._v("After testing, the pre-migration time is about 1 minutes, and the main migration time is about 50 seconds")])]),e._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[e._v("The pre-migration height is 120 heights before the upgrade height:\npre-migration start: STARTING pre-migration end: COMPLETED pre-migration\nmigration starts: STARTING migration ends: COMPLETED migration\n")])])])]),e._v(" "),t("li",[t("p",[e._v("If "),t("code",[e._v("~/.venus")]),e._v(" exists and you need to import a snapshot, you need to delete the "),t("code",[e._v("~/.venus/version")]),e._v(" file first and then import the snapshot.")]),e._v(" "),t("ul",[t("li",[e._v("Mainnet: "),t("code",[e._v("./venus daemon --import-snapshot snapshot.car")])]),e._v(" "),t("li",[e._v("calibnet: "),t("code",[e._v("./venus daemon --import-snapshot snapshot.car --network calibrationnet")])])])])]),e._v(" "),t("h3",{attrs:{id:"sophon-gateway"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-gateway"}},[e._v("#")]),e._v(" sophon-gateway")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("sophon-auth")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("When compiling, you need to first "),t("code",[e._v("make dist-clean")]),e._v(" and then "),t("code",[e._v("make")])])]),e._v(" "),t("h3",{attrs:{id:"sophon-messager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-messager"}},[e._v("#")]),e._v(" sophon-messager")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("venus")]),e._v(" "),t("li",[e._v("sophon-auth")]),e._v(" "),t("li",[e._v("sophon-gateway")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("After the upgrade, you need to observe whether the messages can be received normally and whether the messages can be on-chained normally.")])]),e._v(" "),t("h3",{attrs:{id:"sophon-miner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-miner"}},[e._v("#")]),e._v(" sophon-miner")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("auth")]),e._v(" "),t("li",[e._v("venus")]),e._v(" "),t("li",[e._v("gateway")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("h3",{attrs:{id:"droplet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#droplet"}},[e._v("#")]),e._v(" droplet")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("auth")]),e._v(" "),t("li",[e._v("venus")]),e._v(" "),t("li",[e._v("gateway")]),e._v(" "),t("li",[e._v("messager")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("Check if deals and retrieval can be issued normally after the upgrade?")])]),e._v(" "),t("h3",{attrs:{id:"venus-wallet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus-wallet"}},[e._v("#")]),e._v(" venus-wallet")]),e._v(" "),t("p",[e._v("Affected functions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("gateway")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("After the upgrade, observe whether the signing is normal and whether the message can be on-chained normally.")])]),e._v(" "),t("h3",{attrs:{id:"damocles-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#damocles-manager"}},[e._v("#")]),e._v(" damocles-manager")]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("Sophon service")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("When compiling, you need to first "),t("code",[e._v("make dist-clean")]),e._v(" and then "),t("code",[e._v("make")])])]),e._v(" "),t("h3",{attrs:{id:"damocles-worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#damocles-worker"}},[e._v("#")]),e._v(" damocles-worker")]),e._v(" "),t("p",[e._v("Upgrade Dependency:")]),e._v(" "),t("ul",[t("li",[e._v("damocles-manager")])]),e._v(" "),t("p",[e._v("Precautions:")]),e._v(" "),t("ul",[t("li",[e._v("None")])]),e._v(" "),t("p",[e._v("Upgrade result verification steps:")]),e._v(" "),t("ol",[t("li",[e._v("Check if the program starts normally")]),e._v(" "),t("li",[e._v("Check if pre / pro messages are uploaded normally")]),e._v(" "),t("li",[e._v("Check if block producing is normal")]),e._v(" "),t("li",[e._v("Check if windowPost is normal")]),e._v(" "),t("li",[e._v("Check if storage power grows normally")]),e._v(" "),t("li",[e._v("Check if verified deal retrieval is normal")]),e._v(" "),t("li",[e._v("Check if various gas, sector life cycle, and aggregation settings in the database are normal.")])]),e._v(" "),t("h3",{attrs:{id:"database-changes"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#database-changes"}},[e._v("#")]),e._v(" Database changes")]),e._v(" "),t("ul",[t("li",[e._v("None")])])])}),[],!1,null,null,null);a.default=n.exports}}]);