(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{392:function(e,s,a){"use strict";a.r(s);var t=a(45),r=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"venus-worker用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-worker用法"}},[e._v("#")]),e._v(" Venus Worker用法")]),e._v(" "),a("p",[e._v("venus-worker配合venus-sealer用于在多个机器上部署，sealing过程分成4个过程AddPiece,PreCommit1, PreCommit2, Commit2,通过worker的设置可以在不同的机器上运行sealing的不同阶段，这样能够更灵活的部署程序，利用不同机器的优势。\n这里给出一个测试网络Worker的搭建流程。")]),e._v(" "),a("h2",{attrs:{id:"需求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#需求"}},[e._v("#")]),e._v(" 需求")]),e._v(" "),a("h3",{attrs:{id:"机器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#机器"}},[e._v("#")]),e._v(" 机器")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("192.168.1.151 用于文件挂载\n192.168.1.134 运行worker\n192.168.1.19  运行venus,venus-sealing,venus-miner\n")])])]),a("h3",{attrs:{id:"程序"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#程序"}},[e._v("#")]),e._v(" 程序")]),e._v(" "),a("p",[e._v("运行此worker测试流程需要一下几个程序。列出所需的项目地址，具体编译方式参考项目的README.md文件")]),e._v(" "),a("ol",[a("li",[e._v("venus "),a("a",{attrs:{href:"https://github.com/filecoin-project/venus",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/filecoin-project/venus"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("venus-sealer "),a("a",{attrs:{href:"https://github.com/filecoin-project/venus-sealer",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/filecoin-project/venus-sealer"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("venus-worker "),a("a",{attrs:{href:"https://github.com/filecoin-project/venus-sealer",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/filecoin-project/venus-sealer"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("venus-miner "),a("a",{attrs:{href:"https://github.com/filecoin-project/venus-miner",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/filecoin-project/venus-miner"),a("OutboundLink")],1)])]),e._v(" "),a("h2",{attrs:{id:"存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#存储"}},[e._v("#")]),e._v(" 存储")]),e._v(" "),a("p",[e._v("多机器运行需要共享存储，这里使用nfs来做共享存储。共享存储部署在192.168.1.151\n参考文档"),a("a",{attrs:{href:"https://docs.platform9.com/v5.0/openstack/tutorials-setup-nfs-server",target:"_blank",rel:"noopener noreferrer"}},[e._v("安装nfs"),a("OutboundLink")],1)]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("    yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" rpcbind nfs-utils\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" /nfs "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("&&")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("666")]),e._v(" /nfs\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"/nfs *(rw,sync,no_root_squash,no_subtree_check,insecure)"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" /etc/exports\n    exportfs  -rv\n    systemctl start rpcbind\n    systemctl start nfs\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" /var/lib/nfs/etab  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#检查nfs是否挂载成功")]),e._v("\n")])])]),a("h2",{attrs:{id:"创世节点搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创世节点搭建"}},[e._v("#")]),e._v(" 创世节点搭建")]),e._v(" "),a("p",[e._v("在机器192.168.1.19上运行创世节点，并且导入私钥用于矿工积累算计及挖矿过程中签名使用")]),e._v(" "),a("h3",{attrs:{id:"启动节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动节点"}},[e._v("#")]),e._v(" 启动节点")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\nvenus seed pre-seal --sector-size 2KiB --num-sectors 2\nvenus seed genesis new localnet.json\nvenus seed genesis add-miner localnet.json ~/.genesis-sectors/pre-seal-t01000.json\nvenus daemon --make-genesis=devgen.car --genesis-template=localnet.json --network 2k\n```\n")])])]),a("h3",{attrs:{id:"导入私钥"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入私钥"}},[e._v("#")]),e._v(" 导入私钥")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v(" venus wallet set-password   "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#此处需要输入密码并确定，成功后运行下面的命令")]),e._v("\n venus wallet "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("import")]),e._v(" ~/.genesis-sectors/pre-seal-t01000.key\n")])])]),a("h2",{attrs:{id:"启动venus-sealer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动venus-sealer"}},[e._v("#")]),e._v(" 启动venus-sealer")]),e._v(" "),a("p",[e._v("在机器192.168.1.19初始化并运行venus-sealer,运行后获取api及token用于worker和miner的配置")]),e._v(" "),a("h3",{attrs:{id:"挂载存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载存储"}},[e._v("#")]),e._v(" 挂载存储")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\nmkdir /nfs\nmount -t nfs 192.168.1.151:/nfs /nfs\n```\n")])])]),a("h3",{attrs:{id:"运行venus-sealer"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行venus-sealer"}},[e._v("#")]),e._v(" 运行venus-sealer")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\n#初始化sealer，这里不使用本地存储\nvenus-sealer init --genesis-miner --actor=t01000 --sector-size=2KiB --pre-sealed-sectors=~/.genesis-sectors --pre-sealed-metadata=~/.genesis-sectors/pre-seal-t01000.json --nosync --network 2k --no-local-storage\n\nvenus-sealer run --nosync\n```\n")])])]),a("h3",{attrs:{id:"attach存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attach存储"}},[e._v("#")]),e._v(" attach存储")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\n    ./venus-sealer storage attach --init --seal --store /nfs\n```\n")])])]),a("h3",{attrs:{id:"获取api地址及token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取api地址及token"}},[e._v("#")]),e._v(" 获取api地址及token")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\ncat ~/.venussealer/api\ncat ~/.venussealer/token\n```\n")])])]),a("h2",{attrs:{id:"配置venus-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置venus-worker"}},[e._v("#")]),e._v(" 配置venus-worker")]),e._v(" "),a("p",[e._v("在192.168.1.134里面初始化并运行venus-worker")]),e._v(" "),a("h3",{attrs:{id:"挂载存储-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂载存储-2"}},[e._v("#")]),e._v(" 挂载存储")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\nmkdir /nfs\nmount -t nfs 192.168.1.151:/nfs /nfs\n```\n")])])]),a("h3",{attrs:{id:"运行venus-worker"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行venus-worker"}},[e._v("#")]),e._v(" 运行venus-worker")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 使用上面得到的sealer的api及token")]),e._v("\n./venus-worker run --no-local-storage --miner-addr /ip4/127.0.0.1/tcp/2345/http --miner-token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.gcqF6Pkm4bwGXzEx83NR7h8WPliEihJ3GyUKvhKryAQ\n")])])]),a("h3",{attrs:{id:"attach存储-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#attach存储-2"}},[e._v("#")]),e._v(" attach存储")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v("```sh\n    ./venus-worker storage attach  /nfs\n```\n")])])]),a("h3",{attrs:{id:"检查是否正常"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#检查是否正常"}},[e._v("#")]),e._v(" 检查是否正常")]),e._v(" "),a("p",[e._v("运行"),a("code",[e._v("./venus-sealer sealing workers")]),e._v(", 得到类似下面的结果")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("Worker 8c814d19-ec36-4090-a03b-d4bc9314b39a, host lijunlongdeMacBook-Pro.local\n        CPU:  [                                                                ] 0/12 core(s) in use\n        RAM:  [||||||||||||||||||||||||||||||||||||||||||||                    ] 69% 11.13 GiB/16 GiB\n        VMEM: [|||||||||||||||||||||||||||||||||||||||                         ] 61% 11.13 GiB/18 GiB\nWorker a89d4156-d23e-44e6-b74b-8405e9496db0, host lijunlongdeMacBook-Pro.local\n        CPU:  [                                                                ] 0/12 core(s) in use\n        RAM:  [||||||||||||||||||||||||||||||||||||||||                        ] 63% 10.12 GiB/16 GiB\n        VMEM: [|||||||||||||||||||||||||||||||||||                             ] 56% 10.12 GiB/18 GiB\n\n")])])]),a("p",[e._v("运行"),a("code",[e._v("./venus-sealer storage list")]),e._v(", 得到类似下面的结果")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("7c046ce2-051f-4531-aa4d-76c1cd728acb:\n        [######                                            ] 257.7 GiB/1.998 TiB 12%\n        Unsealed: 0; Sealed: 17; Caches: 17; Reserved: 0 B\n        Weight: 10; Use: Seal Store\n        Local: /nfs\n        URL: http://127.0.0.1:2345/remote\n        URL: http://127.0.0.1:3456/remote\n\n1dcfda12-fb3d-413c-b626-caf8b87e3b97:\n        [#############################                     ] 136.4 GiB/233.5 GiB 58%\n        Unsealed: 0; Sealed: 2; Caches: 2; Reserved: 0 B\n        Use: ReadOnly   Local: /Users/lijunlong/.genesis-sectors\n        URL: http://127.0.0.1:2345/remote\n\n")])])]),a("h2",{attrs:{id:"启动venus-miner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动venus-miner"}},[e._v("#")]),e._v(" 启动venus-miner")]),e._v(" "),a("p",[e._v("初始化并运行miner")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("./venus-miner init --actor t01000 --listen-api /ip4/127.0.0.1/tcp/2345/http --token eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJBbGxvdyI6WyJyZWFkIiwid3JpdGUiLCJzaWduIiwiYWRtaW4iXX0.gcqF6Pkm4bwGXzEx83NR7h8WPliEihJ3GyUKvhKryAQ --sector-size 2048\n\n./venus-miner run --nosync\n")])])]),a("h2",{attrs:{id:"pledge算力"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pledge算力"}},[e._v("#")]),e._v(" pledge算力")]),e._v(" "),a("p",[e._v("在venus-sealer运行"),a("code",[e._v("venus-sealer sectors pledge")]),e._v("命令进行算力积累. 运行"),a("code",[e._v("venus-sealer sectors list")]),e._v("查看sealing的进行状态。")])])}),[],!1,null,null,null);s.default=r.exports}}]);