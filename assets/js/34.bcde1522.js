(window.webpackJsonp=window.webpackJsonp||[]).push([[34],{417:function(e,t,a){"use strict";a.r(t);var n=a(17),v=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"venus-nv19-upgrade-guide"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-nv19-upgrade-guide"}},[e._v("#")]),e._v(" Venus nv19 Upgrade Guide")]),e._v(" "),a("h2",{attrs:{id:"precautions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#precautions"}},[e._v("#")]),e._v(" Precautions")]),e._v(" "),a("ol",[a("li",[e._v("Upgrade all Venus products")]),e._v(" "),a("li",[e._v("After upgrading, use the "),a("code",[e._v("curl")]),e._v(" command to call "),a("code",[e._v("version")]),e._v(" interface to check the version number; Interfaces of each Venus component can be referred "),a("a",{attrs:{href:"https://github.com/filecoin-project/venus/issues/5132",target:"_blank",rel:"noopener noreferrer"}},[e._v("here"),a("OutboundLink")],1)]),e._v(" "),a("li",[e._v("Check Pre/Pro messages on-chain status")]),e._v(" "),a("li",[e._v("Check wdPost message on-chain status")]),e._v(" "),a("li",[e._v("Check whether the block production is normal")]),e._v(" "),a("li",[e._v("Check whether the gas fee related settings are in effect in accordance to configuration")])]),e._v(" "),a("h2",{attrs:{id:"components-that-need-to-be-upgraded"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#components-that-need-to-be-upgraded"}},[e._v("#")]),e._v(" Components that Need to be Upgraded")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("component name")]),e._v(" "),a("th",[e._v("tag")]),e._v(" "),a("th",[e._v("commit")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("venus-auth")]),e._v(" "),a("td",[e._v("v1.11.0")]),e._v(" "),a("td",[e._v("0c30588")])]),e._v(" "),a("tr",[a("td",[e._v("venus")]),e._v(" "),a("td",[e._v("v1.11.0")]),e._v(" "),a("td",[e._v("afd3d47")])]),e._v(" "),a("tr",[a("td",[e._v("venus-messager")]),e._v(" "),a("td",[e._v("v1.11.0")]),e._v(" "),a("td",[e._v("e4c4ab4")])]),e._v(" "),a("tr",[a("td",[e._v("venus-gateway")]),e._v(" "),a("td",[e._v("v1.11.0")]),e._v(" "),a("td",[e._v("877a851")])]),e._v(" "),a("tr",[a("td",[e._v("venus-wallet")]),e._v(" "),a("td",[e._v("v1.11.0")]),e._v(" "),a("td",[e._v("7afa1eb")])]),e._v(" "),a("tr",[a("td",[e._v("venus-miner")]),e._v(" "),a("td",[e._v("v1.11.0")]),e._v(" "),a("td",[e._v("a30f342")])]),e._v(" "),a("tr",[a("td",[e._v("venus-market")]),e._v(" "),a("td",[e._v("v2.7.0")]),e._v(" "),a("td",[e._v("61f2cb5")])]),e._v(" "),a("tr",[a("td",[e._v("venus-sector-manager")]),e._v(" "),a("td",[e._v("v0.6.0-rc3")]),e._v(" "),a("td",[e._v("134b502")])]),e._v(" "),a("tr",[a("td",[e._v("venus-worker")]),e._v(" "),a("td",[e._v("no upgrade required")]),e._v(" "),a("td",[e._v("-")])])])]),e._v(" "),a("h3",{attrs:{id:"upgrade-order"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-order"}},[e._v("#")]),e._v(" Upgrade order")]),e._v(" "),a("ol",[a("li",[e._v("venus-auth")]),e._v(" "),a("li",[e._v("Venus")]),e._v(" "),a("li",[e._v("venus-gateway")]),e._v(" "),a("li",[e._v("venus-messager")]),e._v(" "),a("li",[e._v("venus-miner")]),e._v(" "),a("li",[e._v("venus-market")]),e._v(" "),a("li",[e._v("venus-wallet-pro")]),e._v(" "),a("li",[e._v("venus-sector-manager")])]),e._v(" "),a("h3",{attrs:{id:"venus-auth"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-auth"}},[e._v("#")]),e._v(" venus-auth")]),e._v(" "),a("p",[e._v("Affected function:")]),e._v(" "),a("ul",[a("li",[e._v("updated way for other components to obtain auth services")])]),e._v(" "),a("p",[e._v("Dependency upgrade components: None")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[e._v('Use "--disable-perm-check" at startup to temporarily disable the feature of auth interface protection')]),e._v(" "),a("li",[e._v("Before creating a token, you need to create the corresponding user")])]),e._v(" "),a("p",[e._v("Note:")]),e._v(" "),a("ul",[a("li",[e._v('The new version of auth will automatically generate a token named "defaultLocalToken" when it starts, which is used for authentication when auth-cli executes commands')])]),e._v(" "),a("h3",{attrs:{id:"venus"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus"}},[e._v("#")]),e._v(" venus")]),e._v(" "),a("p",[e._v("Affected function: none")]),e._v(" "),a("p",[e._v("Dependency upgrade component: venus-auth")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("p",[e._v("Compilation: first "),a("code",[e._v("make dist-clean")]),e._v(" and then "),a("code",[e._v("make")]),e._v(", this can prevent problems caused by failing to upgrade "),a("code",[e._v("filecoin-ffi")]),e._v(" normally")]),e._v(" "),a("p",[a("strong",[e._v("Should use "),a("code",[e._v("--auth-token")]),e._v(" flag when starting, or modify configuration file "),a("code",[e._v("api.venusAuthToken")]),e._v(" configuration item")])]),e._v(" "),a("ol",[a("li",[a("p",[e._v("Check whether the vk file is complete after upgrading")])]),e._v(" "),a("li",[a("p",[e._v("Check the configuration file after the upgrade; check whether "),a("code",[e._v("UpgradeLightningHeight")]),e._v(" and "),a("code",[e._v("UpgradeThunderHeight")]),e._v(" are normal through the log:")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#cali\nUpgradeLightningHeight: 489094\nUpgradeThunderHeight:489094+3120\n#mainnet\nUpgradeLightningHeight: 2809800\nUpgradeThunderHeight: 2809800 + 2880*21 = 2870280\n")])])])]),e._v(" "),a("li",[a("p",[e._v("After the upgrade, check whether the chain is synchronized normally")])]),e._v(" "),a("li",[a("p",[e._v("Check the mainnet v11 actors code to make sure it is the same as the output below")])])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("./venus state actor-cids --network-version 19\n\n# order may vary\nNetwork Version: 19\nActor Version: 11\nActor CIDs\nreward bafk2bzacebwjw2vxkobs7r2kwjdqqb42h2kucyuk6flbnyzw4odg5s4mogamo\nsystem bafk2bzaced7npe5mt5nh72jxr2igi2sofoa7gedt4w6kueeke7i3xxugqpjfm\neam bafk2bzaceaelwt4yfsfvsu3pa3miwalsvy3cfkcjvmt4sqoeopsppnrmj2mf2\ncron bafk2bzacebpewdvvgt6tk2o2u4rcovdgym67tadiis5usemlbejg7k3kt567o\ndatacap bafk2bzacebslykoyrb2hm7aacjngqgd5n2wmeii2goadrs5zaya3pvdf6pdnq\nethaccount bafk2bzaceclkmc4yidxc6lgcjpfypbde2eddnevcveo4j5kmh4ek6inqysz2k\nevm bafk2bzacediwh6etwzwmb5pivtclpdplewdjzphouwqpppce6opisjv2fjqfe\ninit bafk2bzaceckwf3w6n2nw6eh77ktmsxqgsvshonvgnyk5q5syyngtetxvasfxg\nmultisig bafk2bzaceafajceqwg5ybiz7xw6rxammuirkgtuv625gzaehsqfprm4bazjmk\npaymentchannel bafk2bzaceb4e6cnsnviegmqvsmoxzncruvhra54piq7bwiqfqevle6oob2gvo\naccount bafk2bzacealnlr7st6lkwoh6wxpf2hnrlex5sknaopgmkr2tuhg7vmbfy45so\nstorageminer bafk2bzacec24okjqrp7c7rj3hbrs5ez5apvwah2ruka6haesgfngf37mhk6us\nstoragepower bafk2bzaceaxgloxuzg35vu7l7tohdgaq2frsfp4ejmuo7tkoxjp5zqrze6sf4\nplaceholder bafk2bzacedfvut2myeleyq67fljcrw4kkmn5pb5dpyozovj7jpoez5irnc3ro\nverified registry bafk2bzacedej3dnr62g2je2abmyjg3xqv4otvh6e26du5fcrhvw7zgcaaez3a\nstoragemarket bafk2bzaceazu2j2zu4p24tr22btnqzkhzjvyjltlvsagaj6w3syevikeb5d7m\n")])])]),a("ol",{attrs:{start:"5"}},[a("li",[a("p",[e._v("If not troubleshooting, the rust log level "),a("strong",[e._v("not recommended")]),e._v(" is set to "),a("code",[e._v("trace")]),e._v(", because more logs will be printed")])]),e._v(" "),a("li",[a("p",[e._v("After the upgrade, you can use the command "),a("code",[e._v("./venus state get-actor t01000")]),e._v(" to confirm whether the upgrade is successful")])]),e._v(" "),a("li",[a("p",[e._v("Actor Migration")])])]),e._v(" "),a("p",[a("strong",[e._v("Through testing, the pre-migration time is about 80 seconds, and the mainnet migration time should be about 60 seconds")])]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[e._v(" ```\n # The pre-migration height is 120 heights before the upgrade height: 2809800 - 120 = 2809680\n Pre-migration start: STARTING pre-migration end: COMPLETED pre-migration\n migration start: STARTING migration end: COMPLETED migration\n ```\n")])])]),a("h3",{attrs:{id:"venus-gateway"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-gateway"}},[e._v("#")]),e._v(" venus-gateway")]),e._v(" "),a("p",[e._v("Affected function: none")]),e._v(" "),a("p",[e._v("Dependency upgrade component: venus-auth")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[e._v("When compiling, you need to "),a("code",[e._v("make dist-clean")]),e._v(" first and then "),a("code",[e._v("make")])]),e._v(" "),a("li",[e._v("When starting, you should use the "),a("code",[e._v("--auth-token")]),e._v(" flag, or set the configuration item directly in the configuration: "),a("code",[e._v("AuthConfig.Token")])]),e._v(" "),a("li",[e._v("Remove flag: "),a("code",[e._v("--disable-address-verify")]),e._v(", "),a("strong",[e._v("Check if the startup command is still using this flag when upgrading")])])]),e._v(" "),a("h3",{attrs:{id:"venus-messager"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-messager"}},[e._v("#")]),e._v(" venus-messager")]),e._v(" "),a("p",[e._v("Affected function:")]),e._v(" "),a("ul",[a("li",[e._v("message replace")]),e._v(" "),a("li",[e._v("list --block command")])]),e._v(" "),a("p",[e._v("Dependency upgrade components: venus, venus-auth, venus-gateway")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[e._v("When starts for the first time during the upgrade, use the "),a("code",[e._v("auth-token")]),e._v(" falg, or modify the configuration file "),a("code",[e._v("JWTConfig.Token")]),e._v(" configuration item first")]),e._v(" "),a("li",[e._v("After the upgrade, it is necessary to observe whether the message can be received normally and whether the message can be sent to the chain normally")])]),e._v(" "),a("p",[e._v("Note:")]),e._v(" "),a("ul",[a("li",[e._v("The minimum value of the replace fee coefficient has been reduced from 1.25 to 1.11")]),e._v(" "),a("li",[e._v("When listing blocked messages, "),a("code",[e._v("unfill")]),e._v(" status messages will now also be listed as blocked messages")])]),e._v(" "),a("h3",{attrs:{id:"venus-miner"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-miner"}},[e._v("#")]),e._v(" venus-miner")]),e._v(" "),a("p",[e._v("Affected function:")]),e._v(" "),a("ul",[a("li",[e._v("Added timeout mechanism for selecting message")])]),e._v(" "),a("p",[e._v("Dependency upgrade component: auth, venus, gateway")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("[Auth].[Token]")]),e._v(" must be configured in the configuration file, and has "),a("code",[e._v("admin")]),e._v(" permission in venus-auth, do not use the token from "),a("code",[e._v("defaultLocalToken")]),e._v(", you need to manually create one.")])]),e._v(" "),a("h3",{attrs:{id:"venus-market"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-market"}},[e._v("#")]),e._v(" venus-market")]),e._v(" "),a("p",[e._v("Affected function:")]),e._v(" "),a("ul",[a("li",[e._v("Added and adjusted some commands")])]),e._v(" "),a("p",[e._v("Dependency upgrade components: auth, venus, gateway, messager")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[e._v("You must use "),a("code",[e._v("cs-token")]),e._v(" when starting, or modify the configuration item "),a("code",[e._v("AuthNode.Token")])])]),e._v(" "),a("h3",{attrs:{id:"venus-wallet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-wallet"}},[e._v("#")]),e._v(" venus-wallet")]),e._v(" "),a("p",[e._v("Affected function: none")]),e._v(" "),a("p",[e._v("Dependency upgrade component: gateway")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[e._v("After the upgrade, observe whether the signature is normal and whether the message can be sent to the chain normally")]),e._v(" "),a("li",[a("code",[e._v("wallet new")]),e._v(", "),a("code",[e._v("import")]),e._v(", and "),a("code",[e._v("export")]),e._v(" commands have been removed. The purpose of deletion is to avoid misuse.")])]),e._v(" "),a("h3",{attrs:{id:"venus-sector-manger"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#venus-sector-manger"}},[e._v("#")]),e._v(" venus-sector-manger")]),e._v(" "),a("p",[e._v("Affected features: fip-0061 wdpost algorithm changes")]),e._v(" "),a("p",[e._v("Dependency upgrade component: Chain Service component")]),e._v(" "),a("p",[e._v("Precautions:")]),e._v(" "),a("ul",[a("li",[e._v("When compiling, you need to "),a("code",[e._v("make dist-clean")]),e._v(" first and then "),a("code",[e._v("make")])])]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("Upgrade verification:")]),e._v(" "),a("ol",[a("li",[e._v("The program starts normally")]),e._v(" "),a("li",[e._v("Pre/Pro messages are on-chained normally")]),e._v(" "),a("li",[e._v("Block generation is normal")]),e._v(" "),a("li",[e._v("WdPost on-chain is normal")]),e._v(" "),a("li",[e._v("Storage power is increasing normally")]),e._v(" "),a("li",[e._v("Verified deal retrieval is normal")]),e._v(" "),a("li",[e._v("Various gas, life cycle, database and aggregation settings are normal")])]),e._v(" "),a("h3",{attrs:{id:"notes-on-database-changes"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#notes-on-database-changes"}},[e._v("#")]),e._v(" Notes on Database Changes")]),e._v(" "),a("ol",[a("li",[a("p",[a("a",{attrs:{href:"https://github.com/filecoin-project/venus/issues/5558",target:"_blank",rel:"noopener noreferrer"}},[e._v("venus-messager added actor configuration and related commands, and adds "),a("code",[e._v("actor_cfg")]),e._v(" table"),a("OutboundLink")],1)])]),e._v(" "),a("li",[a("p",[e._v("Added index to venus-market "),a("code",[e._v("storage_deals")]),e._v(" table: "),a("code",[e._v("CREATE INDEX idx_cdpprovider_state ON storage_deals(cdp_provider,state)")])])])])])}),[],!1,null,null,null);t.default=v.exports}}]);