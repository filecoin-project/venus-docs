(window.webpackJsonp=window.webpackJsonp||[]).push([[172],{554:function(t,e,s){"use strict";s.r(e);var n=s(17),a=Object(n.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h2",{attrs:{id:"simple-summary-概述"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#simple-summary-概述"}},[t._v("#")]),t._v(" Simple Summary / 概述")]),t._v(" "),s("p",[t._v("Metrics for montoring general health of Venus system.")]),t._v(" "),s("h2",{attrs:{id:"abstract-功能简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#abstract-功能简介"}},[t._v("#")]),t._v(" Abstract / 功能简介")]),t._v(" "),s("p",[t._v("Metrics provides the toolbox for SP to minimize the impact of their operation errors, to get to see if winidowPost messages get properly sent out in time, to monitor time/latency for PoST computation and much more so that SPs do not get punished by the protocol unintentionally.")]),t._v(" "),s("ul",[s("li",[t._v("Live heart beat map of all critical information of your storage system")]),t._v(" "),s("li",[t._v("Lower protocol penalties from mechanics such as PCD, PoST slashes, missing block etc")]),t._v(" "),s("li",[t._v("Easy integration with third party monitoring solution")])]),t._v(" "),s("h2",{attrs:{id:"motivation-来源和背景"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#motivation-来源和背景"}},[t._v("#")]),t._v(" Motivation / 来源和背景")]),t._v(" "),s("p",[t._v("One of the issues that new SPs or even many veteran SPs facing everyday when they on-board loads of sectors is getting a clear picture of the heartbeat for their storage system to diagnose whatever has gone wrong in their pipeline. A thousand things could go wrong when moving sectors through SP’s storage systems such as chain head out of sync, messages stuck in mpool, missing block producing round, high API latency and etc. SPs have to navigate through these anomalies all the time and be quick to response to these conditions.")]),t._v(" "),s("p",[t._v("This is where Data Onboarding Metrics for Venus Filecoin comes into play. We propose to build a series of critical metrics for each component of Venus Filecoin to reflect the live health of a storage system so that operators could have better knowledge of what’s going with their systems and then could better react to different situations instead of relying on guessing, digging through tons of logs or overly extensive dev-ops experience.")]),t._v(" "),s("h2",{attrs:{id:"specification-spec"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#specification-spec"}},[t._v("#")]),t._v(" Specification / Spec")]),t._v(" "),s("p",[t._v("venus-miner")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// latency for GetBaseInfo API")]),t._v("\nGetBaseInfoDuration   "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Milliseconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// latency for ComputeTicket API")]),t._v("\nComputeTicketDuration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Milliseconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// latency for IsRoundWinner API")]),t._v("\nIsRoundWinnerDuration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Milliseconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// latency for ComputeProof API")]),t._v("\nComputeProofDuration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Seconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// number of block produced")]),t._v("\nNumberOfBlock "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// number of rounds that miner_id is winner")]),t._v("\nNumberOfIsRoundWinner "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("venus-messager")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Below metrics are updated on a per wallet address granularity ")]),t._v("\nWalletBalance  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nWalletDBNonce "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nWalletChainNonce "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current number of messages that are waiting for venus-messager to fill out parameters like signature, gas usage, nonce etc.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This metric is updated on a per wallet address granularity ")]),t._v("\nNumOfUnFillMsg "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current number of messages that venus-messager has filled out parameters like signature, gas usage, nonce etc.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This metric is updated on a per wallet address granularity ")]),t._v("\nNumOfFillMsg  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current number of messages that venus-messager has failed to fill out parameters like signature, gas usage, nonce etc.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// This metric is updated on a per wallet address granularity ")]),t._v("\nNumOfFailedMsg "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current number of messages that haven't being on-chain for more than 3 minutes")]),t._v("\nNumOfMsgBlockedThreeMinutes "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Dimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current number of messages that haven't being on-chain for more than 5 minutes")]),t._v("\nNumOfMsgBlockedFiveMinutes  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of message being selected by venus-messager during last round of message pushing")]),t._v("\nSelectedMsgNumOfLastRound "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of message being pushed by venus-messager during last round of message pushing")]),t._v("\nToPushMsgNumOfLastRound  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of message being expired by venus-messager during last round of message pushing")]),t._v("\nExpiredMsgNumOfLastRound "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of message encountered errors during last round of message pushing")]),t._v("\nErrMsgNumOfLastRound  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitDimensionless"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Current time difference between chain head time and time on venus-messager machine system time")]),t._v("\nChainHeadStableDelay  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitSeconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Histogram of time difference between chain head time and time on venus-messager machine system time")]),t._v("\nChainHeadStableDuration "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UnitSeconds"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("p",[t._v("venus-gateway")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of wallet connecting to the gateway")]),t._v("\nWalletCount\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of wallet addresses connecting to the gateway")]),t._v("\nWalletAddressCount\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// IP of remote wallet connecting to the gateway")]),t._v("\nWalletIPAddress\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of SP connecting to the gateway")]),t._v("\nSPCount\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of SP addresses connecting to the gateway")]),t._v("\nSPAddressCount\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// IP of remote SP connecting to the gateway")]),t._v("\nSPIPAddress\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of signature gateway initiated")]),t._v("\nSignCount\n")])])]),s("p",[t._v("venus-market")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Count of storage deals accepted")]),t._v("\nStorageDealAccepted\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Number of active data transfer ")]),t._v("\nNumberOfActiveTransfer\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Speed of data transfer, per transfer, unit = Mbps")]),t._v("\nDataTransferSpeed\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// The rate of successful data transfer")]),t._v("\nSucessTransferRate\n")])])]),s("p",[t._v("venus-cluster")]),t._v(" "),s("div",{staticClass:"language-go extra-class"},[s("pre",{pre:!0,attrs:{class:"language-go"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Count of new sectors, per miner_id ")]),t._v("\nSectorManagerNewSector\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Count of preCommit, per miner_id ")]),t._v("\nSectorManagerPreCommitSector\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// count of commit, per miner_id ")]),t._v("\nSectorManagerCommitSector\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// time of computing winningPost, per miner_id, unit = Seconds")]),t._v("\nProverWinningPostDuration\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// time of computing WindowPost, per miner_id, unit = Minutes")]),t._v("\nProverWindowPostDuration\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Completion rate for partition that have passed windowPost, per miner_id")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Eg: ProverWindowPostCompleteRate=0.9 when 9 out 10 partition complete windowPost submission")]),t._v("\nProverWindowPostCompleteRate\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Latency of sector manage API calls, unit = ms")]),t._v("\nAPIRequestDuration\n")])])]),s("p",[t._v("Note that all metrics are not final and subject to have more parameters when community see fit.")]),t._v(" "),s("h2",{attrs:{id:"design-rationale-设计思路"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#design-rationale-设计思路"}},[t._v("#")]),t._v(" Design Rationale / 设计思路")]),t._v(" "),s("p",[t._v("Metrics designs allows user to use any exporters to its liking through configuration, which expands the usability of the metrics system so that it can be easily integrated to either new or existing monitoring solution user may already have.")]),t._v(" "),s("div",{staticClass:"language-yml extra-class"},[s("pre",{pre:!0,attrs:{class:"language-yml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启metrics指标统计，默认为false")]),t._v("\n  Enabled = false\n  \n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Metrics.Exporter"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指标导出器类型，目前可选：prometheus或graphite，默认为prometheus")]),t._v('\n    Type = "prometheus"\n    \n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Metrics.Exporter.Prometheus"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# multiaddr")]),t._v('\n      EndPoint = "/ip4/0.0.0.0/tcp/4568"\n      '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 命名规范: "a_b_c", 不能带"-"')]),t._v('\n      Namespace = "messager01" \n      '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 指标注册表类型，可选：default（默认，会附带程序运行的环境指标）或 define（自定义）")]),t._v('\n      RegistryType = "define"\n      '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# prometheus 服务路径")]),t._v('\n      Path = "/debug/metrics"\n      '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上报周期")]),t._v('\n      ReportingPeriod = "10s"\n      \n    '),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Metrics.Exporter.Graphite"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# 命名规范: "a_b_c", 不能带"-"')]),t._v('\n      Namespace = "messager01" \n      '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# graphite exporter 收集器服务地址")]),t._v('\n      Host = "127.0.0.1"\n      '),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# graphite exporter 收集器服务监听端口")]),t._v("\n      Port = 4568\n      "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 上报周期")]),t._v('\n      ReportingPeriod = "10s"\n')])])]),s("h2",{attrs:{id:"backwards-compatibility-兼容性"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#backwards-compatibility-兼容性"}},[t._v("#")]),t._v(" Backwards Compatibility / 兼容性")]),t._v(" "),s("p",[t._v("n/a")]),t._v(" "),s("h2",{attrs:{id:"test-cases-测试用例"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#test-cases-测试用例"}},[t._v("#")]),t._v(" Test Cases / 测试用例")]),t._v(" "),s("p",[t._v("n/a")]),t._v(" "),s("h2",{attrs:{id:"security-considerations-安全考量"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#security-considerations-安全考量"}},[t._v("#")]),t._v(" Security Considerations / 安全考量")]),t._v(" "),s("p",[t._v("n/a")]),t._v(" "),s("h2",{attrs:{id:"related"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#related"}},[t._v("#")]),t._v(" Related")]),t._v(" "),s("p",[t._v("A "),s("a",{attrs:{href:"https://github.com/filecoin-project/devgrants/issues/858",target:"_blank",rel:"noopener noreferrer"}},[t._v("grant"),s("OutboundLink")],1),t._v(" was filed for this initiative to fund the development of this project.")])])}),[],!1,null,null,null);e.default=a.exports}}]);