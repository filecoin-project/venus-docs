(window.webpackJsonp=window.webpackJsonp||[]).push([[59],{451:function(v,a,t){"use strict";t.r(a);var e=t(17),_=Object(e.a)({},(function(){var v=this,a=v.$createElement,t=v._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[t("h1",{attrs:{id:"venus-各组件升级文档-持续更新中"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus-各组件升级文档-持续更新中"}},[v._v("#")]),v._v(" Venus 各组件升级文档 (持续更新中)")]),v._v(" "),t("h2",{attrs:{id:"注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[v._v("#")]),v._v(" 注意事项")]),v._v(" "),t("ol",[t("li",[v._v("所有组件全部更换")]),v._v(" "),t("li",[v._v("更新完通过 curl 命令调用 "),t("code",[v._v("Version")]),v._v(" 接口检查版本号，各组件接口调用方式：https://github.com/filecoin-project/venus/issues/5132")]),v._v(" "),t("li",[v._v("pre/pro消息上链的情况")]),v._v(" "),t("li",[v._v("WD消息上链的情况")]),v._v(" "),t("li",[v._v("出块情况是否正常")]),v._v(" "),t("li",[v._v("gas fee 相关设置是否生效")])]),v._v(" "),t("h2",{attrs:{id:"需要升级的组件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#需要升级的组件"}},[v._v("#")]),v._v(" 需要升级的组件")]),v._v(" "),t("table",[t("thead",[t("tr",[t("th",[v._v("组件名")]),v._v(" "),t("th",[v._v("tag")]),v._v(" "),t("th",[v._v("commit")])])]),v._v(" "),t("tbody",[t("tr",[t("td",[v._v("sophon-auth")]),v._v(" "),t("td",[v._v("v1.15.0")]),v._v(" "),t("td",[v._v("a1e964b")])]),v._v(" "),t("tr",[t("td",[v._v("venus")]),v._v(" "),t("td",[v._v("v1.15.1")]),v._v(" "),t("td",[v._v("81c99f3")])]),v._v(" "),t("tr",[t("td",[v._v("sophon-co")]),v._v(" "),t("td",[v._v("v0.8.0")]),v._v(" "),t("td",[v._v("0e48712")])]),v._v(" "),t("tr",[t("td",[v._v("sophon-messager")]),v._v(" "),t("td",[v._v("v1.15.0")]),v._v(" "),t("td",[v._v("1e4f0d5")])]),v._v(" "),t("tr",[t("td",[v._v("soohon-gateway")]),v._v(" "),t("td",[v._v("v1.15.0")]),v._v(" "),t("td",[v._v("541891a")])]),v._v(" "),t("tr",[t("td",[v._v("venus-wallet")]),v._v(" "),t("td",[v._v("v1.15.0")]),v._v(" "),t("td",[v._v("6b3de34")])]),v._v(" "),t("tr",[t("td",[v._v("sophon-miner")]),v._v(" "),t("td",[v._v("v1.15.0")]),v._v(" "),t("td",[v._v("8dd6c68")])]),v._v(" "),t("tr",[t("td",[v._v("droplet")]),v._v(" "),t("td",[v._v("v2.11.0")]),v._v(" "),t("td",[v._v("44481dd")])]),v._v(" "),t("tr",[t("td",[v._v("damocles-manager")]),v._v(" "),t("td",[v._v("v0.10.0-rc1")]),v._v(" "),t("td",[v._v("2f6c5f9")])]),v._v(" "),t("tr",[t("td",[v._v("damocles-worker")]),v._v(" "),t("td",[v._v("v0.10.0-rc1")]),v._v(" "),t("td",[v._v("2f6c5f9")])])])]),v._v(" "),t("h3",{attrs:{id:"升级顺序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#升级顺序"}},[v._v("#")]),v._v(" 升级顺序")]),v._v(" "),t("ol",[t("li",[v._v("sophon-auth")]),v._v(" "),t("li",[v._v("venus")]),v._v(" "),t("li",[v._v("soohon-co")]),v._v(" "),t("li",[v._v("soohon-gateway")]),v._v(" "),t("li",[v._v("sophon-messager")]),v._v(" "),t("li",[v._v("sophon-miner")]),v._v(" "),t("li",[v._v("droplet")]),v._v(" "),t("li",[v._v("venus-wallet")]),v._v(" "),t("li",[v._v("damocles-manager")]),v._v(" "),t("li",[v._v("damocles-worker")])]),v._v(" "),t("h3",{attrs:{id:"sophon-auth"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-auth"}},[v._v("#")]),v._v(" sophon-auth")]),v._v(" "),t("p",[v._v("影响功能：")]),v._v(" "),t("ul",[t("li",[v._v("其他组件对获取 auth 的服务")])]),v._v(" "),t("p",[v._v("依赖升级组件:  无")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("ul",[t("li",[v._v("启动后能否正常鉴权")])]),v._v(" "),t("h3",{attrs:{id:"venus"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus"}},[v._v("#")]),v._v(" venus")]),v._v(" "),t("p",[v._v("影响功能：无")]),v._v(" "),t("p",[v._v("依赖升级组件:  sophon-auth")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("p",[v._v("编译：先 "),t("code",[v._v("make dist-clean")]),v._v(" 再 "),t("code",[v._v("make")]),v._v("，这样可以防止未能正常升级 "),t("code",[v._v("filecoin-ffi")]),v._v(" 而带来的问题")]),v._v(" "),t("ol",[t("li",[t("p",[v._v("升级后检查vk文件是否完整")])]),v._v(" "),t("li",[t("p",[v._v("升级后执行命令 "),t("code",[v._v("./venus state network-info")]),v._v("，然后检查通过日志检查 UpgradeDragonHeight 是否正常:")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[v._v("# cali\nUpgradeDragonHeight: 1427974\n# mainnet\nUpgradeDragonHeight: 3855360\n")])])])]),v._v(" "),t("li",[t("p",[v._v("升级后需检查是否正常同步区块")])]),v._v(" "),t("li",[t("p",[v._v("检查主网 v13 actors code，确保与下面输出一样")]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[v._v("./venus state actor-cids --network-version 22\n\n# 顺序可能会不一样\nNetwork Version: 22\nActor Version: 13\nManifest CID: bafy2bzacecdhvfmtirtojwhw2tyciu4jkbpsbk5g53oe24br27oy62sn4dc4e\nActor             CID\naccount           bafk2bzacedxnbtlsqdk76fsfmnhyvsblwyfducerwwtp3mqtx2wbrvs5idl52\ncron              bafk2bzacebbopddyn5csb3fsuhh2an4ttd23x6qnwixgohlirj5ahtcudphyc\ndatacap           bafk2bzaceah42tfnhd7xnztawgf46gbvc3m2gudoxshlba2ucmmo2vy67t7ci\neam               bafk2bzaceb23bhvvcjsth7cn7vp3gbaphrutsaz7v6hkls3ogotzs4bnhm4mk\nethaccount        bafk2bzaceautge6zhuy6jbj3uldwoxwhpywuon6z3xfvmdbzpbdribc6zzmei\nevm               bafk2bzacedq6v2lyuhgywhlllwmudfj2zufzcauxcsvvd34m2ek5xr55mvh2q\ninit              bafk2bzacedr4xacm3fts4vilyeiacjr2hpmwzclyzulbdo24lrfxbtau2wbai\nmultisig          bafk2bzacecr5zqarfqak42xqcfeulsxlavcltawsx2fvc7zsjtby6ti4b3wqc\npaymentchannel    bafk2bzacebntdhfmyc24e7tm52ggx5tnw4i3hrr3jmllsepv3mibez4hywsa2\nplaceholder       bafk2bzacedfvut2myeleyq67fljcrw4kkmn5pb5dpyozovj7jpoez5irnc3ro\nreward            bafk2bzacedq4q2kwkruu4xm7rkyygumlbw2yt4nimna2ivea4qarvtkohnuwu\nstoragemarket     bafk2bzacebjtoltdviyznpj34hh5qp6u257jnnbjole5rhqfixm7ug3epvrfu\nstorageminer      bafk2bzacebf4rrqyk7gcfggggul6nfpzay7f2ordnkwm7z2wcf4mq6r7i77t2\nstoragepower      bafk2bzacecjy4dkulvxppg3ocbmeixe2wgg6yxoyjxrm4ko2fm3uhpvfvam6e\nsystem            bafk2bzacecyf523quuq2kdjfdvyty446z2ounmamtgtgeqnr3ynlu5cqrlt6e\nverifiedregistry  bafk2bzacedkxehp7y7iyukbcje3wbpqcvufisos6exatkanyrbotoecdkrbta\n")])])])]),v._v(" "),t("li",[t("p",[v._v("若不排查问题，rust日志级别"),t("strong",[v._v("不建议")]),v._v("设置为 "),t("code",[v._v("trace")]),v._v("，因为会打印较多日志")])]),v._v(" "),t("li",[t("p",[v._v("升级后可以通过命令来 "),t("code",[v._v("./venus state get-actor t01000")]),v._v(" 来确认是否升级成功")])]),v._v(" "),t("li",[t("p",[v._v("actor 迁移")]),v._v(" "),t("p",[t("strong",[v._v("经测试本次预迁移时间在 30 分钟左右，正式迁移时间在 100  秒左右")])]),v._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[v._v("预迁移高度是升级高度前 120 个高度：\npre-migration  开始：STARTING pre-migration  结束：COMPLETED pre-migration\nmigration      开始：STARTING migration      结束：COMPLETED migration\n")])])])]),v._v(" "),t("li",[t("p",[v._v("如果 "),t("code",[v._v("~/.venus")]),v._v(" 存在且需要导入快照，需要先删除 "),t("code",[v._v("~/.venus/version")]),v._v(" 文件再导入快照")]),v._v(" "),t("ul",[t("li",[v._v("主网: "),t("code",[v._v("./venus daemon --import-snapshot snapshot.car")])]),v._v(" "),t("li",[v._v("calibnet: "),t("code",[v._v("./venus daemon --import-snapshot snapshot.car --network calibrationnet")])])])])]),v._v(" "),t("h3",{attrs:{id:"sophon-gateway"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-gateway"}},[v._v("#")]),v._v(" sophon-gateway")]),v._v(" "),t("p",[v._v("影响功能：无")]),v._v(" "),t("p",[v._v("依赖升级组件: sophon-auth")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("ul",[t("li",[v._v("编译时,需要先 "),t("code",[v._v("make dist-clean")]),v._v(" 再 "),t("code",[v._v("make")])])]),v._v(" "),t("h3",{attrs:{id:"sophon-messager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-messager"}},[v._v("#")]),v._v(" sophon-messager")]),v._v(" "),t("p",[v._v("影响功能：")]),v._v(" "),t("p",[v._v("依赖升级组件: venus, sophon-auth, soohon-gateway")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("ul",[t("li",[v._v("升级之后需要观察能否正常接收消息, 消息能否正常上链")])]),v._v(" "),t("h3",{attrs:{id:"sophon-miner"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sophon-miner"}},[v._v("#")]),v._v(" sophon-miner")]),v._v(" "),t("p",[v._v("影响功能：")]),v._v(" "),t("p",[v._v("依赖升级组件：auth, venus, gateway")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("h3",{attrs:{id:"droplet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#droplet"}},[v._v("#")]),v._v(" droplet")]),v._v(" "),t("p",[v._v("影响功能：")]),v._v(" "),t("ul",[t("li",[v._v("支持 direct data onboarding，使用文档：https://github.com/ipfs-force-community/droplet/blob/master/docs/zh/direct-on-boarding.md")])]),v._v(" "),t("p",[v._v("依赖升级组件: auth, venus, gateway, messager")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("ul",[t("li",[v._v("升级后能否正常发单和检索")])]),v._v(" "),t("h3",{attrs:{id:"venus-wallet"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#venus-wallet"}},[v._v("#")]),v._v(" venus-wallet")]),v._v(" "),t("p",[v._v("影响功能： 无")]),v._v(" "),t("p",[v._v("依赖升级组件: gateway")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("ul",[t("li",[v._v("升级后观察是否正常签名，消息能否正常上链")])]),v._v(" "),t("h3",{attrs:{id:"damocles-manager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#damocles-manager"}},[v._v("#")]),v._v(" damocles-manager")]),v._v(" "),t("p",[v._v("依赖升级组件: 链服务组件")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("ul",[t("li",[v._v("编译时,需要先 "),t("code",[v._v("make dist-clean")]),v._v(" 再 "),t("code",[v._v("make")])])]),v._v(" "),t("h3",{attrs:{id:"damocles-worker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#damocles-worker"}},[v._v("#")]),v._v(" damocles-worker")]),v._v(" "),t("p",[v._v("依赖升级组件: damocles-manager")]),v._v(" "),t("p",[v._v("注意事项：")]),v._v(" "),t("hr"),v._v(" "),t("p",[v._v("更新结果验证步骤:")]),v._v(" "),t("ol",[t("li",[v._v("程序启动正常")]),v._v(" "),t("li",[v._v("pre/pro消息正常上链")]),v._v(" "),t("li",[v._v("出块正常")]),v._v(" "),t("li",[v._v("WD上链正常")]),v._v(" "),t("li",[v._v("算力增长正常")]),v._v(" "),t("li",[v._v("真实订单检索正常")]),v._v(" "),t("li",[v._v("数据库各种gas，生命周期，聚合设置正常")])]),v._v(" "),t("h3",{attrs:{id:"数据库变更"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#数据库变更"}},[v._v("#")]),v._v(" 数据库变更")]),v._v(" "),t("ol",[t("li",[v._v("droplet 增加 direct_deals 表，用于存储 direct 订单。")])])])}),[],!1,null,null,null);a.default=_.exports}}]);