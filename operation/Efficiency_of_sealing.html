<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Find your optimal configurations | Venus Filecoin</title>
    <meta name="generator" content="VuePress 1.8.0">
    <link rel="icon" href="/assets/venus-logo.png">
    <script async="true" src="https://www.googletagmanager.com/gtag/js?id=G-SMSDTMGLTV"></script>
    <script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-SMSDTMGLTV');</script>
    <meta name="description" content="Venus is a Go implementation of the Filecoin Distributed Storage Network.">
    
    <link rel="preload" href="/assets/css/0.styles.117964e0.css" as="style"><link rel="preload" href="/assets/js/app.5e5035a9.js" as="script"><link rel="preload" href="/assets/js/2.d93b85b3.js" as="script"><link rel="preload" href="/assets/js/46.d7da63e0.js" as="script"><link rel="prefetch" href="/assets/js/10.d1c164f8.js"><link rel="prefetch" href="/assets/js/100.acf12d52.js"><link rel="prefetch" href="/assets/js/101.d6ba60a8.js"><link rel="prefetch" href="/assets/js/102.676d0a56.js"><link rel="prefetch" href="/assets/js/103.1f4cb286.js"><link rel="prefetch" href="/assets/js/104.fd5b6b88.js"><link rel="prefetch" href="/assets/js/105.f1fe94c2.js"><link rel="prefetch" href="/assets/js/106.4e89ca90.js"><link rel="prefetch" href="/assets/js/11.39d382c8.js"><link rel="prefetch" href="/assets/js/12.a8fa267b.js"><link rel="prefetch" href="/assets/js/13.29435311.js"><link rel="prefetch" href="/assets/js/14.01a8da50.js"><link rel="prefetch" href="/assets/js/15.781d84eb.js"><link rel="prefetch" href="/assets/js/16.9090bfde.js"><link rel="prefetch" href="/assets/js/17.3c92535e.js"><link rel="prefetch" href="/assets/js/18.af070300.js"><link rel="prefetch" href="/assets/js/19.cbf85e59.js"><link rel="prefetch" href="/assets/js/20.a02f1659.js"><link rel="prefetch" href="/assets/js/21.0e15d93f.js"><link rel="prefetch" href="/assets/js/22.7e14d97d.js"><link rel="prefetch" href="/assets/js/23.fcddfb27.js"><link rel="prefetch" href="/assets/js/24.7303e4a8.js"><link rel="prefetch" href="/assets/js/25.0a0abec4.js"><link rel="prefetch" href="/assets/js/26.998e88da.js"><link rel="prefetch" href="/assets/js/27.e480a1b5.js"><link rel="prefetch" href="/assets/js/28.e09e0ccc.js"><link rel="prefetch" href="/assets/js/29.28e077d6.js"><link rel="prefetch" href="/assets/js/3.1d3b456e.js"><link rel="prefetch" href="/assets/js/30.def6f408.js"><link rel="prefetch" href="/assets/js/31.fd489160.js"><link rel="prefetch" href="/assets/js/32.d1735f82.js"><link rel="prefetch" href="/assets/js/33.d4a965cd.js"><link rel="prefetch" href="/assets/js/34.fcb328a5.js"><link rel="prefetch" href="/assets/js/35.eaf7f0bf.js"><link rel="prefetch" href="/assets/js/36.cb3f2a10.js"><link rel="prefetch" href="/assets/js/37.e01e5e96.js"><link rel="prefetch" href="/assets/js/38.36059892.js"><link rel="prefetch" href="/assets/js/39.732b1dc4.js"><link rel="prefetch" href="/assets/js/4.f3c6d7d0.js"><link rel="prefetch" href="/assets/js/40.34270f85.js"><link rel="prefetch" href="/assets/js/41.ccdd0cf9.js"><link rel="prefetch" href="/assets/js/42.d1b1ad7f.js"><link rel="prefetch" href="/assets/js/43.73f4037c.js"><link rel="prefetch" href="/assets/js/44.e4bf7a1b.js"><link rel="prefetch" href="/assets/js/45.89899402.js"><link rel="prefetch" href="/assets/js/47.0d2ad72c.js"><link rel="prefetch" href="/assets/js/48.e217112a.js"><link rel="prefetch" href="/assets/js/49.b9ded15e.js"><link rel="prefetch" href="/assets/js/5.bd4cdbc7.js"><link rel="prefetch" href="/assets/js/50.50f17b89.js"><link rel="prefetch" href="/assets/js/51.3cccea63.js"><link rel="prefetch" href="/assets/js/52.8424010f.js"><link rel="prefetch" href="/assets/js/53.6b8ce2fa.js"><link rel="prefetch" href="/assets/js/54.ae93d6fd.js"><link rel="prefetch" href="/assets/js/55.8c7849db.js"><link rel="prefetch" href="/assets/js/56.b9f020c1.js"><link rel="prefetch" href="/assets/js/57.88fad549.js"><link rel="prefetch" href="/assets/js/58.6983af66.js"><link rel="prefetch" href="/assets/js/59.8e310c91.js"><link rel="prefetch" href="/assets/js/6.3dd12158.js"><link rel="prefetch" href="/assets/js/60.cc23edcf.js"><link rel="prefetch" href="/assets/js/61.b67b475a.js"><link rel="prefetch" href="/assets/js/62.635b0125.js"><link rel="prefetch" href="/assets/js/63.8271cc70.js"><link rel="prefetch" href="/assets/js/64.745968c7.js"><link rel="prefetch" href="/assets/js/65.46f33d71.js"><link rel="prefetch" href="/assets/js/66.5587bf58.js"><link rel="prefetch" href="/assets/js/67.c6b165ba.js"><link rel="prefetch" href="/assets/js/68.08104a13.js"><link rel="prefetch" href="/assets/js/69.7eb6d599.js"><link rel="prefetch" href="/assets/js/7.a560c27d.js"><link rel="prefetch" href="/assets/js/70.8c2c62f9.js"><link rel="prefetch" href="/assets/js/71.33cf82be.js"><link rel="prefetch" href="/assets/js/72.bb6dfe8b.js"><link rel="prefetch" href="/assets/js/73.cc8e9bc1.js"><link rel="prefetch" href="/assets/js/74.d29bf8c7.js"><link rel="prefetch" href="/assets/js/75.5adf7b9a.js"><link rel="prefetch" href="/assets/js/76.1440a115.js"><link rel="prefetch" href="/assets/js/77.5d1a8df6.js"><link rel="prefetch" href="/assets/js/78.fd55fa3b.js"><link rel="prefetch" href="/assets/js/79.abfeaec6.js"><link rel="prefetch" href="/assets/js/8.22a211b8.js"><link rel="prefetch" href="/assets/js/80.d1028106.js"><link rel="prefetch" href="/assets/js/81.ea3d49d0.js"><link rel="prefetch" href="/assets/js/82.b26a0568.js"><link rel="prefetch" href="/assets/js/83.55d7eeda.js"><link rel="prefetch" href="/assets/js/84.dbb27105.js"><link rel="prefetch" href="/assets/js/85.5ba85bfc.js"><link rel="prefetch" href="/assets/js/86.5200a8e5.js"><link rel="prefetch" href="/assets/js/87.4a038c01.js"><link rel="prefetch" href="/assets/js/88.ab6b3465.js"><link rel="prefetch" href="/assets/js/89.5f10a5ee.js"><link rel="prefetch" href="/assets/js/9.ffdad4b1.js"><link rel="prefetch" href="/assets/js/90.aeaf36c5.js"><link rel="prefetch" href="/assets/js/91.d497ec61.js"><link rel="prefetch" href="/assets/js/92.8f2ef6aa.js"><link rel="prefetch" href="/assets/js/93.65f9d1d3.js"><link rel="prefetch" href="/assets/js/94.bc8a612b.js"><link rel="prefetch" href="/assets/js/95.c6f4c73e.js"><link rel="prefetch" href="/assets/js/96.2d391d6e.js"><link rel="prefetch" href="/assets/js/97.a729d39e.js"><link rel="prefetch" href="/assets/js/98.4b6ee74b.js"><link rel="prefetch" href="/assets/js/99.d08e8cdd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.117964e0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/venus-logo-title.svg" alt="Venus Filecoin" class="logo"> <span class="site-name can-hide">Venus Filecoin</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">
  Operation
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/Efficiency_of_sealing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/Efficiency_of_sealing.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/intro/" class="nav-link">
  Introduction
</a></div><div class="nav-item"><a href="/advanced/" class="nav-link">
  Advanced
</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">
  Operation
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/operation/Efficiency_of_sealing.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/operation/Efficiency_of_sealing.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Operation</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/" aria-current="page" class="sidebar-link">High Availability Solution</a></li><li><a href="/operation/example-single-box.html" class="sidebar-link">Example single box setup (depreciating)</a></li><li><a href="/operation/Efficiency_of_sealing.html" aria-current="page" class="active sidebar-link">Finding optimal configurations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#find-your-optimal-configurations" class="sidebar-link">Find your optimal configurations</a></li><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#overview" class="sidebar-link">Overview</a></li><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#record-time-for-each-task" class="sidebar-link">Record time for each task</a></li><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#performance-factors" class="sidebar-link">Performance factors</a></li><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#worker-optimization" class="sidebar-link">Worker optimization</a></li><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#optimize-sealing-pipeline" class="sidebar-link">Optimize sealing pipeline</a></li><li class="sidebar-sub-header"><a href="/operation/Efficiency_of_sealing.html#stop-loss" class="sidebar-link">Stop-loss</a></li></ul></li><li><a href="/operation/System_monitor_of_Zabbix.html" class="sidebar-link">System monitoring (Zabbix)</a></li><li><a href="/operation/lotus-vs-venus.html" class="sidebar-link">Configurations inherited from Lotus</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Upgrade</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/operation/nv17-upgrade.html" class="sidebar-link">nv17 upgrade</a></li><li><a href="/operation/nv16-upgrade.html" class="sidebar-link">nv16 upgrade</a></li><li><a href="/operation/nv15-upgrade.html" class="sidebar-link">nv15 upgrade</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="find-your-optimal-configurations"><a href="#find-your-optimal-configurations" class="header-anchor">#</a> Find your optimal configurations</h2> <p>Get your filecoin mining operation up and running is hard. Expanding growth of your system is even harder. It will take a lot of time to scale growth and make sure your setup running without errors.</p> <h2 id="overview"><a href="#overview" class="header-anchor">#</a> Overview</h2> <p>General guidelines to follow when optimizing your sealing pipeline.</p> <ul><li><p>Pledge 2 to 4 sectors and record the exact time of each task (AP, P1, P2, C2) takes to finish</p></li> <li><p>Make sure all your boxes have tasks assigned to them all the time</p></li> <li><p>Automate your <code>sector pledge</code> command with <a href="https://filecoinproject.slack.com/archives/CPFTWMY7N/p1628092388117700?thread_ts=1628092099.117600&amp;cid=CPFTWMY7N" target="_blank" rel="noopener noreferrer">script<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>/cron</p></li> <li><p>Use <code>MaxSealingSectors</code> to cap maximum number of sectors sealing in parallel</p></li> <li><p>Every worker can be assigned with a subset of tasks (AP, P1, P2, C2) to specialize</p></li></ul> <h2 id="record-time-for-each-task"><a href="#record-time-for-each-task" class="header-anchor">#</a> Record time for each task</h2> <p>Types of task that a worker can do.</p> <div class="language-go extra-class"><pre class="language-go"><code>TTAddPiece   TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/addpiece&quot;</span>
TTPreCommit1 TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/precommit/1&quot;</span>
TTPreCommit2 TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/precommit/2&quot;</span>
TTCommit1    TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/commit/1&quot;</span> <span class="token comment">// NOTE: We use this to transfer the sector into miner-local storage for now; Don't use on workers!</span>
TTCommit2    TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/commit/2&quot;</span>

TTFinalize   TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/finalize&quot;</span>
TTFetch      TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/fetch&quot;</span>
TTUnseal     TaskType <span class="token operator">=</span> <span class="token string">&quot;seal/v0/unseal&quot;</span>
</code></pre></div><p>Each task shows up in log first with key word of <code>prepare</code> (start and end) then with key word of <code>work</code> as another log entry (also start and end).</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># seal/v0/fetch</span>
<span class="token number">2021</span>-08-03T14:00:07.925+0800    INFO    advmgr  sector-storage/sched_worker.go:401  Sector <span class="token number">7</span> prepare <span class="token keyword">for</span> seal/v0/fetch <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T14:05:36.772+0800    INFO    advmgr  sector-storage/sched_worker.go:403  Sector <span class="token number">7</span> prepare <span class="token keyword">for</span> seal/v0/fetch end <span class="token punctuation">..</span>.

<span class="token number">2021</span>-08-03T14:05:36.772+0800    INFO    advmgr  sector-storage/sched_worker.go:442  Sector <span class="token number">7</span> work <span class="token keyword">for</span> seal/v0/fetch <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T14:05:36.774+0800    INFO    advmgr  sector-storage/sched_worker.go:444  Sector <span class="token number">7</span> work <span class="token keyword">for</span> seal/v0/fetch end <span class="token punctuation">..</span>.

<span class="token comment"># seal/v0/addpiece</span>
<span class="token number">2021</span>-08-03T13:38:37.977+0800    INFO    advmgr  sector-storage/sched_worker.go:401  Sector <span class="token number">8</span> prepare <span class="token keyword">for</span> seal/v0/addpiece <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T13:38:37.978+0800    INFO    advmgr  sector-storage/sched_worker.go:403  Sector <span class="token number">8</span> prepare <span class="token keyword">for</span> seal/v0/addpiece end <span class="token punctuation">..</span>.

<span class="token number">2021</span>-08-03T13:38:37.978+0800    INFO    advmgr  sector-storage/sched_worker.go:442  Sector <span class="token number">8</span> work <span class="token keyword">for</span> seal/v0/addpiece <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T13:44:26.295+0800    INFO    advmgr  sector-storage/sched_worker.go:444  Sector <span class="token number">8</span> work <span class="token keyword">for</span> seal/v0/addpiece end <span class="token punctuation">..</span>.

<span class="token comment"># seal/v0/commit/2</span>
<span class="token number">2021</span>-08-03T13:26:02.119+0800    INFO    advmgr  sector-storage/sched_worker.go:401  Sector <span class="token number">7</span> prepare <span class="token keyword">for</span> seal/v0/commit/2 <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T13:26:02.119+0800    INFO    advmgr  sector-storage/sched_worker.go:403  Sector <span class="token number">7</span> prepare <span class="token keyword">for</span> seal/v0/commit/2 end <span class="token punctuation">..</span>.

<span class="token number">2021</span>-08-03T13:26:02.119+0800    INFO    advmgr  sector-storage/sched_worker.go:442  Sector <span class="token number">7</span> work <span class="token keyword">for</span> seal/v0/commit/2 <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T13:49:46.180+0800    INFO    advmgr  sector-storage/sched_worker.go:444  Sector <span class="token number">7</span> work <span class="token keyword">for</span> seal/v0/commit/2 end <span class="token punctuation">..</span>.

<span class="token comment"># seal/v0/finalize</span>
<span class="token number">2021</span>-08-03T13:54:17.414+0800    INFO    advmgr  sector-storage/sched_worker.go:401  Sector <span class="token number">7</span> prepare <span class="token keyword">for</span> seal/v0/finalize <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T13:59:30.471+0800    INFO    advmgr  sector-storage/sched_worker.go:403  Sector <span class="token number">7</span> prepare <span class="token keyword">for</span> seal/v0/finalize end <span class="token punctuation">..</span>.

<span class="token number">2021</span>-08-03T13:59:30.471+0800    INFO    advmgr  sector-storage/sched_worker.go:442  Sector <span class="token number">7</span> work <span class="token keyword">for</span> seal/v0/finalize <span class="token punctuation">..</span>.
<span class="token number">2021</span>-08-03T14:00:07.915+0800    INFO    advmgr  sector-storage/sched_worker.go:444  Sector <span class="token number">7</span> work <span class="token keyword">for</span> seal/v0/finalize end <span class="token punctuation">..</span>.
</code></pre></div><p>Some task may take more time in <code>prepare</code> than<code>work</code> and some are the other way around. Generally speaking, when task requires network transfer/bandwidth it will consume more time in <code>prepare</code> while if the task require more computation resources it will consume more time in <code>work</code>. Eg, AP, P1, P2, C2.</p> <p>To record time of core tasks like AP, P1, P2 and C2, we aggregate both the time of <code>fetch</code> before it and the task itself. For example, time of P1 = time of P1 + time of fetch before P1.</p> <h2 id="performance-factors"><a href="#performance-factors" class="header-anchor">#</a> Performance factors</h2> <p>There are many factors cobtributes to the performance of your sealing pipeline.</p> <h3 id="sealing-storage"><a href="#sealing-storage" class="header-anchor">#</a> Sealing storage</h3> <p>During sealing of a sector, cahce files will be generated by the proof algorithm which requires high disk IO speed. Low IO speed may result in idling of your computation resources (CPUs/GPUs).</p> <p>Choose apropriate hardware using forumla below.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">file</span> size * number of parallel threads / operation <span class="token function">time</span> <span class="token operator">=</span> average <span class="token function">file</span> IO speed
</code></pre></div><p>To get more precise estimations, sum up per task IO throughput.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>AP IO throughput <span class="token operator">=</span> AP <span class="token builtin class-name">read</span> + AP <span class="token function">write</span>
P1 IO throughput <span class="token operator">=</span> P1 <span class="token builtin class-name">read</span> + P1 <span class="token function">write</span>
P2 IO throughput <span class="token operator">=</span> P2 <span class="token builtin class-name">read</span> + P2 <span class="token function">write</span>
C2 IO throughput <span class="token operator">=</span> C2 <span class="token builtin class-name">read</span> + C2 <span class="token function">write</span>
</code></pre></div><p>SSD and NVMe are commonly used for sealing storages. To ensure effcient usage of these faster storage, it is recommended to use software RAID on these SSDs.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mdadm</span> -C /dev/md1 -l <span class="token number">0</span> -n <span class="token number">2</span> /dev/sdb1 /dev/sdc1
<span class="token function">mdadm</span> -C /dev/md2 -l <span class="token number">5</span> -n <span class="token number">6</span> /dev/sd<span class="token punctuation">[</span>b-g<span class="token punctuation">]</span><span class="token number">1</span>
<span class="token comment"># Options</span>
-C, --create
Create a new array.
-l, --level<span class="token operator">=</span>
Set RAID level. 
-n, --raid-devices<span class="token operator">=</span>
Specify the number of active devices <span class="token keyword">in</span> the array.
-x, --spare-devices<span class="token operator">=</span>
Specify the number of spare <span class="token punctuation">(</span>eXtra<span class="token punctuation">)</span> devices <span class="token keyword">in</span> the initial array.
-A, --assemble
Assemble a pre-existing array.
</code></pre></div><p>More on <code>mdadm</code>, please visit <a href="http://raid.wiki.kernel.org/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. Get latest version from <a href="http://www.kernel.org/pub/linux/utils/raid/mdadm/" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h3 id="permenant-storage"><a href="#permenant-storage" class="header-anchor">#</a> Permenant storage</h3> <p>Possible adversaries to overcome when setting up permenant storage.</p> <ol><li>When a sector is sealed, it will be transferred from sealer to permenant storage which takes up network bandwidth and disk IOs.</li> <li>During a <code>windowPost</code>, random selections files will be read in large number. Slow read may result in failed <code>windowPost</code>.</li> <li>Choose high RAID level to have redunancy when possible. Eg, RAID5, RAID6, RAID10.</li> <li>Monitor usage of your disk array.</li></ol> <h3 id="network-transfer"><a href="#network-transfer" class="header-anchor">#</a> Network transfer</h3> <p>During sealing, if you specialize your worker in one type of task (to increase efficiency of your resources), it will result in file transfer over the network. If file being copied too slowly over the network, it will drag the speed of your sealing pipeline down. Closely monitor your computation resources and see if there is any idling. For example, if PC2 takes 25 minutes, reads ~400G and writes ~100G, then IO throughput will be ~368 MB/s (<code>440 * 1024 / 25 / 60 + 100 * 1024 / 25 / 60</code>).</p> <p>After sealing, the sealed sector need to be transferred to permanent storage which can be bottlenecked by the network bandwidth connecting your <code>venus-sealer</code> and your HDD disk array.</p> <h3 id="environment-variables"><a href="#environment-variables" class="header-anchor">#</a> Environment variables</h3> <p>SHA extension would make a huge difference in computing P1 tasks. P1 could cost around 250 minutes with SHA extension enabled while may cost 420+ minutes without SHA.</p> <p>When compiling <code>venus-sealer</code>, make sure you have set <code>RUSTFLAGS=&quot;-C target-cpu=native -g&quot; FFI_BUILD_FROM_SOURCE=&quot;1&quot;</code> flags and you shall see the following example output.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>+ <span class="token builtin class-name">trap</span> <span class="token string">'{ rm -f <span class="token variable">$__build_output_log_tmp</span>; }'</span> EXIT
+ <span class="token builtin class-name">local</span> <span class="token string">'__rust_flags=--print native-static-libs -C target-feature=+sse2'</span>
+ <span class="token assign-left variable">RUSTFLAGS</span><span class="token operator">=</span><span class="token string">'--print native-static-libs -C target-feature=+sse2'</span>
+ cargo +nightly-2021-04-24 build --release --no-default-features --features multicore-sdr --features pairing,gpu
+ <span class="token function">tee</span> /tmp/tmp.IYtnd3xka9
   Compiling autocfg v1.0.1
   Compiling libc v0.2.97
   Compiling cfg-if v1.0.0
   Compiling proc-macro2 v1.0.27
   Compiling unicode-xid v0.2.2
   Compiling syn v1.0.73
   Compiling lazy_static v1.4.0
   Compiling cc v1.0.68
   Compiling typenum v1.13.0
   Compiling serde_derive v1.0.126
   Compiling serde v1.0.126
</code></pre></div><h3 id="core-restriction"><a href="#core-restriction" class="header-anchor">#</a> Core restriction</h3> <p>When running two types of tasks on same box, you may want to restrict CPU cores each task may use without competing for resources of the other.</p> <p>Through <code>taskset</code>. Note you cannot dynamically change core restrictions during execution of the program.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">TRUST_PARAMS</span><span class="token operator">=</span><span class="token number">1</span> <span class="token function">nohup</span> taskset -c <span class="token number">0</span>-32 ./venus-worker run
<span class="token comment"># Non-consecutive core selection </span>
taskset -c <span class="token number">0</span>-9,19-29,39-49
</code></pre></div><p>Or through <code>Cgrep</code>, which supports dynamic core restrictions during program execution.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">mkdir</span> -p /sys/fs/cgroup/cpuset/Pre1-worker
<span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token number">0</span>-31 <span class="token operator">&gt;</span> /sys/fs/cgroup/cpuset/Pre1-worker/cpuset.cpus
<span class="token function">sudo</span> <span class="token builtin class-name">echo</span> <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span> <span class="token operator">&gt;</span> /sys/fs/cgroup/cpuset/Pre1-worker/cgroup.procs
</code></pre></div><h2 id="worker-optimization"><a href="#worker-optimization" class="header-anchor">#</a> Worker optimization</h2> <p>All numbers are for 32G sectors. For 64G sectors, double what the numbers of 32G sector.</p> <h3 id="p1-optimization"><a href="#p1-optimization" class="header-anchor">#</a> P1 optimization</h3> <p>Set following environment variable to speed up P1.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Store cache files in RAM; for 32G sectors, it will cost 56G RAM</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_MAXIMIZE_CACHING</span><span class="token operator">=</span><span class="token number">1</span>  
<span class="token comment"># Use mutiple cores for P1</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_MULTICORE_SDR</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><p>P1 RAM usage includes 56G cache file and 2 layers of the sector for each sector sealing in parallel.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Assume 10 sector running in parallel</span>
56G + 32G * <span class="token number">2</span> * <span class="token number">10</span> <span class="token operator">=</span> 696G
</code></pre></div><p>P1 SSD usage includes 11 layers of the sector, 64G of <code>tree-d</code> file and 32G of the unsealed sector.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># For 1 sector</span>
<span class="token number">11</span> * 32G + <span class="token number">64</span> + <span class="token number">32</span> <span class="token operator">=</span> 440G
</code></pre></div><h3 id="p2-optimization"><a href="#p2-optimization" class="header-anchor">#</a> P2 optimization</h3> <p>Set following environment variable to speed up P2.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Use GPU for tree-r-last</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_GPU_COLUMN_BUILDER</span><span class="token operator">=</span><span class="token number">1</span>   
<span class="token comment"># Use GPU for tree-c</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">FIL_PROOFS_USE_GPU_TREE_BUILDER</span><span class="token operator">=</span><span class="token number">1</span> 
</code></pre></div><p>P2 RAM usage is 96G.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Assume 10 sector running in parallel</span>
96G * <span class="token number">10</span> <span class="token operator">=</span> 960G
</code></pre></div><p>P1 SSD usage includes 4.6G tree-c file * 8, 9.2M tree-r-last file * 8, 4K t_aux file, 4K p_aux file and 32G unsealed sector file.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token number">4</span>.6G * <span class="token number">8</span> + <span class="token number">8</span> * <span class="token number">9</span>.2M + 4K * <span class="token number">2</span> + 32G <span class="token operator">=</span> ~70G
</code></pre></div><h3 id="commit"><a href="#commit" class="header-anchor">#</a> Commit</h3> <p>C1 cost little CPU usage, but require sum of P1 and P2 SSD usage.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>P1 440G + P2 79G <span class="token operator">=</span> 519G
</code></pre></div><p>C2 environment variable</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token assign-left variable">BELLMAN_NO_GPU</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token comment"># Example, if you are using 3090</span>
<span class="token assign-left variable">GPUBELLMAN_CUSTOM_GPU</span><span class="token operator">=</span><span class="token string">&quot;GeForce RTX 3090:10496&quot;</span> 
</code></pre></div><p>C2 RAM usage.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>128G + 64G <span class="token operator">=</span> 192G
</code></pre></div><h2 id="optimize-sealing-pipeline"><a href="#optimize-sealing-pipeline" class="header-anchor">#</a> Optimize sealing pipeline</h2> <h3 id="calculate-your-daily-growth"><a href="#calculate-your-daily-growth" class="header-anchor">#</a> Calculate your daily growth</h3> <p>Calculate how many tasks your sealing pipeline can process.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># for each type of task</span>
tasks <span class="token keyword">done</span> / <span class="token function">time</span> <span class="token operator">=</span> production rate
daily production rate * <span class="token punctuation">(</span>32G OR 64G<span class="token punctuation">)</span> <span class="token operator">=</span> daily growth <span class="token keyword">in</span> power
</code></pre></div><p>For example, if we have one box and can finish P1 in 240 minutes, P2 in 30 minutes and Commit in 35 minutes, then you can derive daily growth by the following chart.</p> <table><thead><tr><th>Task</th> <th>Minute</th> <th>Parallel</th> <th>Hourly production rate</th></tr></thead> <tbody><tr><td>P1</td> <td>240</td> <td>1</td> <td>0.25 = 1 / (240 /60)</td></tr> <tr><td>P2</td> <td>30</td> <td>1</td> <td>2 = 1 / (30 /60)</td></tr> <tr><td>Commit</td> <td>35</td> <td>1</td> <td>1.71 = 1 / (35 /60)</td></tr></tbody></table> <h3 id="finding-optimal-task-configurations"><a href="#finding-optimal-task-configurations" class="header-anchor">#</a> Finding optimal task configurations</h3> <p>From the table above, we know that daily growth will be bottlenecked by P1. Adjust number of parallel tasks for different types of task to achieve maximum efficiency.</p> <table><thead><tr><th>Task</th> <th>Minutes</th> <th>Parallel</th> <th>Hourly productin</th> <th>Output</th> <th>Memory consumption</th></tr></thead> <tbody><tr><td>P1</td> <td>240</td> <td>7</td> <td>1.75 = 7 / (240 /60)</td> <td>1344 G</td> <td>504 G = 7*64+56</td></tr> <tr><td>P2</td> <td>30</td> <td>1</td> <td>2 = 1 / (30 /60)</td> <td>1536 G</td> <td>96 G = 1*96</td></tr> <tr><td>Commit</td> <td>35</td> <td>1</td> <td>1.71 = 1 / (35 /60)</td> <td>1316 G</td> <td>192 G = 1*128+64</td></tr></tbody></table> <p>The goal is to have <code>output</code> for each task to be as close as possilbe so that the sealing pipeline runs in its maximum efficiency. Things to watchout for includes...</p> <ol><li><code>hourly production</code> for Commit is lower than P1, which may result in tasks backlogged in Commit phase.</li> <li>When one type of tasks being overly efficient than others, resources may become idle.</li> <li>Miro management is needed to have highest possible efficiency.</li></ol> <h3 id="finding-optimal-pledging"><a href="#finding-optimal-pledging" class="header-anchor">#</a> Finding optimal pledging</h3> <p>For example, if you find 7 P1 task to the optimal for your system, change the following venus-sealer configurations.</p> <div class="language-toml extra-class"><pre class="language-toml"><code><span class="token punctuation">[</span><span class="token table class-name">Sealing</span><span class="token punctuation">]</span>  
  <span class="token key property">MaxSealingSectors</span> <span class="token punctuation">=</span> <span class="token number">7</span>
</code></pre></div><h2 id="stop-loss"><a href="#stop-loss" class="header-anchor">#</a> Stop-loss</h2> <p>If one of tasks fails too many times, manual intervention is needed to get sealing pipeline back to its normal output.</p> <p>Remove sectors when you have the following issues.</p> <ol><li>Expired ticket</li> <li>Expired Commit</li> <li>Corrupted proof params</li></ol> <p>To remove incomplete sectors.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>venus-sealer sectors remove --really-do-it <span class="token operator">&lt;</span>sectorNum<span class="token operator">&gt;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/filecoin-project/venus-docs/edit/master/docs/operation/Efficiency_of_sealing.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/22/2023, 2:32:00 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/operation/example-single-box.html" class="prev">
        Example single box setup (depreciating)
      </a></span> <span class="next"><a href="/operation/System_monitor_of_Zabbix.html">
        System monitoring (Zabbix)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.5e5035a9.js" defer></script><script src="/assets/js/2.d93b85b3.js" defer></script><script src="/assets/js/46.d7da63e0.js" defer></script>
  </body>
</html>
